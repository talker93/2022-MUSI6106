<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MUSI6106: gmock-spec-builders.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MUSI6106<span id="projectnumber">&#160;0.0.0.1</span>
   </div>
   <div id="projectbrief">Template Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_8cab8f464681f7cc51cee77e79a434cd.html">3rdparty</a></li><li class="navelem"><a class="el" href="dir_f12498a9b3b01f7557dfe344f3ca0a3a.html">googletest</a></li><li class="navelem"><a class="el" href="dir_76b6a47ab5cf193a370abf4fcae112aa.html">googlemock</a></li><li class="navelem"><a class="el" href="dir_f04fd9da824c7d16e8b42029801bc028.html">include</a></li><li class="navelem"><a class="el" href="dir_4da6f07d2602a6ec326bf87ca5fb812b.html">gmock</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">gmock-spec-builders.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;functional&gt;</code><br />
<code>#include &lt;map&gt;</code><br />
<code>#include &lt;memory&gt;</code><br />
<code>#include &lt;set&gt;</code><br />
<code>#include &lt;sstream&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;type_traits&gt;</code><br />
<code>#include &lt;utility&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &quot;<a class="el" href="a00206_source.html">gmock/gmock-actions.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="a00212_source.html">gmock/gmock-cardinalities.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="a00182_source.html">gmock/gmock-matchers.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="a00203_source.html">gmock/internal/gmock-internal-utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="a00197_source.html">gmock/internal/gmock-port.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="a00248_source.html">gtest/gtest.h</a>&quot;</code><br />
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for gmock-spec-builders.h:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="a00192.png" border="0" usemap="#agmock-spec-builders_8h" alt=""/></div>
<map name="agmock-spec-builders_8h" id="agmock-spec-builders_8h">
<area shape="rect" title=" " alt="" coords="1713,5,1865,32"/>
<area shape="rect" title=" " alt="" coords="2589,505,2667,531"/>
<area shape="rect" title=" " alt="" coords="225,594,271,621"/>
<area shape="rect" title=" " alt="" coords="326,765,394,792"/>
<area shape="rect" title=" " alt="" coords="915,594,955,621"/>
<area shape="rect" title=" " alt="" coords="2541,683,2611,710"/>
<area shape="rect" title=" " alt="" coords="2422,765,2477,792"/>
<area shape="rect" title=" " alt="" coords="2928,765,3011,792"/>
<area shape="rect" title=" " alt="" coords="2691,505,2743,531"/>
<area shape="rect" title=" " alt="" coords="736,765,795,792"/>
<area shape="rect" href="a00206.html" title=" " alt="" coords="1709,80,1869,107"/>
<area shape="rect" href="a00203.html" title=" " alt="" coords="2055,155,2206,196"/>
<area shape="rect" href="a00197.html" title=" " alt="" coords="2055,244,2206,285"/>
<area shape="rect" href="a00248.html" title=" " alt="" coords="1350,251,1445,278"/>
<area shape="rect" href="a00212.html" title=" " alt="" coords="805,162,992,189"/>
<area shape="rect" href="a00182.html" title=" " alt="" coords="2310,80,2482,107"/>
<area shape="rect" title=" " alt="" coords="1465,162,1527,189"/>
<area shape="rect" title=" " alt="" coords="1601,162,1676,189"/>
<area shape="rect" title=" " alt="" coords="1117,765,1168,792"/>
<area shape="rect" href="a00194.html" title=" " alt="" coords="1700,162,1879,189"/>
<area shape="rect" title=" " alt="" coords="1901,765,1961,792"/>
<area shape="rect" title=" " alt="" coords="659,505,728,531"/>
<area shape="rect" title=" " alt="" coords="2215,341,2283,367"/>
<area shape="rect" title=" " alt="" coords="1814,765,1877,792"/>
<area shape="rect" title=" " alt="" coords="1449,765,1511,792"/>
<area shape="rect" title=" " alt="" coords="1717,765,1789,792"/>
<area shape="rect" href="a00281.html" title=" " alt="" coords="1599,676,1729,717"/>
<area shape="rect" href="a01761.html" title=" " alt="" coords="2037,333,2192,375"/>
<area shape="rect" title=" " alt="" coords="1193,765,1255,792"/>
<area shape="rect" title=" " alt="" coords="1542,765,1610,792"/>
<area shape="rect" title=" " alt="" coords="1280,765,1344,792"/>
<area shape="rect" title=" " alt="" coords="1635,765,1693,792"/>
<area shape="rect" title=" " alt="" coords="1985,765,2039,792"/>
<area shape="rect" title=" " alt="" coords="702,341,767,367"/>
<area shape="rect" href="a00272.html" title=" " alt="" coords="1343,497,1473,539"/>
<area shape="rect" href="a00251.html" title=" " alt="" coords="1805,594,1955,621"/>
<area shape="rect" href="a00287.html" title=" " alt="" coords="1345,587,1476,628"/>
<area shape="rect" href="a00245.html" title=" " alt="" coords="791,341,947,367"/>
<area shape="rect" href="a00293.html" title=" " alt="" coords="1608,341,1760,367"/>
<area shape="rect" href="a00284.html" title=" " alt="" coords="1659,423,1800,449"/>
<area shape="rect" href="a00260.html" title=" " alt="" coords="2175,423,2335,449"/>
<area shape="rect" href="a00299.html" title=" " alt="" coords="971,341,1098,367"/>
<area shape="rect" href="a00296.html" title=" " alt="" coords="1107,423,1253,449"/>
<area shape="rect" href="a00263.html" title=" " alt="" coords="1328,423,1483,449"/>
<area shape="rect" href="a00257.html" title=" " alt="" coords="1123,341,1280,367"/>
<area shape="rect" title=" " alt="" coords="2767,505,2830,531"/>
<area shape="rect" title=" " alt="" coords="398,251,461,278"/>
<area shape="rect" title=" " alt="" coords="2535,162,2593,189"/>
<area shape="rect" title=" " alt="" coords="2617,162,2713,189"/>
<area shape="rect" href="a01758.html" title=" " alt="" coords="2839,155,2993,196"/>
</map>
</div>
</div><div class="textblock"><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> This graph shows which files directly or indirectly include this file:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="a00193.png" border="0" usemap="#agmock-spec-builders_8hdep" alt=""/></div>
<map name="agmock-spec-builders_8hdep" id="agmock-spec-builders_8hdep">
<area shape="rect" title=" " alt="" coords="100,5,252,32"/>
<area shape="rect" href="a00188.html" title=" " alt="" coords="5,80,173,107"/>
<area shape="rect" href="a00185.html" title=" " alt="" coords="198,80,330,107"/>
<area shape="rect" href="a00176.html" title=" " alt="" coords="141,155,211,181"/>
<area shape="rect" href="a00173.html" title=" " alt="" coords="113,229,239,256"/>
</map>
</div>
</div>
<p><a href="a00191_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a2de39c343f6d2cc6d52c7786968ea7cf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00191.html#a2de39c343f6d2cc6d52c7786968ea7cf">GMOCK_ON_CALL_IMPL_</a>(mock_expr,  Setter,  call)</td></tr>
<tr class="separator:a2de39c343f6d2cc6d52c7786968ea7cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b12ae6cf84f0a544ca811b380c37334"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00191.html#a5b12ae6cf84f0a544ca811b380c37334">ON_CALL</a>(obj,  call)&#160;&#160;&#160;  <a class="el" href="a00191.html#a2de39c343f6d2cc6d52c7786968ea7cf">GMOCK_ON_CALL_IMPL_</a>(obj, InternalDefaultActionSetAt, call)</td></tr>
<tr class="separator:a5b12ae6cf84f0a544ca811b380c37334"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a535a6156de72c1a2e25a127e38ee5232"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00191.html#a535a6156de72c1a2e25a127e38ee5232">EXPECT_CALL</a>(obj,  call)&#160;&#160;&#160;  <a class="el" href="a00191.html#a2de39c343f6d2cc6d52c7786968ea7cf">GMOCK_ON_CALL_IMPL_</a>(obj, InternalExpectedAt, call)</td></tr>
<tr class="separator:a535a6156de72c1a2e25a127e38ee5232"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88f79832f9d045112a76e9da8611cc13"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00191.html#a88f79832f9d045112a76e9da8611cc13">GTEST_DISABLE_MSC_WARNINGS_PUSH_</a> (4251) namespace testing</td></tr>
<tr class="separator:a88f79832f9d045112a76e9da8611cc13"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a535a6156de72c1a2e25a127e38ee5232" name="a535a6156de72c1a2e25a127e38ee5232"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a535a6156de72c1a2e25a127e38ee5232">&#9670;&nbsp;</a></span>EXPECT_CALL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define EXPECT_CALL</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">obj, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">call&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;  <a class="el" href="a00191.html#a2de39c343f6d2cc6d52c7786968ea7cf">GMOCK_ON_CALL_IMPL_</a>(obj, InternalExpectedAt, call)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2de39c343f6d2cc6d52c7786968ea7cf" name="a2de39c343f6d2cc6d52c7786968ea7cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2de39c343f6d2cc6d52c7786968ea7cf">&#9670;&nbsp;</a></span>GMOCK_ON_CALL_IMPL_</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GMOCK_ON_CALL_IMPL_</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">mock_expr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">Setter, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">call&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  ((mock_expr).gmock_##call)(<a class="code hl_function" href="a00310.html#ad4e02ea077a717f95a10a03c10272f1c">::testing::internal::GetWithoutMatchers</a>(), \</div>
<div class="line">                             nullptr)                                   \</div>
<div class="line">      .Setter(__FILE__, __LINE__, #mock_expr, #call)</div>
<div class="ttc" id="aa00310_html_ad4e02ea077a717f95a10a03c10272f1c"><div class="ttname"><a href="a00310.html#ad4e02ea077a717f95a10a03c10272f1c">testing::internal::GetWithoutMatchers</a></div><div class="ttdeci">GTEST_API_ WithoutMatchers GetWithoutMatchers()</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5b12ae6cf84f0a544ca811b380c37334" name="a5b12ae6cf84f0a544ca811b380c37334"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b12ae6cf84f0a544ca811b380c37334">&#9670;&nbsp;</a></span>ON_CALL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ON_CALL</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">obj, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">call&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;  <a class="el" href="a00191.html#a2de39c343f6d2cc6d52c7786968ea7cf">GMOCK_ON_CALL_IMPL_</a>(obj, InternalDefaultActionSetAt, call)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a88f79832f9d045112a76e9da8611cc13" name="a88f79832f9d045112a76e9da8611cc13"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88f79832f9d045112a76e9da8611cc13">&#9670;&nbsp;</a></span>GTEST_DISABLE_MSC_WARNINGS_PUSH_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GTEST_DISABLE_MSC_WARNINGS_PUSH_ </td>
          <td>(</td>
          <td class="paramtype">4251&#160;</td>
          <td class="paramname"><em>GMOCK_MAYBE_5046_</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="a00191_source.html#l00082">82</a> of file <a class="el" href="a00191_source.html">gmock-spec-builders.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   85</span>                  {</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span><span class="comment">// An abstract handle of an expectation.</span></div>
<div class="line"><span class="lineno">   88</span><span class="keyword">class </span>Expectation;</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span><span class="comment">// A set of expectation handles.</span></div>
<div class="line"><span class="lineno">   91</span><span class="keyword">class </span>ExpectationSet;</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span><span class="comment">// Anything inside the &#39;internal&#39; namespace IS INTERNAL IMPLEMENTATION</span></div>
<div class="line"><span class="lineno">   94</span><span class="comment">// and MUST NOT BE USED IN USER CODE!!!</span></div>
<div class="line"><span class="lineno">   95</span><span class="keyword">namespace </span>internal {</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span><span class="comment">// Implements a mock function.</span></div>
<div class="line"><span class="lineno">   98</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt; <span class="keyword">class </span>FunctionMocker;</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span><span class="comment">// Base class for expectations.</span></div>
<div class="line"><span class="lineno">  101</span><span class="keyword">class </span>ExpectationBase;</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span><span class="comment">// Implements an expectation.</span></div>
<div class="line"><span class="lineno">  104</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt; <span class="keyword">class </span>TypedExpectation;</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span><span class="comment">// Helper class for testing the Expectation class template.</span></div>
<div class="line"><span class="lineno">  107</span><span class="keyword">class </span>ExpectationTester;</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span><span class="comment">// Helper classes for implementing NiceMock, StrictMock, and NaggyMock.</span></div>
<div class="line"><span class="lineno">  110</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> MockClass&gt;</div>
<div class="line"><span class="lineno">  111</span><span class="keyword">class </span>NiceMockImpl;</div>
<div class="line"><span class="lineno">  112</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> MockClass&gt;</div>
<div class="line"><span class="lineno">  113</span><span class="keyword">class </span>StrictMockImpl;</div>
<div class="line"><span class="lineno">  114</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> MockClass&gt;</div>
<div class="line"><span class="lineno">  115</span><span class="keyword">class </span>NaggyMockImpl;</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span><span class="comment">// Protects the mock object registry (in class Mock), all function</span></div>
<div class="line"><span class="lineno">  118</span><span class="comment">// mockers, and all expectations.</span></div>
<div class="line"><span class="lineno">  119</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  120</span><span class="comment">// The reason we don&#39;t use more fine-grained protection is: when a</span></div>
<div class="line"><span class="lineno">  121</span><span class="comment">// mock function Foo() is called, it needs to consult its expectations</span></div>
<div class="line"><span class="lineno">  122</span><span class="comment">// to see which one should be picked.  If another thread is allowed to</span></div>
<div class="line"><span class="lineno">  123</span><span class="comment">// call a mock function (either Foo() or a different one) at the same</span></div>
<div class="line"><span class="lineno">  124</span><span class="comment">// time, it could affect the &quot;retired&quot; attributes of Foo()&#39;s</span></div>
<div class="line"><span class="lineno">  125</span><span class="comment">// expectations when InSequence() is used, and thus affect which</span></div>
<div class="line"><span class="lineno">  126</span><span class="comment">// expectation gets picked.  Therefore, we sequence all mock function</span></div>
<div class="line"><span class="lineno">  127</span><span class="comment">// calls to ensure the integrity of the mock objects&#39; states.</span></div>
<div class="line"><span class="lineno">  128</span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> <a class="code hl_define" href="a00281.html#af0970cdea09f16dbb1dbfccdaa693eeb">GTEST_DECLARE_STATIC_MUTEX_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span><span class="comment">// Untyped base class for ActionResultHolder&lt;R&gt;.</span></div>
<div class="line"><span class="lineno">  131</span><span class="keyword">class </span>UntypedActionResultHolderBase;</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span><span class="comment">// Abstract base class of FunctionMocker.  This is the</span></div>
<div class="line"><span class="lineno">  134</span><span class="comment">// type-agnostic part of the function mocker interface.  Its pure</span></div>
<div class="line"><span class="lineno">  135</span><span class="comment">// virtual methods are implemented by FunctionMocker.</span></div>
<div class="line"><span class="lineno">  136</span><span class="keyword">class </span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> UntypedFunctionMockerBase {</div>
<div class="line"><span class="lineno">  137</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  138</span>  UntypedFunctionMockerBase();</div>
<div class="line"><span class="lineno">  139</span>  <span class="keyword">virtual</span> ~UntypedFunctionMockerBase();</div>
<div class="line"><span class="lineno">  140</span> </div>
<div class="line"><span class="lineno">  141</span>  <span class="comment">// Verifies that all expectations on this mock function have been</span></div>
<div class="line"><span class="lineno">  142</span>  <span class="comment">// satisfied.  Reports one or more Google Test non-fatal failures</span></div>
<div class="line"><span class="lineno">  143</span>  <span class="comment">// and returns false if not.</span></div>
<div class="line"><span class="lineno">  144</span>  <span class="keywordtype">bool</span> VerifyAndClearExpectationsLocked()</div>
<div class="line"><span class="lineno">  145</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>  <span class="comment">// Clears the ON_CALL()s set on this mock function.</span></div>
<div class="line"><span class="lineno">  148</span>  virtual <span class="keywordtype">void</span> ClearDefaultActionsLocked()</div>
<div class="line"><span class="lineno">  149</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) = 0;</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>  <span class="comment">// In all of the following Untyped* functions, it&#39;s the caller&#39;s</span></div>
<div class="line"><span class="lineno">  152</span>  <span class="comment">// responsibility to guarantee the correctness of the arguments&#39;</span></div>
<div class="line"><span class="lineno">  153</span>  <span class="comment">// types.</span></div>
<div class="line"><span class="lineno">  154</span> </div>
<div class="line"><span class="lineno">  155</span>  <span class="comment">// Performs the default action with the given arguments and returns</span></div>
<div class="line"><span class="lineno">  156</span>  <span class="comment">// the action&#39;s result.  The call description string will be used in</span></div>
<div class="line"><span class="lineno">  157</span>  <span class="comment">// the error message to describe the call in the case the default</span></div>
<div class="line"><span class="lineno">  158</span>  <span class="comment">// action fails.</span></div>
<div class="line"><span class="lineno">  159</span>  <span class="comment">// L = *</span></div>
<div class="line"><span class="lineno">  160</span>  virtual UntypedActionResultHolderBase* UntypedPerformDefaultAction(</div>
<div class="line"><span class="lineno">  161</span>      <span class="keywordtype">void</span>* untyped_args, const <a class="code hl_namespace" href="a00315.html">std</a>::<span class="keywordtype">string</span>&amp; call_description) const = 0;</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>  <span class="comment">// Performs the given action with the given arguments and returns</span></div>
<div class="line"><span class="lineno">  164</span>  <span class="comment">// the action&#39;s result.</span></div>
<div class="line"><span class="lineno">  165</span>  <span class="comment">// L = *</span></div>
<div class="line"><span class="lineno">  166</span>  virtual UntypedActionResultHolderBase* UntypedPerformAction(</div>
<div class="line"><span class="lineno">  167</span>      const <span class="keywordtype">void</span>* untyped_action, <span class="keywordtype">void</span>* untyped_args) const = 0;</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>  <span class="comment">// Writes a message that the call is uninteresting (i.e. neither</span></div>
<div class="line"><span class="lineno">  170</span>  <span class="comment">// explicitly expected nor explicitly unexpected) to the given</span></div>
<div class="line"><span class="lineno">  171</span>  <span class="comment">// ostream.</span></div>
<div class="line"><span class="lineno">  172</span>  virtual <span class="keywordtype">void</span> UntypedDescribeUninterestingCall(</div>
<div class="line"><span class="lineno">  173</span>      const <span class="keywordtype">void</span>* untyped_args,</div>
<div class="line"><span class="lineno">  174</span>      ::<a class="code hl_namespace" href="a00315.html">std</a>::ostream* os) const</div>
<div class="line"><span class="lineno">  175</span>          <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex) = 0;</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>  <span class="comment">// Returns the expectation that matches the given function arguments</span></div>
<div class="line"><span class="lineno">  178</span>  <span class="comment">// (or NULL is there&#39;s no match); when a match is found,</span></div>
<div class="line"><span class="lineno">  179</span>  <span class="comment">// untyped_action is set to point to the action that should be</span></div>
<div class="line"><span class="lineno">  180</span>  <span class="comment">// performed (or NULL if the action is &quot;do default&quot;), and</span></div>
<div class="line"><span class="lineno">  181</span>  <span class="comment">// is_excessive is modified to indicate whether the call exceeds the</span></div>
<div class="line"><span class="lineno">  182</span>  <span class="comment">// expected number.</span></div>
<div class="line"><span class="lineno">  183</span>  virtual const ExpectationBase* UntypedFindMatchingExpectation(</div>
<div class="line"><span class="lineno">  184</span>      const <span class="keywordtype">void</span>* untyped_args,</div>
<div class="line"><span class="lineno">  185</span>      const <span class="keywordtype">void</span>** untyped_action, <span class="keywordtype">bool</span>* is_excessive,</div>
<div class="line"><span class="lineno">  186</span>      ::<a class="code hl_namespace" href="a00315.html">std</a>::ostream* what, ::<a class="code hl_namespace" href="a00315.html">std</a>::ostream* why)</div>
<div class="line"><span class="lineno">  187</span>          <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex) = 0;</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>  <span class="comment">// Prints the given function arguments to the ostream.</span></div>
<div class="line"><span class="lineno">  190</span>  virtual <span class="keywordtype">void</span> UntypedPrintArgs(const <span class="keywordtype">void</span>* untyped_args,</div>
<div class="line"><span class="lineno">  191</span>                                ::<a class="code hl_namespace" href="a00315.html">std</a>::ostream* os) const = 0;</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>  <span class="comment">// Sets the mock object this mock method belongs to, and registers</span></div>
<div class="line"><span class="lineno">  194</span>  <span class="comment">// this information in the global mock registry.  Will be called</span></div>
<div class="line"><span class="lineno">  195</span>  <span class="comment">// whenever an EXPECT_CALL() or ON_CALL() is executed on this mock</span></div>
<div class="line"><span class="lineno">  196</span>  <span class="comment">// method.</span></div>
<div class="line"><span class="lineno">  197</span>  <span class="keywordtype">void</span> RegisterOwner(const <span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  198</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>  <span class="comment">// Sets the mock object this mock method belongs to, and sets the</span></div>
<div class="line"><span class="lineno">  201</span>  <span class="comment">// name of the mock function.  Will be called upon each invocation</span></div>
<div class="line"><span class="lineno">  202</span>  <span class="comment">// of this mock function.</span></div>
<div class="line"><span class="lineno">  203</span>  <span class="keywordtype">void</span> SetOwnerAndName(const <span class="keywordtype">void</span>* mock_obj, const <span class="keywordtype">char</span>* name)</div>
<div class="line"><span class="lineno">  204</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>  <span class="comment">// Returns the mock object this mock method belongs to.  Must be</span></div>
<div class="line"><span class="lineno">  207</span>  <span class="comment">// called after RegisterOwner() or SetOwnerAndName() has been</span></div>
<div class="line"><span class="lineno">  208</span>  <span class="comment">// called.</span></div>
<div class="line"><span class="lineno">  209</span>  const <span class="keywordtype">void</span>* MockObject() const</div>
<div class="line"><span class="lineno">  210</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>  <span class="comment">// Returns the name of this mock method.  Must be called after</span></div>
<div class="line"><span class="lineno">  213</span>  <span class="comment">// SetOwnerAndName() has been called.</span></div>
<div class="line"><span class="lineno">  214</span>  const <span class="keywordtype">char</span>* Name() const</div>
<div class="line"><span class="lineno">  215</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>  <span class="comment">// Returns the result of invoking this mock function with the given</span></div>
<div class="line"><span class="lineno">  218</span>  <span class="comment">// arguments.  This function can be safely called from multiple</span></div>
<div class="line"><span class="lineno">  219</span>  <span class="comment">// threads concurrently.  The caller is responsible for deleting the</span></div>
<div class="line"><span class="lineno">  220</span>  <span class="comment">// result.</span></div>
<div class="line"><span class="lineno">  221</span>  UntypedActionResultHolderBase* UntypedInvokeWith(<span class="keywordtype">void</span>* untyped_args)</div>
<div class="line"><span class="lineno">  222</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  223</span> </div>
<div class="line"><span class="lineno">  224</span> protected:</div>
<div class="line"><span class="lineno">  225</span>  typedef <a class="code hl_namespace" href="a00315.html">std</a>::vector&lt;const <span class="keywordtype">void</span>*&gt; UntypedOnCallSpecs;</div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span>  using UntypedExpectations = <a class="code hl_namespace" href="a00315.html">std</a>::vector&lt;<a class="code hl_namespace" href="a00315.html">std</a>::shared_ptr&lt;ExpectationBase&gt;&gt;;</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>  <span class="comment">// Returns an Expectation object that references and co-owns exp,</span></div>
<div class="line"><span class="lineno">  230</span>  <span class="comment">// which must be an expectation on this mock function.</span></div>
<div class="line"><span class="lineno">  231</span>  Expectation GetHandleOf(ExpectationBase* exp);</div>
<div class="line"><span class="lineno">  232</span> </div>
<div class="line"><span class="lineno">  233</span>  <span class="comment">// Address of the mock object this mock method belongs to.  Only</span></div>
<div class="line"><span class="lineno">  234</span>  <span class="comment">// valid after this mock method has been called or</span></div>
<div class="line"><span class="lineno">  235</span>  <span class="comment">// ON_CALL/EXPECT_CALL has been invoked on it.</span></div>
<div class="line"><span class="lineno">  236</span>  const <span class="keywordtype">void</span>* mock_obj_;  <span class="comment">// Protected by g_gmock_mutex.</span></div>
<div class="line"><span class="lineno">  237</span> </div>
<div class="line"><span class="lineno">  238</span>  <span class="comment">// Name of the function being mocked.  Only valid after this mock</span></div>
<div class="line"><span class="lineno">  239</span>  <span class="comment">// method has been called.</span></div>
<div class="line"><span class="lineno">  240</span>  const <span class="keywordtype">char</span>* name_;  <span class="comment">// Protected by g_gmock_mutex.</span></div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>  <span class="comment">// All default action specs for this function mocker.</span></div>
<div class="line"><span class="lineno">  243</span>  UntypedOnCallSpecs untyped_on_call_specs_;</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>  <span class="comment">// All expectations for this function mocker.</span></div>
<div class="line"><span class="lineno">  246</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">  247</span>  <span class="comment">// It&#39;s undefined behavior to interleave expectations (EXPECT_CALLs</span></div>
<div class="line"><span class="lineno">  248</span>  <span class="comment">// or ON_CALLs) and mock function calls.  Also, the order of</span></div>
<div class="line"><span class="lineno">  249</span>  <span class="comment">// expectations is important.  Therefore it&#39;s a logic race condition</span></div>
<div class="line"><span class="lineno">  250</span>  <span class="comment">// to read/write untyped_expectations_ concurrently.  In order for</span></div>
<div class="line"><span class="lineno">  251</span>  <span class="comment">// tools like tsan to catch concurrent read/write accesses to</span></div>
<div class="line"><span class="lineno">  252</span>  <span class="comment">// untyped_expectations, we deliberately leave accesses to it</span></div>
<div class="line"><span class="lineno">  253</span>  <span class="comment">// unprotected.</span></div>
<div class="line"><span class="lineno">  254</span>  UntypedExpectations untyped_expectations_;</div>
<div class="line"><span class="lineno">  255</span>};  <span class="comment">// class UntypedFunctionMockerBase</span></div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span><span class="comment">// Untyped base class for OnCallSpec&lt;F&gt;.</span></div>
<div class="line"><span class="lineno">  258</span>class UntypedOnCallSpecBase {</div>
<div class="line"><span class="lineno">  259</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  260</span>  <span class="comment">// The arguments are the location of the ON_CALL() statement.</span></div>
<div class="line"><span class="lineno">  261</span>  UntypedOnCallSpecBase(<span class="keyword">const</span> <span class="keywordtype">char</span>* a_file, <span class="keywordtype">int</span> a_line)</div>
<div class="line"><span class="lineno">  262</span>      : file_(a_file), line_(a_line), last_clause_(kNone) {}</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>  <span class="comment">// Where in the source file was the default action spec defined?</span></div>
<div class="line"><span class="lineno">  265</span>  <span class="keyword">const</span> <span class="keywordtype">char</span>* file()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> file_; }</div>
<div class="line"><span class="lineno">  266</span>  <span class="keywordtype">int</span> line()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> line_; }</div>
<div class="line"><span class="lineno">  267</span> </div>
<div class="line"><span class="lineno">  268</span> <span class="keyword">protected</span>:</div>
<div class="line"><span class="lineno">  269</span>  <span class="comment">// Gives each clause in the ON_CALL() statement a name.</span></div>
<div class="line"><span class="lineno">  270</span>  <span class="keyword">enum</span> Clause {</div>
<div class="line"><span class="lineno">  271</span>    <span class="comment">// Do not change the order of the enum members!  The run-time</span></div>
<div class="line"><span class="lineno">  272</span>    <span class="comment">// syntax checking relies on it.</span></div>
<div class="line"><span class="lineno">  273</span>    kNone,</div>
<div class="line"><span class="lineno">  274</span>    kWith,</div>
<div class="line"><span class="lineno">  275</span>    kWillByDefault</div>
<div class="line"><span class="lineno">  276</span>  };</div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span>  <span class="comment">// Asserts that the ON_CALL() statement has a certain property.</span></div>
<div class="line"><span class="lineno">  279</span>  <span class="keywordtype">void</span> AssertSpecProperty(<span class="keywordtype">bool</span> property,</div>
<div class="line"><span class="lineno">  280</span>                          <span class="keyword">const</span> std::string&amp; failure_message)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  281</span>    <a class="code hl_function" href="a00310.html#aa46ca46a5898b2ac75184c62e0355621">Assert</a>(property, file_, line_, failure_message);</div>
<div class="line"><span class="lineno">  282</span>  }</div>
<div class="line"><span class="lineno">  283</span> </div>
<div class="line"><span class="lineno">  284</span>  <span class="comment">// Expects that the ON_CALL() statement has a certain property.</span></div>
<div class="line"><span class="lineno">  285</span>  <span class="keywordtype">void</span> ExpectSpecProperty(<span class="keywordtype">bool</span> property,</div>
<div class="line"><span class="lineno">  286</span>                          <span class="keyword">const</span> std::string&amp; failure_message)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  287</span>    <a class="code hl_function" href="a00310.html#ad93379317e10862a77b9fb90aa96e083">Expect</a>(property, file_, line_, failure_message);</div>
<div class="line"><span class="lineno">  288</span>  }</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>  <span class="keyword">const</span> <span class="keywordtype">char</span>* file_;</div>
<div class="line"><span class="lineno">  291</span>  <span class="keywordtype">int</span> line_;</div>
<div class="line"><span class="lineno">  292</span> </div>
<div class="line"><span class="lineno">  293</span>  <span class="comment">// The last clause in the ON_CALL() statement as seen so far.</span></div>
<div class="line"><span class="lineno">  294</span>  <span class="comment">// Initially kNone and changes as the statement is parsed.</span></div>
<div class="line"><span class="lineno">  295</span>  Clause last_clause_;</div>
<div class="line"><span class="lineno">  296</span>};  <span class="comment">// class UntypedOnCallSpecBase</span></div>
<div class="line"><span class="lineno">  297</span> </div>
<div class="line"><span class="lineno">  298</span><span class="comment">// This template class implements an ON_CALL spec.</span></div>
<div class="line"><span class="lineno">  299</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno">  300</span><span class="keyword">class </span>OnCallSpec : <span class="keyword">public</span> UntypedOnCallSpecBase {</div>
<div class="line"><span class="lineno">  301</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  302</span>  <span class="keyword">typedef</span> <span class="keyword">typename</span> Function&lt;F&gt;::ArgumentTuple ArgumentTuple;</div>
<div class="line"><span class="lineno">  303</span>  <span class="keyword">typedef</span> <span class="keyword">typename</span> Function&lt;F&gt;::ArgumentMatcherTuple ArgumentMatcherTuple;</div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>  <span class="comment">// Constructs an OnCallSpec object from the information inside</span></div>
<div class="line"><span class="lineno">  306</span>  <span class="comment">// the parenthesis of an ON_CALL() statement.</span></div>
<div class="line"><span class="lineno">  307</span>  OnCallSpec(<span class="keyword">const</span> <span class="keywordtype">char</span>* a_file, <span class="keywordtype">int</span> a_line,</div>
<div class="line"><span class="lineno">  308</span>             <span class="keyword">const</span> ArgumentMatcherTuple&amp; matchers)</div>
<div class="line"><span class="lineno">  309</span>      : UntypedOnCallSpecBase(a_file, a_line),</div>
<div class="line"><span class="lineno">  310</span>        matchers_(matchers),</div>
<div class="line"><span class="lineno">  311</span>        <span class="comment">// By default, extra_matcher_ should match anything.  However,</span></div>
<div class="line"><span class="lineno">  312</span>        <span class="comment">// we cannot initialize it with _ as that causes ambiguity between</span></div>
<div class="line"><span class="lineno">  313</span>        <span class="comment">// Matcher&#39;s copy and move constructor for some argument types.</span></div>
<div class="line"><span class="lineno">  314</span>        extra_matcher_(A&lt;const ArgumentTuple&amp;&gt;()) {}</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>  <span class="comment">// Implements the .With() clause.</span></div>
<div class="line"><span class="lineno">  317</span>  OnCallSpec&amp; With(<span class="keyword">const</span> Matcher&lt;const ArgumentTuple&amp;&gt;&amp; m) {</div>
<div class="line"><span class="lineno">  318</span>    <span class="comment">// Makes sure this is called at most once.</span></div>
<div class="line"><span class="lineno">  319</span>    ExpectSpecProperty(last_clause_ &lt; kWith,</div>
<div class="line"><span class="lineno">  320</span>                       <span class="stringliteral">&quot;.With() cannot appear &quot;</span></div>
<div class="line"><span class="lineno">  321</span>                       <span class="stringliteral">&quot;more than once in an ON_CALL().&quot;</span>);</div>
<div class="line"><span class="lineno">  322</span>    last_clause_ = kWith;</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>    extra_matcher_ = m;</div>
<div class="line"><span class="lineno">  325</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  326</span>  }</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>  <span class="comment">// Implements the .WillByDefault() clause.</span></div>
<div class="line"><span class="lineno">  329</span>  OnCallSpec&amp; WillByDefault(<span class="keyword">const</span> Action&lt;F&gt;&amp; action) {</div>
<div class="line"><span class="lineno">  330</span>    ExpectSpecProperty(last_clause_ &lt; kWillByDefault,</div>
<div class="line"><span class="lineno">  331</span>                       <span class="stringliteral">&quot;.WillByDefault() must appear &quot;</span></div>
<div class="line"><span class="lineno">  332</span>                       <span class="stringliteral">&quot;exactly once in an ON_CALL().&quot;</span>);</div>
<div class="line"><span class="lineno">  333</span>    last_clause_ = kWillByDefault;</div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>    ExpectSpecProperty(!action.IsDoDefault(),</div>
<div class="line"><span class="lineno">  336</span>                       <span class="stringliteral">&quot;DoDefault() cannot be used in ON_CALL().&quot;</span>);</div>
<div class="line"><span class="lineno">  337</span>    action_ = action;</div>
<div class="line"><span class="lineno">  338</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  339</span>  }</div>
<div class="line"><span class="lineno">  340</span> </div>
<div class="line"><span class="lineno">  341</span>  <span class="comment">// Returns true if and only if the given arguments match the matchers.</span></div>
<div class="line"><span class="lineno">  342</span>  <span class="keywordtype">bool</span> Matches(<span class="keyword">const</span> ArgumentTuple&amp; args)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  343</span>    <span class="keywordflow">return</span> TupleMatches(matchers_, args) &amp;&amp; extra_matcher_.Matches(args);</div>
<div class="line"><span class="lineno">  344</span>  }</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>  <span class="comment">// Returns the action specified by the user.</span></div>
<div class="line"><span class="lineno">  347</span>  <span class="keyword">const</span> Action&lt;F&gt;&amp; GetAction()<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  348</span>    AssertSpecProperty(last_clause_ == kWillByDefault,</div>
<div class="line"><span class="lineno">  349</span>                       <span class="stringliteral">&quot;.WillByDefault() must appear exactly &quot;</span></div>
<div class="line"><span class="lineno">  350</span>                       <span class="stringliteral">&quot;once in an ON_CALL().&quot;</span>);</div>
<div class="line"><span class="lineno">  351</span>    <span class="keywordflow">return</span> action_;</div>
<div class="line"><span class="lineno">  352</span>  }</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  355</span>  <span class="comment">// The information in statement</span></div>
<div class="line"><span class="lineno">  356</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">  357</span>  <span class="comment">//   ON_CALL(mock_object, Method(matchers))</span></div>
<div class="line"><span class="lineno">  358</span>  <span class="comment">//       .With(multi-argument-matcher)</span></div>
<div class="line"><span class="lineno">  359</span>  <span class="comment">//       .WillByDefault(action);</span></div>
<div class="line"><span class="lineno">  360</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">  361</span>  <span class="comment">// is recorded in the data members like this:</span></div>
<div class="line"><span class="lineno">  362</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">  363</span>  <span class="comment">//   source file that contains the statement =&gt; file_</span></div>
<div class="line"><span class="lineno">  364</span>  <span class="comment">//   line number of the statement            =&gt; line_</span></div>
<div class="line"><span class="lineno">  365</span>  <span class="comment">//   matchers                                =&gt; matchers_</span></div>
<div class="line"><span class="lineno">  366</span>  <span class="comment">//   multi-argument-matcher                  =&gt; extra_matcher_</span></div>
<div class="line"><span class="lineno">  367</span>  <span class="comment">//   action                                  =&gt; action_</span></div>
<div class="line"><span class="lineno">  368</span>  ArgumentMatcherTuple matchers_;</div>
<div class="line"><span class="lineno">  369</span>  Matcher&lt;const ArgumentTuple&amp;&gt; extra_matcher_;</div>
<div class="line"><span class="lineno">  370</span>  Action&lt;F&gt; action_;</div>
<div class="line"><span class="lineno">  371</span>};  <span class="comment">// class OnCallSpec</span></div>
<div class="line"><span class="lineno">  372</span> </div>
<div class="line"><span class="lineno">  373</span><span class="comment">// Possible reactions on uninteresting calls.</span></div>
<div class="line"><span class="lineno">  374</span><span class="keyword">enum</span> CallReaction {</div>
<div class="line"><span class="lineno">  375</span>  kAllow,</div>
<div class="line"><span class="lineno">  376</span>  kWarn,</div>
<div class="line"><span class="lineno">  377</span>  kFail,</div>
<div class="line"><span class="lineno">  378</span>};</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>}  <span class="comment">// namespace internal</span></div>
<div class="line"><span class="lineno">  381</span> </div>
<div class="line"><span class="lineno">  382</span><span class="comment">// Utilities for manipulating mock objects.</span></div>
<div class="line"><span class="lineno">  383</span><span class="keyword">class </span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> <a class="code hl_class" href="a00668.html">Mock</a> {</div>
<div class="line"><span class="lineno">  384</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  385</span>  <span class="comment">// The following public methods can be called concurrently.</span></div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>  <span class="comment">// Tells Google Mock to ignore mock_obj when checking for leaked</span></div>
<div class="line"><span class="lineno">  388</span>  <span class="comment">// mock objects.</span></div>
<div class="line"><span class="lineno">  389</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> AllowLeak(<span class="keyword">const</span> <span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  390</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>  <span class="comment">// Verifies and clears all expectations on the given mock object.</span></div>
<div class="line"><span class="lineno">  393</span>  <span class="comment">// If the expectations aren&#39;t satisfied, generates one or more</span></div>
<div class="line"><span class="lineno">  394</span>  <span class="comment">// Google Test non-fatal failures and returns false.</span></div>
<div class="line"><span class="lineno">  395</span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> VerifyAndClearExpectations(<span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  396</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>  <span class="comment">// Verifies all expectations on the given mock object and clears its</span></div>
<div class="line"><span class="lineno">  399</span>  <span class="comment">// default actions and expectations.  Returns true if and only if the</span></div>
<div class="line"><span class="lineno">  400</span>  <span class="comment">// verification was successful.</span></div>
<div class="line"><span class="lineno">  401</span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> VerifyAndClear(<span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  402</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  403</span> </div>
<div class="line"><span class="lineno">  404</span>  <span class="comment">// Returns whether the mock was created as a naggy mock (default)</span></div>
<div class="line"><span class="lineno">  405</span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> IsNaggy(<span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  406</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  407</span>  <span class="comment">// Returns whether the mock was created as a nice mock</span></div>
<div class="line"><span class="lineno">  408</span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> IsNice(<span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  409</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  410</span>  <span class="comment">// Returns whether the mock was created as a strict mock</span></div>
<div class="line"><span class="lineno">  411</span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> IsStrict(<span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  412</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  413</span> </div>
<div class="line"><span class="lineno">  414</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  415</span>  <span class="keyword">friend</span> <span class="keyword">class </span>internal::UntypedFunctionMockerBase;</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>  <span class="comment">// Needed for a function mocker to register itself (so that we know</span></div>
<div class="line"><span class="lineno">  418</span>  <span class="comment">// how to clear a mock object).</span></div>
<div class="line"><span class="lineno">  419</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno">  420</span>  <span class="keyword">friend</span> <span class="keyword">class </span>internal::FunctionMocker;</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> MockClass&gt;</div>
<div class="line"><span class="lineno">  423</span>  <span class="keyword">friend</span> <span class="keyword">class </span>internal::NiceMockImpl;</div>
<div class="line"><span class="lineno">  424</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> MockClass&gt;</div>
<div class="line"><span class="lineno">  425</span>  <span class="keyword">friend</span> <span class="keyword">class </span>internal::NaggyMockImpl;</div>
<div class="line"><span class="lineno">  426</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> MockClass&gt;</div>
<div class="line"><span class="lineno">  427</span>  <span class="keyword">friend</span> <span class="keyword">class </span>internal::StrictMockImpl;</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>  <span class="comment">// Tells Google Mock to allow uninteresting calls on the given mock</span></div>
<div class="line"><span class="lineno">  430</span>  <span class="comment">// object.</span></div>
<div class="line"><span class="lineno">  431</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> AllowUninterestingCalls(<span class="keyword">const</span> <span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  432</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>  <span class="comment">// Tells Google Mock to warn the user about uninteresting calls on</span></div>
<div class="line"><span class="lineno">  435</span>  <span class="comment">// the given mock object.</span></div>
<div class="line"><span class="lineno">  436</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> WarnUninterestingCalls(<span class="keyword">const</span> <span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  437</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  438</span> </div>
<div class="line"><span class="lineno">  439</span>  <span class="comment">// Tells Google Mock to fail uninteresting calls on the given mock</span></div>
<div class="line"><span class="lineno">  440</span>  <span class="comment">// object.</span></div>
<div class="line"><span class="lineno">  441</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> FailUninterestingCalls(<span class="keyword">const</span> <span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  442</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  443</span> </div>
<div class="line"><span class="lineno">  444</span>  <span class="comment">// Tells Google Mock the given mock object is being destroyed and</span></div>
<div class="line"><span class="lineno">  445</span>  <span class="comment">// its entry in the call-reaction table should be removed.</span></div>
<div class="line"><span class="lineno">  446</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> UnregisterCallReaction(<span class="keyword">const</span> <span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  447</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  448</span> </div>
<div class="line"><span class="lineno">  449</span>  <span class="comment">// Returns the reaction Google Mock will have on uninteresting calls</span></div>
<div class="line"><span class="lineno">  450</span>  <span class="comment">// made on the given mock object.</span></div>
<div class="line"><span class="lineno">  451</span>  <span class="keyword">static</span> internal::CallReaction GetReactionOnUninterestingCalls(</div>
<div class="line"><span class="lineno">  452</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  453</span>          <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  454</span> </div>
<div class="line"><span class="lineno">  455</span>  <span class="comment">// Verifies that all expectations on the given mock object have been</span></div>
<div class="line"><span class="lineno">  456</span>  <span class="comment">// satisfied.  Reports one or more Google Test non-fatal failures</span></div>
<div class="line"><span class="lineno">  457</span>  <span class="comment">// and returns false if not.</span></div>
<div class="line"><span class="lineno">  458</span>  <span class="keyword">static</span> <span class="keywordtype">bool</span> VerifyAndClearExpectationsLocked(<span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  459</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>  <span class="comment">// Clears all ON_CALL()s set on the given mock object.</span></div>
<div class="line"><span class="lineno">  462</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> ClearDefaultActionsLocked(<span class="keywordtype">void</span>* mock_obj)</div>
<div class="line"><span class="lineno">  463</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  464</span> </div>
<div class="line"><span class="lineno">  465</span>  <span class="comment">// Registers a mock object and a mock method it owns.</span></div>
<div class="line"><span class="lineno">  466</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> Register(</div>
<div class="line"><span class="lineno">  467</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* mock_obj,</div>
<div class="line"><span class="lineno">  468</span>      internal::UntypedFunctionMockerBase* mocker)</div>
<div class="line"><span class="lineno">  469</span>          <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  470</span> </div>
<div class="line"><span class="lineno">  471</span>  <span class="comment">// Tells Google Mock where in the source code mock_obj is used in an</span></div>
<div class="line"><span class="lineno">  472</span>  <span class="comment">// ON_CALL or EXPECT_CALL.  In case mock_obj is leaked, this</span></div>
<div class="line"><span class="lineno">  473</span>  <span class="comment">// information helps the user identify which object it is.</span></div>
<div class="line"><span class="lineno">  474</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> RegisterUseByOnCallOrExpectCall(</div>
<div class="line"><span class="lineno">  475</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* mock_obj, <span class="keyword">const</span> <span class="keywordtype">char</span>* file, <span class="keywordtype">int</span> line)</div>
<div class="line"><span class="lineno">  476</span>          <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>  <span class="comment">// Unregisters a mock method; removes the owning mock object from</span></div>
<div class="line"><span class="lineno">  479</span>  <span class="comment">// the registry when the last mock method associated with it has</span></div>
<div class="line"><span class="lineno">  480</span>  <span class="comment">// been unregistered.  This is called only in the destructor of</span></div>
<div class="line"><span class="lineno">  481</span>  <span class="comment">// FunctionMocker.</span></div>
<div class="line"><span class="lineno">  482</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> UnregisterLocked(internal::UntypedFunctionMockerBase* mocker)</div>
<div class="line"><span class="lineno">  483</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(internal::g_gmock_mutex);</div>
<div class="line"><span class="lineno">  484</span>};  <span class="comment">// class Mock</span></div>
<div class="line"><span class="lineno">  485</span> </div>
<div class="line"><span class="lineno">  486</span><span class="comment">// An abstract handle of an expectation.  Useful in the .After()</span></div>
<div class="line"><span class="lineno">  487</span><span class="comment">// clause of EXPECT_CALL() for setting the (partial) order of</span></div>
<div class="line"><span class="lineno">  488</span><span class="comment">// expectations.  The syntax:</span></div>
<div class="line"><span class="lineno">  489</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  490</span><span class="comment">//   Expectation e1 = EXPECT_CALL(...)...;</span></div>
<div class="line"><span class="lineno">  491</span><span class="comment">//   EXPECT_CALL(...).After(e1)...;</span></div>
<div class="line"><span class="lineno">  492</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  493</span><span class="comment">// sets two expectations where the latter can only be matched after</span></div>
<div class="line"><span class="lineno">  494</span><span class="comment">// the former has been satisfied.</span></div>
<div class="line"><span class="lineno">  495</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  496</span><span class="comment">// Notes:</span></div>
<div class="line"><span class="lineno">  497</span><span class="comment">//   - This class is copyable and has value semantics.</span></div>
<div class="line"><span class="lineno">  498</span><span class="comment">//   - Constness is shallow: a const Expectation object itself cannot</span></div>
<div class="line"><span class="lineno">  499</span><span class="comment">//     be modified, but the mutable methods of the ExpectationBase</span></div>
<div class="line"><span class="lineno">  500</span><span class="comment">//     object it references can be called via expectation_base().</span></div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span><span class="keyword">class </span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> Expectation {</div>
<div class="line"><span class="lineno">  503</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  504</span>  <span class="comment">// Constructs a null object that doesn&#39;t reference any expectation.</span></div>
<div class="line"><span class="lineno">  505</span>  Expectation();</div>
<div class="line"><span class="lineno">  506</span>  Expectation(Expectation&amp;&amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"><span class="lineno">  507</span>  Expectation(<span class="keyword">const</span> Expectation&amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"><span class="lineno">  508</span>  Expectation&amp; operator=(Expectation&amp;&amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"><span class="lineno">  509</span>  Expectation&amp; operator=(<span class="keyword">const</span> Expectation&amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"><span class="lineno">  510</span>  ~Expectation();</div>
<div class="line"><span class="lineno">  511</span> </div>
<div class="line"><span class="lineno">  512</span>  <span class="comment">// This single-argument ctor must not be explicit, in order to support the</span></div>
<div class="line"><span class="lineno">  513</span>  <span class="comment">//   Expectation e = EXPECT_CALL(...);</span></div>
<div class="line"><span class="lineno">  514</span>  <span class="comment">// syntax.</span></div>
<div class="line"><span class="lineno">  515</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno">  516</span>  <span class="comment">// A TypedExpectation object stores its pre-requisites as</span></div>
<div class="line"><span class="lineno">  517</span>  <span class="comment">// Expectation objects, and needs to call the non-const Retire()</span></div>
<div class="line"><span class="lineno">  518</span>  <span class="comment">// method on the ExpectationBase objects they reference.  Therefore</span></div>
<div class="line"><span class="lineno">  519</span>  <span class="comment">// Expectation must receive a *non-const* reference to the</span></div>
<div class="line"><span class="lineno">  520</span>  <span class="comment">// ExpectationBase object.</span></div>
<div class="line"><span class="lineno">  521</span>  Expectation(internal::ExpectationBase&amp; exp);  <span class="comment">// NOLINT</span></div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>  <span class="comment">// The compiler-generated copy ctor and operator= work exactly as</span></div>
<div class="line"><span class="lineno">  524</span>  <span class="comment">// intended, so we don&#39;t need to define our own.</span></div>
<div class="line"><span class="lineno">  525</span> </div>
<div class="line"><span class="lineno">  526</span>  <span class="comment">// Returns true if and only if rhs references the same expectation as this</span></div>
<div class="line"><span class="lineno">  527</span>  <span class="comment">// object does.</span></div>
<div class="line"><span class="lineno">  528</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="a00310.html#a5e3e473798de3189e9343132bcfd4fea">operator==</a>(<span class="keyword">const</span> Expectation&amp; rhs)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  529</span>    <span class="keywordflow">return</span> expectation_base_ == rhs.expectation_base_;</div>
<div class="line"><span class="lineno">  530</span>  }</div>
<div class="line"><span class="lineno">  531</span> </div>
<div class="line"><span class="lineno">  532</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="a00310.html#afa44fdec84edfc155ef63e4f0d4287cc">operator!=</a>(<span class="keyword">const</span> Expectation&amp; rhs)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !(*<span class="keyword">this</span> == rhs); }</div>
<div class="line"><span class="lineno">  533</span> </div>
<div class="line"><span class="lineno">  534</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  535</span>  <span class="keyword">friend</span> <span class="keyword">class </span>ExpectationSet;</div>
<div class="line"><span class="lineno">  536</span>  <span class="keyword">friend</span> <span class="keyword">class </span>Sequence;</div>
<div class="line"><span class="lineno">  537</span>  <span class="keyword">friend</span> class ::testing::internal::ExpectationBase;</div>
<div class="line"><span class="lineno">  538</span>  <span class="keyword">friend</span> class ::testing::internal::UntypedFunctionMockerBase;</div>
<div class="line"><span class="lineno">  539</span> </div>
<div class="line"><span class="lineno">  540</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno">  541</span>  <span class="keyword">friend</span> class ::testing::internal::FunctionMocker;</div>
<div class="line"><span class="lineno">  542</span> </div>
<div class="line"><span class="lineno">  543</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno">  544</span>  <span class="keyword">friend</span> class ::testing::internal::TypedExpectation;</div>
<div class="line"><span class="lineno">  545</span> </div>
<div class="line"><span class="lineno">  546</span>  <span class="comment">// This comparator is needed for putting Expectation objects into a set.</span></div>
<div class="line"><span class="lineno">  547</span>  <span class="keyword">class </span>Less {</div>
<div class="line"><span class="lineno">  548</span>   <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  549</span>    <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> Expectation&amp; lhs, <span class="keyword">const</span> Expectation&amp; rhs)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  550</span>      <span class="keywordflow">return</span> lhs.expectation_base_.get() &lt; rhs.expectation_base_.get();</div>
<div class="line"><span class="lineno">  551</span>    }</div>
<div class="line"><span class="lineno">  552</span>  };</div>
<div class="line"><span class="lineno">  553</span> </div>
<div class="line"><span class="lineno">  554</span>  typedef ::std::set&lt;Expectation, Less&gt; Set;</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>  Expectation(</div>
<div class="line"><span class="lineno">  557</span>      <span class="keyword">const</span> std::shared_ptr&lt;internal::ExpectationBase&gt;&amp; expectation_base);</div>
<div class="line"><span class="lineno">  558</span> </div>
<div class="line"><span class="lineno">  559</span>  <span class="comment">// Returns the expectation this object references.</span></div>
<div class="line"><span class="lineno">  560</span>  <span class="keyword">const</span> std::shared_ptr&lt;internal::ExpectationBase&gt;&amp; expectation_base()<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  561</span>    <span class="keywordflow">return</span> expectation_base_;</div>
<div class="line"><span class="lineno">  562</span>  }</div>
<div class="line"><span class="lineno">  563</span> </div>
<div class="line"><span class="lineno">  564</span>  <span class="comment">// A shared_ptr that co-owns the expectation this handle references.</span></div>
<div class="line"><span class="lineno">  565</span>  std::shared_ptr&lt;internal::ExpectationBase&gt; expectation_base_;</div>
<div class="line"><span class="lineno">  566</span>};</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span><span class="comment">// A set of expectation handles.  Useful in the .After() clause of</span></div>
<div class="line"><span class="lineno">  569</span><span class="comment">// EXPECT_CALL() for setting the (partial) order of expectations.  The</span></div>
<div class="line"><span class="lineno">  570</span><span class="comment">// syntax:</span></div>
<div class="line"><span class="lineno">  571</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  572</span><span class="comment">//   ExpectationSet es;</span></div>
<div class="line"><span class="lineno">  573</span><span class="comment">//   es += EXPECT_CALL(...)...;</span></div>
<div class="line"><span class="lineno">  574</span><span class="comment">//   es += EXPECT_CALL(...)...;</span></div>
<div class="line"><span class="lineno">  575</span><span class="comment">//   EXPECT_CALL(...).After(es)...;</span></div>
<div class="line"><span class="lineno">  576</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  577</span><span class="comment">// sets three expectations where the last one can only be matched</span></div>
<div class="line"><span class="lineno">  578</span><span class="comment">// after the first two have both been satisfied.</span></div>
<div class="line"><span class="lineno">  579</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  580</span><span class="comment">// This class is copyable and has value semantics.</span></div>
<div class="line"><span class="lineno">  581</span><span class="keyword">class </span>ExpectationSet {</div>
<div class="line"><span class="lineno">  582</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  583</span>  <span class="comment">// A bidirectional iterator that can read a const element in the set.</span></div>
<div class="line"><span class="lineno">  584</span>  <span class="keyword">typedef</span> Expectation::Set::const_iterator const_iterator;</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>  <span class="comment">// An object stored in the set.  This is an alias of Expectation.</span></div>
<div class="line"><span class="lineno">  587</span>  <span class="keyword">typedef</span> Expectation::Set::value_type value_type;</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>  <span class="comment">// Constructs an empty set.</span></div>
<div class="line"><span class="lineno">  590</span>  ExpectationSet() {}</div>
<div class="line"><span class="lineno">  591</span> </div>
<div class="line"><span class="lineno">  592</span>  <span class="comment">// This single-argument ctor must not be explicit, in order to support the</span></div>
<div class="line"><span class="lineno">  593</span>  <span class="comment">//   ExpectationSet es = EXPECT_CALL(...);</span></div>
<div class="line"><span class="lineno">  594</span>  <span class="comment">// syntax.</span></div>
<div class="line"><span class="lineno">  595</span>  ExpectationSet(internal::ExpectationBase&amp; exp) {  <span class="comment">// NOLINT</span></div>
<div class="line"><span class="lineno">  596</span>    *<span class="keyword">this</span> += Expectation(exp);</div>
<div class="line"><span class="lineno">  597</span>  }</div>
<div class="line"><span class="lineno">  598</span> </div>
<div class="line"><span class="lineno">  599</span>  <span class="comment">// This single-argument ctor implements implicit conversion from</span></div>
<div class="line"><span class="lineno">  600</span>  <span class="comment">// Expectation and thus must not be explicit.  This allows either an</span></div>
<div class="line"><span class="lineno">  601</span>  <span class="comment">// Expectation or an ExpectationSet to be used in .After().</span></div>
<div class="line"><span class="lineno">  602</span>  ExpectationSet(<span class="keyword">const</span> Expectation&amp; e) {  <span class="comment">// NOLINT</span></div>
<div class="line"><span class="lineno">  603</span>    *<span class="keyword">this</span> += e;</div>
<div class="line"><span class="lineno">  604</span>  }</div>
<div class="line"><span class="lineno">  605</span> </div>
<div class="line"><span class="lineno">  606</span>  <span class="comment">// The compiler-generator ctor and operator= works exactly as</span></div>
<div class="line"><span class="lineno">  607</span>  <span class="comment">// intended, so we don&#39;t need to define our own.</span></div>
<div class="line"><span class="lineno">  608</span> </div>
<div class="line"><span class="lineno">  609</span>  <span class="comment">// Returns true if and only if rhs contains the same set of Expectation</span></div>
<div class="line"><span class="lineno">  610</span>  <span class="comment">// objects as this does.</span></div>
<div class="line"><span class="lineno">  611</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="a00310.html#a5e3e473798de3189e9343132bcfd4fea">operator==</a>(<span class="keyword">const</span> ExpectationSet&amp; rhs)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  612</span>    <span class="keywordflow">return</span> expectations_ == rhs.expectations_;</div>
<div class="line"><span class="lineno">  613</span>  }</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="a00310.html#afa44fdec84edfc155ef63e4f0d4287cc">operator!=</a>(<span class="keyword">const</span> ExpectationSet&amp; rhs)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !(*<span class="keyword">this</span> == rhs); }</div>
<div class="line"><span class="lineno">  616</span> </div>
<div class="line"><span class="lineno">  617</span>  <span class="comment">// Implements the syntax</span></div>
<div class="line"><span class="lineno">  618</span>  <span class="comment">//   expectation_set += EXPECT_CALL(...);</span></div>
<div class="line"><span class="lineno">  619</span>  ExpectationSet&amp; operator+=(<span class="keyword">const</span> Expectation&amp; e) {</div>
<div class="line"><span class="lineno">  620</span>    expectations_.insert(e);</div>
<div class="line"><span class="lineno">  621</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  622</span>  }</div>
<div class="line"><span class="lineno">  623</span> </div>
<div class="line"><span class="lineno">  624</span>  <span class="keywordtype">int</span> size()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(expectations_.size()); }</div>
<div class="line"><span class="lineno">  625</span> </div>
<div class="line"><span class="lineno">  626</span>  const_iterator begin()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> expectations_.begin(); }</div>
<div class="line"><span class="lineno">  627</span>  const_iterator end()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> expectations_.end(); }</div>
<div class="line"><span class="lineno">  628</span> </div>
<div class="line"><span class="lineno">  629</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  630</span>  Expectation::Set expectations_;</div>
<div class="line"><span class="lineno">  631</span>};</div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span> </div>
<div class="line"><span class="lineno">  634</span><span class="comment">// Sequence objects are used by a user to specify the relative order</span></div>
<div class="line"><span class="lineno">  635</span><span class="comment">// in which the expectations should match.  They are copyable (we rely</span></div>
<div class="line"><span class="lineno">  636</span><span class="comment">// on the compiler-defined copy constructor and assignment operator).</span></div>
<div class="line"><span class="lineno">  637</span><span class="keyword">class </span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> Sequence {</div>
<div class="line"><span class="lineno">  638</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  639</span>  <span class="comment">// Constructs an empty sequence.</span></div>
<div class="line"><span class="lineno">  640</span>  Sequence() : last_expectation_(new Expectation) {}</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>  <span class="comment">// Adds an expectation to this sequence.  The caller must ensure</span></div>
<div class="line"><span class="lineno">  643</span>  <span class="comment">// that no other thread is accessing this Sequence object.</span></div>
<div class="line"><span class="lineno">  644</span>  <span class="keywordtype">void</span> AddExpectation(<span class="keyword">const</span> Expectation&amp; expectation) <span class="keyword">const</span>;</div>
<div class="line"><span class="lineno">  645</span> </div>
<div class="line"><span class="lineno">  646</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  647</span>  <span class="comment">// The last expectation in this sequence.</span></div>
<div class="line"><span class="lineno">  648</span>  std::shared_ptr&lt;Expectation&gt; last_expectation_;</div>
<div class="line"><span class="lineno">  649</span>};  <span class="comment">// class Sequence</span></div>
<div class="line"><span class="lineno">  650</span> </div>
<div class="line"><span class="lineno">  651</span><span class="comment">// An object of this type causes all EXPECT_CALL() statements</span></div>
<div class="line"><span class="lineno">  652</span><span class="comment">// encountered in its scope to be put in an anonymous sequence.  The</span></div>
<div class="line"><span class="lineno">  653</span><span class="comment">// work is done in the constructor and destructor.  You should only</span></div>
<div class="line"><span class="lineno">  654</span><span class="comment">// create an InSequence object on the stack.</span></div>
<div class="line"><span class="lineno">  655</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  656</span><span class="comment">// The sole purpose for this class is to support easy definition of</span></div>
<div class="line"><span class="lineno">  657</span><span class="comment">// sequential expectations, e.g.</span></div>
<div class="line"><span class="lineno">  658</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  659</span><span class="comment">//   {</span></div>
<div class="line"><span class="lineno">  660</span><span class="comment">//     InSequence dummy;  // The name of the object doesn&#39;t matter.</span></div>
<div class="line"><span class="lineno">  661</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  662</span><span class="comment">//     // The following expectations must match in the order they appear.</span></div>
<div class="line"><span class="lineno">  663</span><span class="comment">//     EXPECT_CALL(a, Bar())...;</span></div>
<div class="line"><span class="lineno">  664</span><span class="comment">//     EXPECT_CALL(a, Baz())...;</span></div>
<div class="line"><span class="lineno">  665</span><span class="comment">//     ...</span></div>
<div class="line"><span class="lineno">  666</span><span class="comment">//     EXPECT_CALL(b, Xyz())...;</span></div>
<div class="line"><span class="lineno">  667</span><span class="comment">//   }</span></div>
<div class="line"><span class="lineno">  668</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  669</span><span class="comment">// You can create InSequence objects in multiple threads, as long as</span></div>
<div class="line"><span class="lineno">  670</span><span class="comment">// they are used to affect different mock objects.  The idea is that</span></div>
<div class="line"><span class="lineno">  671</span><span class="comment">// each thread can create and set up its own mocks as if it&#39;s the only</span></div>
<div class="line"><span class="lineno">  672</span><span class="comment">// thread.  However, for clarity of your tests we recommend you to set</span></div>
<div class="line"><span class="lineno">  673</span><span class="comment">// up mocks in the main thread unless you have a good reason not to do</span></div>
<div class="line"><span class="lineno">  674</span><span class="comment">// so.</span></div>
<div class="line"><span class="lineno">  675</span><span class="keyword">class </span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> InSequence {</div>
<div class="line"><span class="lineno">  676</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  677</span>  InSequence();</div>
<div class="line"><span class="lineno">  678</span>  ~InSequence();</div>
<div class="line"><span class="lineno">  679</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">  680</span>  <span class="keywordtype">bool</span> sequence_created_;</div>
<div class="line"><span class="lineno">  681</span> </div>
<div class="line"><span class="lineno">  682</span>  <a class="code hl_define" href="a00281.html#aed8c1888c32b588b0681e88b95031e29">GTEST_DISALLOW_COPY_AND_ASSIGN_</a>(InSequence);  <span class="comment">// NOLINT</span></div>
<div class="line"><span class="lineno">  683</span>} <a class="code hl_define" href="a00281.html#acdd47601a9376161c349a5881ccc6918">GTEST_ATTRIBUTE_UNUSED_</a>;</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span><span class="keyword">namespace </span>internal {</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span><span class="comment">// Points to the implicit sequence introduced by a living InSequence</span></div>
<div class="line"><span class="lineno">  688</span><span class="comment">// object (if any) in the current thread or NULL.</span></div>
<div class="line"><span class="lineno">  689</span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> <span class="keyword">extern</span> ThreadLocal&lt;Sequence*&gt; g_gmock_implicit_sequence;</div>
<div class="line"><span class="lineno">  690</span> </div>
<div class="line"><span class="lineno">  691</span><span class="comment">// Base class for implementing expectations.</span></div>
<div class="line"><span class="lineno">  692</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  693</span><span class="comment">// There are two reasons for having a type-agnostic base class for</span></div>
<div class="line"><span class="lineno">  694</span><span class="comment">// Expectation:</span></div>
<div class="line"><span class="lineno">  695</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  696</span><span class="comment">//   1. We need to store collections of expectations of different</span></div>
<div class="line"><span class="lineno">  697</span><span class="comment">//   types (e.g. all pre-requisites of a particular expectation, all</span></div>
<div class="line"><span class="lineno">  698</span><span class="comment">//   expectations in a sequence).  Therefore these expectation objects</span></div>
<div class="line"><span class="lineno">  699</span><span class="comment">//   must share a common base class.</span></div>
<div class="line"><span class="lineno">  700</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  701</span><span class="comment">//   2. We can avoid binary code bloat by moving methods not depending</span></div>
<div class="line"><span class="lineno">  702</span><span class="comment">//   on the template argument of Expectation to the base class.</span></div>
<div class="line"><span class="lineno">  703</span><span class="comment">//</span></div>
<div class="line"><span class="lineno">  704</span><span class="comment">// This class is internal and mustn&#39;t be used by user code directly.</span></div>
<div class="line"><span class="lineno">  705</span><span class="keyword">class </span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> ExpectationBase {</div>
<div class="line"><span class="lineno">  706</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  707</span>  <span class="comment">// source_text is the EXPECT_CALL(...) source that created this Expectation.</span></div>
<div class="line"><span class="lineno">  708</span>  ExpectationBase(<span class="keyword">const</span> <span class="keywordtype">char</span>* file, <span class="keywordtype">int</span> line, <span class="keyword">const</span> std::string&amp; source_text);</div>
<div class="line"><span class="lineno">  709</span> </div>
<div class="line"><span class="lineno">  710</span>  <span class="keyword">virtual</span> ~ExpectationBase();</div>
<div class="line"><span class="lineno">  711</span> </div>
<div class="line"><span class="lineno">  712</span>  <span class="comment">// Where in the source file was the expectation spec defined?</span></div>
<div class="line"><span class="lineno">  713</span>  <span class="keyword">const</span> <span class="keywordtype">char</span>* file()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> file_; }</div>
<div class="line"><span class="lineno">  714</span>  <span class="keywordtype">int</span> line()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> line_; }</div>
<div class="line"><span class="lineno">  715</span>  <span class="keyword">const</span> <span class="keywordtype">char</span>* source_text()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> source_text_.c_str(); }</div>
<div class="line"><span class="lineno">  716</span>  <span class="comment">// Returns the cardinality specified in the expectation spec.</span></div>
<div class="line"><span class="lineno">  717</span>  <span class="keyword">const</span> Cardinality&amp; cardinality()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> cardinality_; }</div>
<div class="line"><span class="lineno">  718</span> </div>
<div class="line"><span class="lineno">  719</span>  <span class="comment">// Describes the source file location of this expectation.</span></div>
<div class="line"><span class="lineno">  720</span>  <span class="keywordtype">void</span> DescribeLocationTo(::std::ostream* os)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  721</span>    *os &lt;&lt; <a class="code hl_function" href="a00310.html#a31b7c3abed4a7c395f42c61e993989f4">FormatFileLocation</a>(file(), line()) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno">  722</span>  }</div>
<div class="line"><span class="lineno">  723</span> </div>
<div class="line"><span class="lineno">  724</span>  <span class="comment">// Describes how many times a function call matching this</span></div>
<div class="line"><span class="lineno">  725</span>  <span class="comment">// expectation has occurred.</span></div>
<div class="line"><span class="lineno">  726</span>  <span class="keywordtype">void</span> DescribeCallCountTo(::std::ostream* os) <span class="keyword">const</span></div>
<div class="line"><span class="lineno">  727</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span>  <span class="comment">// If this mock method has an extra matcher (i.e. .With(matcher)),</span></div>
<div class="line"><span class="lineno">  730</span>  <span class="comment">// describes it to the ostream.</span></div>
<div class="line"><span class="lineno">  731</span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> MaybeDescribeExtraMatcherTo(::std::ostream* os) = 0;</div>
<div class="line"><span class="lineno">  732</span> </div>
<div class="line"><span class="lineno">  733</span> <span class="keyword">protected</span>:</div>
<div class="line"><span class="lineno">  734</span>  <span class="keyword">friend</span> class ::testing::Expectation;</div>
<div class="line"><span class="lineno">  735</span>  <span class="keyword">friend</span> <span class="keyword">class </span>UntypedFunctionMockerBase;</div>
<div class="line"><span class="lineno">  736</span> </div>
<div class="line"><span class="lineno">  737</span>  <span class="keyword">enum</span> Clause {</div>
<div class="line"><span class="lineno">  738</span>    <span class="comment">// Don&#39;t change the order of the enum members!</span></div>
<div class="line"><span class="lineno">  739</span>    kNone,</div>
<div class="line"><span class="lineno">  740</span>    kWith,</div>
<div class="line"><span class="lineno">  741</span>    kTimes,</div>
<div class="line"><span class="lineno">  742</span>    kInSequence,</div>
<div class="line"><span class="lineno">  743</span>    kAfter,</div>
<div class="line"><span class="lineno">  744</span>    kWillOnce,</div>
<div class="line"><span class="lineno">  745</span>    kWillRepeatedly,</div>
<div class="line"><span class="lineno">  746</span>    kRetiresOnSaturation</div>
<div class="line"><span class="lineno">  747</span>  };</div>
<div class="line"><span class="lineno">  748</span> </div>
<div class="line"><span class="lineno">  749</span>  <span class="keyword">typedef</span> std::vector&lt;const void*&gt; UntypedActions;</div>
<div class="line"><span class="lineno">  750</span> </div>
<div class="line"><span class="lineno">  751</span>  <span class="comment">// Returns an Expectation object that references and co-owns this</span></div>
<div class="line"><span class="lineno">  752</span>  <span class="comment">// expectation.</span></div>
<div class="line"><span class="lineno">  753</span>  <span class="keyword">virtual</span> Expectation GetHandle() = 0;</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>  <span class="comment">// Asserts that the EXPECT_CALL() statement has the given property.</span></div>
<div class="line"><span class="lineno">  756</span>  <span class="keywordtype">void</span> AssertSpecProperty(<span class="keywordtype">bool</span> property,</div>
<div class="line"><span class="lineno">  757</span>                          <span class="keyword">const</span> std::string&amp; failure_message)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  758</span>    <a class="code hl_function" href="a00310.html#aa46ca46a5898b2ac75184c62e0355621">Assert</a>(property, file_, line_, failure_message);</div>
<div class="line"><span class="lineno">  759</span>  }</div>
<div class="line"><span class="lineno">  760</span> </div>
<div class="line"><span class="lineno">  761</span>  <span class="comment">// Expects that the EXPECT_CALL() statement has the given property.</span></div>
<div class="line"><span class="lineno">  762</span>  <span class="keywordtype">void</span> ExpectSpecProperty(<span class="keywordtype">bool</span> property,</div>
<div class="line"><span class="lineno">  763</span>                          <span class="keyword">const</span> std::string&amp; failure_message)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">  764</span>    <a class="code hl_function" href="a00310.html#ad93379317e10862a77b9fb90aa96e083">Expect</a>(property, file_, line_, failure_message);</div>
<div class="line"><span class="lineno">  765</span>  }</div>
<div class="line"><span class="lineno">  766</span> </div>
<div class="line"><span class="lineno">  767</span>  <span class="comment">// Explicitly specifies the cardinality of this expectation.  Used</span></div>
<div class="line"><span class="lineno">  768</span>  <span class="comment">// by the subclasses to implement the .Times() clause.</span></div>
<div class="line"><span class="lineno">  769</span>  <span class="keywordtype">void</span> SpecifyCardinality(<span class="keyword">const</span> Cardinality&amp; cardinality);</div>
<div class="line"><span class="lineno">  770</span> </div>
<div class="line"><span class="lineno">  771</span>  <span class="comment">// Returns true if and only if the user specified the cardinality</span></div>
<div class="line"><span class="lineno">  772</span>  <span class="comment">// explicitly using a .Times().</span></div>
<div class="line"><span class="lineno">  773</span>  <span class="keywordtype">bool</span> cardinality_specified()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> cardinality_specified_; }</div>
<div class="line"><span class="lineno">  774</span> </div>
<div class="line"><span class="lineno">  775</span>  <span class="comment">// Sets the cardinality of this expectation spec.</span></div>
<div class="line"><span class="lineno">  776</span>  <span class="keywordtype">void</span> set_cardinality(<span class="keyword">const</span> Cardinality&amp; a_cardinality) {</div>
<div class="line"><span class="lineno">  777</span>    cardinality_ = a_cardinality;</div>
<div class="line"><span class="lineno">  778</span>  }</div>
<div class="line"><span class="lineno">  779</span> </div>
<div class="line"><span class="lineno">  780</span>  <span class="comment">// The following group of methods should only be called after the</span></div>
<div class="line"><span class="lineno">  781</span>  <span class="comment">// EXPECT_CALL() statement, and only when g_gmock_mutex is held by</span></div>
<div class="line"><span class="lineno">  782</span>  <span class="comment">// the current thread.</span></div>
<div class="line"><span class="lineno">  783</span> </div>
<div class="line"><span class="lineno">  784</span>  <span class="comment">// Retires all pre-requisites of this expectation.</span></div>
<div class="line"><span class="lineno">  785</span>  <span class="keywordtype">void</span> RetireAllPreRequisites()</div>
<div class="line"><span class="lineno">  786</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  787</span> </div>
<div class="line"><span class="lineno">  788</span>  <span class="comment">// Returns true if and only if this expectation is retired.</span></div>
<div class="line"><span class="lineno">  789</span>  <span class="keywordtype">bool</span> is_retired() const</div>
<div class="line"><span class="lineno">  790</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno">  791</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno">  792</span>    <span class="keywordflow">return</span> retired_;</div>
<div class="line"><span class="lineno">  793</span>  }</div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>  <span class="comment">// Retires this expectation.</span></div>
<div class="line"><span class="lineno">  796</span>  <span class="keywordtype">void</span> Retire()</div>
<div class="line"><span class="lineno">  797</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno">  798</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno">  799</span>    retired_ = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  800</span>  }</div>
<div class="line"><span class="lineno">  801</span> </div>
<div class="line"><span class="lineno">  802</span>  <span class="comment">// Returns true if and only if this expectation is satisfied.</span></div>
<div class="line"><span class="lineno">  803</span>  <span class="keywordtype">bool</span> IsSatisfied() const</div>
<div class="line"><span class="lineno">  804</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno">  805</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno">  806</span>    <span class="keywordflow">return</span> cardinality().IsSatisfiedByCallCount(call_count_);</div>
<div class="line"><span class="lineno">  807</span>  }</div>
<div class="line"><span class="lineno">  808</span> </div>
<div class="line"><span class="lineno">  809</span>  <span class="comment">// Returns true if and only if this expectation is saturated.</span></div>
<div class="line"><span class="lineno">  810</span>  <span class="keywordtype">bool</span> IsSaturated() const</div>
<div class="line"><span class="lineno">  811</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno">  812</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno">  813</span>    <span class="keywordflow">return</span> cardinality().IsSaturatedByCallCount(call_count_);</div>
<div class="line"><span class="lineno">  814</span>  }</div>
<div class="line"><span class="lineno">  815</span> </div>
<div class="line"><span class="lineno">  816</span>  <span class="comment">// Returns true if and only if this expectation is over-saturated.</span></div>
<div class="line"><span class="lineno">  817</span>  <span class="keywordtype">bool</span> IsOverSaturated() const</div>
<div class="line"><span class="lineno">  818</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno">  819</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno">  820</span>    <span class="keywordflow">return</span> cardinality().IsOverSaturatedByCallCount(call_count_);</div>
<div class="line"><span class="lineno">  821</span>  }</div>
<div class="line"><span class="lineno">  822</span> </div>
<div class="line"><span class="lineno">  823</span>  <span class="comment">// Returns true if and only if all pre-requisites of this expectation are</span></div>
<div class="line"><span class="lineno">  824</span>  <span class="comment">// satisfied.</span></div>
<div class="line"><span class="lineno">  825</span>  <span class="keywordtype">bool</span> AllPrerequisitesAreSatisfied() const</div>
<div class="line"><span class="lineno">  826</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  827</span> </div>
<div class="line"><span class="lineno">  828</span>  <span class="comment">// Adds unsatisfied pre-requisites of this expectation to &#39;result&#39;.</span></div>
<div class="line"><span class="lineno">  829</span>  <span class="keywordtype">void</span> FindUnsatisfiedPrerequisites(ExpectationSet* result) const</div>
<div class="line"><span class="lineno">  830</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex);</div>
<div class="line"><span class="lineno">  831</span> </div>
<div class="line"><span class="lineno">  832</span>  <span class="comment">// Returns the number this expectation has been invoked.</span></div>
<div class="line"><span class="lineno">  833</span>  <span class="keywordtype">int</span> call_count() const</div>
<div class="line"><span class="lineno">  834</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno">  835</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno">  836</span>    <span class="keywordflow">return</span> call_count_;</div>
<div class="line"><span class="lineno">  837</span>  }</div>
<div class="line"><span class="lineno">  838</span> </div>
<div class="line"><span class="lineno">  839</span>  <span class="comment">// Increments the number this expectation has been invoked.</span></div>
<div class="line"><span class="lineno">  840</span>  <span class="keywordtype">void</span> IncrementCallCount()</div>
<div class="line"><span class="lineno">  841</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno">  842</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno">  843</span>    call_count_++;</div>
<div class="line"><span class="lineno">  844</span>  }</div>
<div class="line"><span class="lineno">  845</span> </div>
<div class="line"><span class="lineno">  846</span>  <span class="comment">// Checks the action count (i.e. the number of WillOnce() and</span></div>
<div class="line"><span class="lineno">  847</span>  <span class="comment">// WillRepeatedly() clauses) against the cardinality if this hasn&#39;t</span></div>
<div class="line"><span class="lineno">  848</span>  <span class="comment">// been done before.  Prints a warning if there are too many or too</span></div>
<div class="line"><span class="lineno">  849</span>  <span class="comment">// few actions.</span></div>
<div class="line"><span class="lineno">  850</span>  <span class="keywordtype">void</span> CheckActionCountIfNotDone() const</div>
<div class="line"><span class="lineno">  851</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(mutex_);</div>
<div class="line"><span class="lineno">  852</span> </div>
<div class="line"><span class="lineno">  853</span>  friend class ::<a class="code hl_namespace" href="a00309.html">testing</a>::Sequence;</div>
<div class="line"><span class="lineno">  854</span>  friend class ::<a class="code hl_namespace" href="a00309.html">testing</a>::internal::ExpectationTester;</div>
<div class="line"><span class="lineno">  855</span> </div>
<div class="line"><span class="lineno">  856</span>  template &lt;typename Function&gt;</div>
<div class="line"><span class="lineno">  857</span>  friend class TypedExpectation;</div>
<div class="line"><span class="lineno">  858</span> </div>
<div class="line"><span class="lineno">  859</span>  <span class="comment">// Implements the .Times() clause.</span></div>
<div class="line"><span class="lineno">  860</span>  <span class="keywordtype">void</span> UntypedTimes(const Cardinality&amp; a_cardinality);</div>
<div class="line"><span class="lineno">  861</span> </div>
<div class="line"><span class="lineno">  862</span>  <span class="comment">// This group of fields are part of the spec and won&#39;t change after</span></div>
<div class="line"><span class="lineno">  863</span>  <span class="comment">// an EXPECT_CALL() statement finishes.</span></div>
<div class="line"><span class="lineno">  864</span>  const <span class="keywordtype">char</span>* file_;          <span class="comment">// The file that contains the expectation.</span></div>
<div class="line"><span class="lineno">  865</span>  <span class="keywordtype">int</span> line_;                  <span class="comment">// The line number of the expectation.</span></div>
<div class="line"><span class="lineno">  866</span>  const <a class="code hl_namespace" href="a00315.html">std</a>::<span class="keywordtype">string</span> source_text_;  <span class="comment">// The EXPECT_CALL(...) source text.</span></div>
<div class="line"><span class="lineno">  867</span>  <span class="comment">// True if and only if the cardinality is specified explicitly.</span></div>
<div class="line"><span class="lineno">  868</span>  <span class="keywordtype">bool</span> cardinality_specified_;</div>
<div class="line"><span class="lineno">  869</span>  Cardinality cardinality_;            <span class="comment">// The cardinality of the expectation.</span></div>
<div class="line"><span class="lineno">  870</span>  <span class="comment">// The immediate pre-requisites (i.e. expectations that must be</span></div>
<div class="line"><span class="lineno">  871</span>  <span class="comment">// satisfied before this expectation can be matched) of this</span></div>
<div class="line"><span class="lineno">  872</span>  <span class="comment">// expectation.  We use std::shared_ptr in the set because we want an</span></div>
<div class="line"><span class="lineno">  873</span>  <span class="comment">// Expectation object to be co-owned by its FunctionMocker and its</span></div>
<div class="line"><span class="lineno">  874</span>  <span class="comment">// successors.  This allows multiple mock objects to be deleted at</span></div>
<div class="line"><span class="lineno">  875</span>  <span class="comment">// different times.</span></div>
<div class="line"><span class="lineno">  876</span>  ExpectationSet immediate_prerequisites_;</div>
<div class="line"><span class="lineno">  877</span> </div>
<div class="line"><span class="lineno">  878</span>  <span class="comment">// This group of fields are the current state of the expectation,</span></div>
<div class="line"><span class="lineno">  879</span>  <span class="comment">// and can change as the mock function is called.</span></div>
<div class="line"><span class="lineno">  880</span>  <span class="keywordtype">int</span> call_count_;  <span class="comment">// How many times this expectation has been invoked.</span></div>
<div class="line"><span class="lineno">  881</span>  <span class="keywordtype">bool</span> retired_;    <span class="comment">// True if and only if this expectation has retired.</span></div>
<div class="line"><span class="lineno">  882</span>  UntypedActions untyped_actions_;</div>
<div class="line"><span class="lineno">  883</span>  <span class="keywordtype">bool</span> extra_matcher_specified_;</div>
<div class="line"><span class="lineno">  884</span>  <span class="keywordtype">bool</span> repeated_action_specified_;  <span class="comment">// True if a WillRepeatedly() was specified.</span></div>
<div class="line"><span class="lineno">  885</span>  <span class="keywordtype">bool</span> retires_on_saturation_;</div>
<div class="line"><span class="lineno">  886</span>  Clause last_clause_;</div>
<div class="line"><span class="lineno">  887</span>  mutable <span class="keywordtype">bool</span> action_count_checked_;  <span class="comment">// Under mutex_.</span></div>
<div class="line"><span class="lineno">  888</span>  mutable Mutex mutex_;  <span class="comment">// Protects action_count_checked_.</span></div>
<div class="line"><span class="lineno">  889</span>};  <span class="comment">// class ExpectationBase</span></div>
<div class="line"><span class="lineno">  890</span> </div>
<div class="line"><span class="lineno">  891</span><span class="comment">// Implements an expectation for the given function type.</span></div>
<div class="line"><span class="lineno">  892</span>template &lt;typename F&gt;</div>
<div class="line"><span class="lineno">  893</span>class TypedExpectation : public ExpectationBase {</div>
<div class="line"><span class="lineno">  894</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">  895</span>  <span class="keyword">typedef</span> <span class="keyword">typename</span> Function&lt;F&gt;::ArgumentTuple ArgumentTuple;</div>
<div class="line"><span class="lineno">  896</span>  <span class="keyword">typedef</span> <span class="keyword">typename</span> Function&lt;F&gt;::ArgumentMatcherTuple ArgumentMatcherTuple;</div>
<div class="line"><span class="lineno">  897</span>  <span class="keyword">typedef</span> <span class="keyword">typename</span> Function&lt;F&gt;::Result Result;</div>
<div class="line"><span class="lineno">  898</span> </div>
<div class="line"><span class="lineno">  899</span>  TypedExpectation(FunctionMocker&lt;F&gt;* owner, <span class="keyword">const</span> <span class="keywordtype">char</span>* a_file, <span class="keywordtype">int</span> a_line,</div>
<div class="line"><span class="lineno">  900</span>                   <span class="keyword">const</span> std::string&amp; a_source_text,</div>
<div class="line"><span class="lineno">  901</span>                   <span class="keyword">const</span> ArgumentMatcherTuple&amp; m)</div>
<div class="line"><span class="lineno">  902</span>      : ExpectationBase(a_file, a_line, a_source_text),</div>
<div class="line"><span class="lineno">  903</span>        owner_(owner),</div>
<div class="line"><span class="lineno">  904</span>        matchers_(m),</div>
<div class="line"><span class="lineno">  905</span>        <span class="comment">// By default, extra_matcher_ should match anything.  However,</span></div>
<div class="line"><span class="lineno">  906</span>        <span class="comment">// we cannot initialize it with _ as that causes ambiguity between</span></div>
<div class="line"><span class="lineno">  907</span>        <span class="comment">// Matcher&#39;s copy and move constructor for some argument types.</span></div>
<div class="line"><span class="lineno">  908</span>        extra_matcher_(A&lt;const ArgumentTuple&amp;&gt;()),</div>
<div class="line"><span class="lineno">  909</span>        repeated_action_(<a class="code hl_function" href="a00309.html#ae041df61ff61ccb9753ba15b4309e1a6">DoDefault</a>()) {}</div>
<div class="line"><span class="lineno">  910</span> </div>
<div class="line"><span class="lineno">  911</span>  ~TypedExpectation()<span class="keyword"> override </span>{</div>
<div class="line"><span class="lineno">  912</span>    <span class="comment">// Check the validity of the action count if it hasn&#39;t been done</span></div>
<div class="line"><span class="lineno">  913</span>    <span class="comment">// yet (for example, if the expectation was never used).</span></div>
<div class="line"><span class="lineno">  914</span>    CheckActionCountIfNotDone();</div>
<div class="line"><span class="lineno">  915</span>    <span class="keywordflow">for</span> (UntypedActions::const_iterator it = untyped_actions_.begin();</div>
<div class="line"><span class="lineno">  916</span>         it != untyped_actions_.end(); ++it) {</div>
<div class="line"><span class="lineno">  917</span>      <span class="keyword">delete</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>Action&lt;F&gt;*<span class="keyword">&gt;</span>(*it);</div>
<div class="line"><span class="lineno">  918</span>    }</div>
<div class="line"><span class="lineno">  919</span>  }</div>
<div class="line"><span class="lineno">  920</span> </div>
<div class="line"><span class="lineno">  921</span>  <span class="comment">// Implements the .With() clause.</span></div>
<div class="line"><span class="lineno">  922</span>  TypedExpectation&amp; With(<span class="keyword">const</span> Matcher&lt;const ArgumentTuple&amp;&gt;&amp; m) {</div>
<div class="line"><span class="lineno">  923</span>    <span class="keywordflow">if</span> (last_clause_ == kWith) {</div>
<div class="line"><span class="lineno">  924</span>      ExpectSpecProperty(<span class="keyword">false</span>,</div>
<div class="line"><span class="lineno">  925</span>                         <span class="stringliteral">&quot;.With() cannot appear &quot;</span></div>
<div class="line"><span class="lineno">  926</span>                         <span class="stringliteral">&quot;more than once in an EXPECT_CALL().&quot;</span>);</div>
<div class="line"><span class="lineno">  927</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  928</span>      ExpectSpecProperty(last_clause_ &lt; kWith,</div>
<div class="line"><span class="lineno">  929</span>                         <span class="stringliteral">&quot;.With() must be the first &quot;</span></div>
<div class="line"><span class="lineno">  930</span>                         <span class="stringliteral">&quot;clause in an EXPECT_CALL().&quot;</span>);</div>
<div class="line"><span class="lineno">  931</span>    }</div>
<div class="line"><span class="lineno">  932</span>    last_clause_ = kWith;</div>
<div class="line"><span class="lineno">  933</span> </div>
<div class="line"><span class="lineno">  934</span>    extra_matcher_ = m;</div>
<div class="line"><span class="lineno">  935</span>    extra_matcher_specified_ = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  936</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  937</span>  }</div>
<div class="line"><span class="lineno">  938</span> </div>
<div class="line"><span class="lineno">  939</span>  <span class="comment">// Implements the .Times() clause.</span></div>
<div class="line"><span class="lineno">  940</span>  TypedExpectation&amp; Times(<span class="keyword">const</span> Cardinality&amp; a_cardinality) {</div>
<div class="line"><span class="lineno">  941</span>    ExpectationBase::UntypedTimes(a_cardinality);</div>
<div class="line"><span class="lineno">  942</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  943</span>  }</div>
<div class="line"><span class="lineno">  944</span> </div>
<div class="line"><span class="lineno">  945</span>  <span class="comment">// Implements the .Times() clause.</span></div>
<div class="line"><span class="lineno">  946</span>  TypedExpectation&amp; Times(<span class="keywordtype">int</span> n) {</div>
<div class="line"><span class="lineno">  947</span>    <span class="keywordflow">return</span> Times(Exactly(n));</div>
<div class="line"><span class="lineno">  948</span>  }</div>
<div class="line"><span class="lineno">  949</span> </div>
<div class="line"><span class="lineno">  950</span>  <span class="comment">// Implements the .InSequence() clause.</span></div>
<div class="line"><span class="lineno">  951</span>  TypedExpectation&amp; InSequence(<span class="keyword">const</span> Sequence&amp; s) {</div>
<div class="line"><span class="lineno">  952</span>    ExpectSpecProperty(last_clause_ &lt;= kInSequence,</div>
<div class="line"><span class="lineno">  953</span>                       <span class="stringliteral">&quot;.InSequence() cannot appear after .After(),&quot;</span></div>
<div class="line"><span class="lineno">  954</span>                       <span class="stringliteral">&quot; .WillOnce(), .WillRepeatedly(), or &quot;</span></div>
<div class="line"><span class="lineno">  955</span>                       <span class="stringliteral">&quot;.RetiresOnSaturation().&quot;</span>);</div>
<div class="line"><span class="lineno">  956</span>    last_clause_ = kInSequence;</div>
<div class="line"><span class="lineno">  957</span> </div>
<div class="line"><span class="lineno">  958</span>    s.AddExpectation(GetHandle());</div>
<div class="line"><span class="lineno">  959</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  960</span>  }</div>
<div class="line"><span class="lineno">  961</span>  TypedExpectation&amp; InSequence(<span class="keyword">const</span> Sequence&amp; s1, <span class="keyword">const</span> Sequence&amp; s2) {</div>
<div class="line"><span class="lineno">  962</span>    <span class="keywordflow">return</span> InSequence(s1).InSequence(s2);</div>
<div class="line"><span class="lineno">  963</span>  }</div>
<div class="line"><span class="lineno">  964</span>  TypedExpectation&amp; InSequence(<span class="keyword">const</span> Sequence&amp; s1, <span class="keyword">const</span> Sequence&amp; s2,</div>
<div class="line"><span class="lineno">  965</span>                               <span class="keyword">const</span> Sequence&amp; s3) {</div>
<div class="line"><span class="lineno">  966</span>    <span class="keywordflow">return</span> InSequence(s1, s2).InSequence(s3);</div>
<div class="line"><span class="lineno">  967</span>  }</div>
<div class="line"><span class="lineno">  968</span>  TypedExpectation&amp; InSequence(<span class="keyword">const</span> Sequence&amp; s1, <span class="keyword">const</span> Sequence&amp; s2,</div>
<div class="line"><span class="lineno">  969</span>                               <span class="keyword">const</span> Sequence&amp; s3, <span class="keyword">const</span> Sequence&amp; s4) {</div>
<div class="line"><span class="lineno">  970</span>    <span class="keywordflow">return</span> InSequence(s1, s2, s3).InSequence(s4);</div>
<div class="line"><span class="lineno">  971</span>  }</div>
<div class="line"><span class="lineno">  972</span>  TypedExpectation&amp; InSequence(<span class="keyword">const</span> Sequence&amp; s1, <span class="keyword">const</span> Sequence&amp; s2,</div>
<div class="line"><span class="lineno">  973</span>                               <span class="keyword">const</span> Sequence&amp; s3, <span class="keyword">const</span> Sequence&amp; s4,</div>
<div class="line"><span class="lineno">  974</span>                               <span class="keyword">const</span> Sequence&amp; s5) {</div>
<div class="line"><span class="lineno">  975</span>    <span class="keywordflow">return</span> InSequence(s1, s2, s3, s4).InSequence(s5);</div>
<div class="line"><span class="lineno">  976</span>  }</div>
<div class="line"><span class="lineno">  977</span> </div>
<div class="line"><span class="lineno">  978</span>  <span class="comment">// Implements that .After() clause.</span></div>
<div class="line"><span class="lineno">  979</span>  TypedExpectation&amp; After(<span class="keyword">const</span> ExpectationSet&amp; s) {</div>
<div class="line"><span class="lineno">  980</span>    ExpectSpecProperty(last_clause_ &lt;= kAfter,</div>
<div class="line"><span class="lineno">  981</span>                       <span class="stringliteral">&quot;.After() cannot appear after .WillOnce(),&quot;</span></div>
<div class="line"><span class="lineno">  982</span>                       <span class="stringliteral">&quot; .WillRepeatedly(), or &quot;</span></div>
<div class="line"><span class="lineno">  983</span>                       <span class="stringliteral">&quot;.RetiresOnSaturation().&quot;</span>);</div>
<div class="line"><span class="lineno">  984</span>    last_clause_ = kAfter;</div>
<div class="line"><span class="lineno">  985</span> </div>
<div class="line"><span class="lineno">  986</span>    <span class="keywordflow">for</span> (ExpectationSet::const_iterator it = s.begin(); it != s.end(); ++it) {</div>
<div class="line"><span class="lineno">  987</span>      immediate_prerequisites_ += *it;</div>
<div class="line"><span class="lineno">  988</span>    }</div>
<div class="line"><span class="lineno">  989</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  990</span>  }</div>
<div class="line"><span class="lineno">  991</span>  TypedExpectation&amp; After(<span class="keyword">const</span> ExpectationSet&amp; s1, <span class="keyword">const</span> ExpectationSet&amp; s2) {</div>
<div class="line"><span class="lineno">  992</span>    <span class="keywordflow">return</span> After(s1).After(s2);</div>
<div class="line"><span class="lineno">  993</span>  }</div>
<div class="line"><span class="lineno">  994</span>  TypedExpectation&amp; After(<span class="keyword">const</span> ExpectationSet&amp; s1, <span class="keyword">const</span> ExpectationSet&amp; s2,</div>
<div class="line"><span class="lineno">  995</span>                          <span class="keyword">const</span> ExpectationSet&amp; s3) {</div>
<div class="line"><span class="lineno">  996</span>    <span class="keywordflow">return</span> After(s1, s2).After(s3);</div>
<div class="line"><span class="lineno">  997</span>  }</div>
<div class="line"><span class="lineno">  998</span>  TypedExpectation&amp; After(<span class="keyword">const</span> ExpectationSet&amp; s1, <span class="keyword">const</span> ExpectationSet&amp; s2,</div>
<div class="line"><span class="lineno">  999</span>                          <span class="keyword">const</span> ExpectationSet&amp; s3, <span class="keyword">const</span> ExpectationSet&amp; s4) {</div>
<div class="line"><span class="lineno"> 1000</span>    <span class="keywordflow">return</span> After(s1, s2, s3).After(s4);</div>
<div class="line"><span class="lineno"> 1001</span>  }</div>
<div class="line"><span class="lineno"> 1002</span>  TypedExpectation&amp; After(<span class="keyword">const</span> ExpectationSet&amp; s1, <span class="keyword">const</span> ExpectationSet&amp; s2,</div>
<div class="line"><span class="lineno"> 1003</span>                          <span class="keyword">const</span> ExpectationSet&amp; s3, <span class="keyword">const</span> ExpectationSet&amp; s4,</div>
<div class="line"><span class="lineno"> 1004</span>                          <span class="keyword">const</span> ExpectationSet&amp; s5) {</div>
<div class="line"><span class="lineno"> 1005</span>    <span class="keywordflow">return</span> After(s1, s2, s3, s4).After(s5);</div>
<div class="line"><span class="lineno"> 1006</span>  }</div>
<div class="line"><span class="lineno"> 1007</span> </div>
<div class="line"><span class="lineno"> 1008</span>  <span class="comment">// Implements the .WillOnce() clause.</span></div>
<div class="line"><span class="lineno"> 1009</span>  TypedExpectation&amp; WillOnce(<span class="keyword">const</span> Action&lt;F&gt;&amp; action) {</div>
<div class="line"><span class="lineno"> 1010</span>    ExpectSpecProperty(last_clause_ &lt;= kWillOnce,</div>
<div class="line"><span class="lineno"> 1011</span>                       <span class="stringliteral">&quot;.WillOnce() cannot appear after &quot;</span></div>
<div class="line"><span class="lineno"> 1012</span>                       <span class="stringliteral">&quot;.WillRepeatedly() or .RetiresOnSaturation().&quot;</span>);</div>
<div class="line"><span class="lineno"> 1013</span>    last_clause_ = kWillOnce;</div>
<div class="line"><span class="lineno"> 1014</span> </div>
<div class="line"><span class="lineno"> 1015</span>    untyped_actions_.push_back(<span class="keyword">new</span> Action&lt;F&gt;(action));</div>
<div class="line"><span class="lineno"> 1016</span>    <span class="keywordflow">if</span> (!cardinality_specified()) {</div>
<div class="line"><span class="lineno"> 1017</span>      set_cardinality(Exactly(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(untyped_actions_.size())));</div>
<div class="line"><span class="lineno"> 1018</span>    }</div>
<div class="line"><span class="lineno"> 1019</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno"> 1020</span>  }</div>
<div class="line"><span class="lineno"> 1021</span> </div>
<div class="line"><span class="lineno"> 1022</span>  <span class="comment">// Implements the .WillRepeatedly() clause.</span></div>
<div class="line"><span class="lineno"> 1023</span>  TypedExpectation&amp; WillRepeatedly(<span class="keyword">const</span> Action&lt;F&gt;&amp; action) {</div>
<div class="line"><span class="lineno"> 1024</span>    <span class="keywordflow">if</span> (last_clause_ == kWillRepeatedly) {</div>
<div class="line"><span class="lineno"> 1025</span>      ExpectSpecProperty(<span class="keyword">false</span>,</div>
<div class="line"><span class="lineno"> 1026</span>                         <span class="stringliteral">&quot;.WillRepeatedly() cannot appear &quot;</span></div>
<div class="line"><span class="lineno"> 1027</span>                         <span class="stringliteral">&quot;more than once in an EXPECT_CALL().&quot;</span>);</div>
<div class="line"><span class="lineno"> 1028</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1029</span>      ExpectSpecProperty(last_clause_ &lt; kWillRepeatedly,</div>
<div class="line"><span class="lineno"> 1030</span>                         <span class="stringliteral">&quot;.WillRepeatedly() cannot appear &quot;</span></div>
<div class="line"><span class="lineno"> 1031</span>                         <span class="stringliteral">&quot;after .RetiresOnSaturation().&quot;</span>);</div>
<div class="line"><span class="lineno"> 1032</span>    }</div>
<div class="line"><span class="lineno"> 1033</span>    last_clause_ = kWillRepeatedly;</div>
<div class="line"><span class="lineno"> 1034</span>    repeated_action_specified_ = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1035</span> </div>
<div class="line"><span class="lineno"> 1036</span>    repeated_action_ = action;</div>
<div class="line"><span class="lineno"> 1037</span>    <span class="keywordflow">if</span> (!cardinality_specified()) {</div>
<div class="line"><span class="lineno"> 1038</span>      set_cardinality(AtLeast(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(untyped_actions_.size())));</div>
<div class="line"><span class="lineno"> 1039</span>    }</div>
<div class="line"><span class="lineno"> 1040</span> </div>
<div class="line"><span class="lineno"> 1041</span>    <span class="comment">// Now that no more action clauses can be specified, we check</span></div>
<div class="line"><span class="lineno"> 1042</span>    <span class="comment">// whether their count makes sense.</span></div>
<div class="line"><span class="lineno"> 1043</span>    CheckActionCountIfNotDone();</div>
<div class="line"><span class="lineno"> 1044</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno"> 1045</span>  }</div>
<div class="line"><span class="lineno"> 1046</span> </div>
<div class="line"><span class="lineno"> 1047</span>  <span class="comment">// Implements the .RetiresOnSaturation() clause.</span></div>
<div class="line"><span class="lineno"> 1048</span>  TypedExpectation&amp; RetiresOnSaturation() {</div>
<div class="line"><span class="lineno"> 1049</span>    ExpectSpecProperty(last_clause_ &lt; kRetiresOnSaturation,</div>
<div class="line"><span class="lineno"> 1050</span>                       <span class="stringliteral">&quot;.RetiresOnSaturation() cannot appear &quot;</span></div>
<div class="line"><span class="lineno"> 1051</span>                       <span class="stringliteral">&quot;more than once.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1052</span>    last_clause_ = kRetiresOnSaturation;</div>
<div class="line"><span class="lineno"> 1053</span>    retires_on_saturation_ = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1054</span> </div>
<div class="line"><span class="lineno"> 1055</span>    <span class="comment">// Now that no more action clauses can be specified, we check</span></div>
<div class="line"><span class="lineno"> 1056</span>    <span class="comment">// whether their count makes sense.</span></div>
<div class="line"><span class="lineno"> 1057</span>    CheckActionCountIfNotDone();</div>
<div class="line"><span class="lineno"> 1058</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno"> 1059</span>  }</div>
<div class="line"><span class="lineno"> 1060</span> </div>
<div class="line"><span class="lineno"> 1061</span>  <span class="comment">// Returns the matchers for the arguments as specified inside the</span></div>
<div class="line"><span class="lineno"> 1062</span>  <span class="comment">// EXPECT_CALL() macro.</span></div>
<div class="line"><span class="lineno"> 1063</span>  <span class="keyword">const</span> ArgumentMatcherTuple&amp; matchers()<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno"> 1064</span>    <span class="keywordflow">return</span> matchers_;</div>
<div class="line"><span class="lineno"> 1065</span>  }</div>
<div class="line"><span class="lineno"> 1066</span> </div>
<div class="line"><span class="lineno"> 1067</span>  <span class="comment">// Returns the matcher specified by the .With() clause.</span></div>
<div class="line"><span class="lineno"> 1068</span>  <span class="keyword">const</span> Matcher&lt;const ArgumentTuple&amp;&gt;&amp; extra_matcher()<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno"> 1069</span>    <span class="keywordflow">return</span> extra_matcher_;</div>
<div class="line"><span class="lineno"> 1070</span>  }</div>
<div class="line"><span class="lineno"> 1071</span> </div>
<div class="line"><span class="lineno"> 1072</span>  <span class="comment">// Returns the action specified by the .WillRepeatedly() clause.</span></div>
<div class="line"><span class="lineno"> 1073</span>  <span class="keyword">const</span> Action&lt;F&gt;&amp; repeated_action()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> repeated_action_; }</div>
<div class="line"><span class="lineno"> 1074</span> </div>
<div class="line"><span class="lineno"> 1075</span>  <span class="comment">// If this mock method has an extra matcher (i.e. .With(matcher)),</span></div>
<div class="line"><span class="lineno"> 1076</span>  <span class="comment">// describes it to the ostream.</span></div>
<div class="line"><span class="lineno"> 1077</span>  <span class="keywordtype">void</span> MaybeDescribeExtraMatcherTo(::std::ostream* os)<span class="keyword"> override </span>{</div>
<div class="line"><span class="lineno"> 1078</span>    <span class="keywordflow">if</span> (extra_matcher_specified_) {</div>
<div class="line"><span class="lineno"> 1079</span>      *os &lt;&lt; <span class="stringliteral">&quot;    Expected args: &quot;</span>;</div>
<div class="line"><span class="lineno"> 1080</span>      extra_matcher_.DescribeTo(os);</div>
<div class="line"><span class="lineno"> 1081</span>      *os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1082</span>    }</div>
<div class="line"><span class="lineno"> 1083</span>  }</div>
<div class="line"><span class="lineno"> 1084</span> </div>
<div class="line"><span class="lineno"> 1085</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno"> 1086</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Function&gt;</div>
<div class="line"><span class="lineno"> 1087</span>  <span class="keyword">friend</span> <span class="keyword">class </span>FunctionMocker;</div>
<div class="line"><span class="lineno"> 1088</span> </div>
<div class="line"><span class="lineno"> 1089</span>  <span class="comment">// Returns an Expectation object that references and co-owns this</span></div>
<div class="line"><span class="lineno"> 1090</span>  <span class="comment">// expectation.</span></div>
<div class="line"><span class="lineno"> 1091</span>  Expectation GetHandle()<span class="keyword"> override </span>{ <span class="keywordflow">return</span> owner_-&gt;GetHandleOf(<span class="keyword">this</span>); }</div>
<div class="line"><span class="lineno"> 1092</span> </div>
<div class="line"><span class="lineno"> 1093</span>  <span class="comment">// The following methods will be called only after the EXPECT_CALL()</span></div>
<div class="line"><span class="lineno"> 1094</span>  <span class="comment">// statement finishes and when the current thread holds</span></div>
<div class="line"><span class="lineno"> 1095</span>  <span class="comment">// g_gmock_mutex.</span></div>
<div class="line"><span class="lineno"> 1096</span> </div>
<div class="line"><span class="lineno"> 1097</span>  <span class="comment">// Returns true if and only if this expectation matches the given arguments.</span></div>
<div class="line"><span class="lineno"> 1098</span>  <span class="keywordtype">bool</span> Matches(<span class="keyword">const</span> ArgumentTuple&amp; args) <span class="keyword">const</span></div>
<div class="line"><span class="lineno"> 1099</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1100</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1101</span>    <span class="keywordflow">return</span> TupleMatches(matchers_, args) &amp;&amp; extra_matcher_.Matches(args);</div>
<div class="line"><span class="lineno"> 1102</span>  }</div>
<div class="line"><span class="lineno"> 1103</span> </div>
<div class="line"><span class="lineno"> 1104</span>  <span class="comment">// Returns true if and only if this expectation should handle the given</span></div>
<div class="line"><span class="lineno"> 1105</span>  <span class="comment">// arguments.</span></div>
<div class="line"><span class="lineno"> 1106</span>  <span class="keywordtype">bool</span> ShouldHandleArguments(<span class="keyword">const</span> ArgumentTuple&amp; args) <span class="keyword">const</span></div>
<div class="line"><span class="lineno"> 1107</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1108</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1109</span> </div>
<div class="line"><span class="lineno"> 1110</span>    <span class="comment">// In case the action count wasn&#39;t checked when the expectation</span></div>
<div class="line"><span class="lineno"> 1111</span>    <span class="comment">// was defined (e.g. if this expectation has no WillRepeatedly()</span></div>
<div class="line"><span class="lineno"> 1112</span>    <span class="comment">// or RetiresOnSaturation() clause), we check it when the</span></div>
<div class="line"><span class="lineno"> 1113</span>    <span class="comment">// expectation is used for the first time.</span></div>
<div class="line"><span class="lineno"> 1114</span>    CheckActionCountIfNotDone();</div>
<div class="line"><span class="lineno"> 1115</span>    <span class="keywordflow">return</span> !is_retired() &amp;&amp; AllPrerequisitesAreSatisfied() &amp;&amp; Matches(args);</div>
<div class="line"><span class="lineno"> 1116</span>  }</div>
<div class="line"><span class="lineno"> 1117</span> </div>
<div class="line"><span class="lineno"> 1118</span>  <span class="comment">// Describes the result of matching the arguments against this</span></div>
<div class="line"><span class="lineno"> 1119</span>  <span class="comment">// expectation to the given ostream.</span></div>
<div class="line"><span class="lineno"> 1120</span>  <span class="keywordtype">void</span> ExplainMatchResultTo(</div>
<div class="line"><span class="lineno"> 1121</span>      <span class="keyword">const</span> ArgumentTuple&amp; args,</div>
<div class="line"><span class="lineno"> 1122</span>      ::std::ostream* os) <span class="keyword">const</span></div>
<div class="line"><span class="lineno"> 1123</span>          <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1124</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1125</span> </div>
<div class="line"><span class="lineno"> 1126</span>    <span class="keywordflow">if</span> (is_retired()) {</div>
<div class="line"><span class="lineno"> 1127</span>      *os &lt;&lt; <span class="stringliteral">&quot;         Expected: the expectation is active\n&quot;</span></div>
<div class="line"><span class="lineno"> 1128</span>          &lt;&lt; <span class="stringliteral">&quot;           Actual: it is retired\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1129</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!Matches(args)) {</div>
<div class="line"><span class="lineno"> 1130</span>      <span class="keywordflow">if</span> (!TupleMatches(matchers_, args)) {</div>
<div class="line"><span class="lineno"> 1131</span>        ExplainMatchFailureTupleTo(matchers_, args, os);</div>
<div class="line"><span class="lineno"> 1132</span>      }</div>
<div class="line"><span class="lineno"> 1133</span>      StringMatchResultListener listener;</div>
<div class="line"><span class="lineno"> 1134</span>      <span class="keywordflow">if</span> (!extra_matcher_.MatchAndExplain(args, &amp;listener)) {</div>
<div class="line"><span class="lineno"> 1135</span>        *os &lt;&lt; <span class="stringliteral">&quot;    Expected args: &quot;</span>;</div>
<div class="line"><span class="lineno"> 1136</span>        extra_matcher_.DescribeTo(os);</div>
<div class="line"><span class="lineno"> 1137</span>        *os &lt;&lt; <span class="stringliteral">&quot;\n           Actual: don&#39;t match&quot;</span>;</div>
<div class="line"><span class="lineno"> 1138</span> </div>
<div class="line"><span class="lineno"> 1139</span>        internal::PrintIfNotEmpty(listener.str(), os);</div>
<div class="line"><span class="lineno"> 1140</span>        *os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1141</span>      }</div>
<div class="line"><span class="lineno"> 1142</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!AllPrerequisitesAreSatisfied()) {</div>
<div class="line"><span class="lineno"> 1143</span>      *os &lt;&lt; <span class="stringliteral">&quot;         Expected: all pre-requisites are satisfied\n&quot;</span></div>
<div class="line"><span class="lineno"> 1144</span>          &lt;&lt; <span class="stringliteral">&quot;           Actual: the following immediate pre-requisites &quot;</span></div>
<div class="line"><span class="lineno"> 1145</span>          &lt;&lt; <span class="stringliteral">&quot;are not satisfied:\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1146</span>      ExpectationSet unsatisfied_prereqs;</div>
<div class="line"><span class="lineno"> 1147</span>      FindUnsatisfiedPrerequisites(&amp;unsatisfied_prereqs);</div>
<div class="line"><span class="lineno"> 1148</span>      <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><span class="lineno"> 1149</span>      <span class="keywordflow">for</span> (ExpectationSet::const_iterator it = unsatisfied_prereqs.begin();</div>
<div class="line"><span class="lineno"> 1150</span>           it != unsatisfied_prereqs.end(); ++it) {</div>
<div class="line"><span class="lineno"> 1151</span>        it-&gt;expectation_base()-&gt;DescribeLocationTo(os);</div>
<div class="line"><span class="lineno"> 1152</span>        *os &lt;&lt; <span class="stringliteral">&quot;pre-requisite #&quot;</span> &lt;&lt; i++ &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1153</span>      }</div>
<div class="line"><span class="lineno"> 1154</span>      *os &lt;&lt; <span class="stringliteral">&quot;                   (end of pre-requisites)\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1155</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1156</span>      <span class="comment">// This line is here just for completeness&#39; sake.  It will never</span></div>
<div class="line"><span class="lineno"> 1157</span>      <span class="comment">// be executed as currently the ExplainMatchResultTo() function</span></div>
<div class="line"><span class="lineno"> 1158</span>      <span class="comment">// is called only when the mock function call does NOT match the</span></div>
<div class="line"><span class="lineno"> 1159</span>      <span class="comment">// expectation.</span></div>
<div class="line"><span class="lineno"> 1160</span>      *os &lt;&lt; <span class="stringliteral">&quot;The call matches the expectation.\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1161</span>    }</div>
<div class="line"><span class="lineno"> 1162</span>  }</div>
<div class="line"><span class="lineno"> 1163</span> </div>
<div class="line"><span class="lineno"> 1164</span>  <span class="comment">// Returns the action that should be taken for the current invocation.</span></div>
<div class="line"><span class="lineno"> 1165</span>  <span class="keyword">const</span> Action&lt;F&gt;&amp; GetCurrentAction(<span class="keyword">const</span> FunctionMocker&lt;F&gt;* mocker,</div>
<div class="line"><span class="lineno"> 1166</span>                                    <span class="keyword">const</span> ArgumentTuple&amp; args) <span class="keyword">const</span></div>
<div class="line"><span class="lineno"> 1167</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1168</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1169</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> count = call_count();</div>
<div class="line"><span class="lineno"> 1170</span>    <a class="code hl_function" href="a00310.html#aa46ca46a5898b2ac75184c62e0355621">Assert</a>(count &gt;= 1, __FILE__, __LINE__,</div>
<div class="line"><span class="lineno"> 1171</span>           <span class="stringliteral">&quot;call_count() is &lt;= 0 when GetCurrentAction() is &quot;</span></div>
<div class="line"><span class="lineno"> 1172</span>           <span class="stringliteral">&quot;called - this should never happen.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1173</span> </div>
<div class="line"><span class="lineno"> 1174</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> action_count = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(untyped_actions_.size());</div>
<div class="line"><span class="lineno"> 1175</span>    <span class="keywordflow">if</span> (action_count &gt; 0 &amp;&amp; !repeated_action_specified_ &amp;&amp;</div>
<div class="line"><span class="lineno"> 1176</span>        count &gt; action_count) {</div>
<div class="line"><span class="lineno"> 1177</span>      <span class="comment">// If there is at least one WillOnce() and no WillRepeatedly(),</span></div>
<div class="line"><span class="lineno"> 1178</span>      <span class="comment">// we warn the user when the WillOnce() clauses ran out.</span></div>
<div class="line"><span class="lineno"> 1179</span>      ::std::stringstream ss;</div>
<div class="line"><span class="lineno"> 1180</span>      DescribeLocationTo(&amp;ss);</div>
<div class="line"><span class="lineno"> 1181</span>      ss &lt;&lt; <span class="stringliteral">&quot;Actions ran out in &quot;</span> &lt;&lt; source_text() &lt;&lt; <span class="stringliteral">&quot;...\n&quot;</span></div>
<div class="line"><span class="lineno"> 1182</span>         &lt;&lt; <span class="stringliteral">&quot;Called &quot;</span> &lt;&lt; count &lt;&lt; <span class="stringliteral">&quot; times, but only &quot;</span></div>
<div class="line"><span class="lineno"> 1183</span>         &lt;&lt; action_count &lt;&lt; <span class="stringliteral">&quot; WillOnce()&quot;</span></div>
<div class="line"><span class="lineno"> 1184</span>         &lt;&lt; (action_count == 1 ? <span class="stringliteral">&quot; is&quot;</span> : <span class="stringliteral">&quot;s are&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; specified - &quot;</span>;</div>
<div class="line"><span class="lineno"> 1185</span>      mocker-&gt;DescribeDefaultActionTo(args, &amp;ss);</div>
<div class="line"><span class="lineno"> 1186</span>      <a class="code hl_function" href="a00310.html#a8a57ce0412334a3f487bbaa8321febbe">Log</a>(<a class="code hl_enumvalue" href="a00310.html#a203d1a8a2147a53d12bbdae40d443914a5beeeab1b0a3caabd0afb43356c1a271">kWarning</a>, ss.str(), 1);</div>
<div class="line"><span class="lineno"> 1187</span>    }</div>
<div class="line"><span class="lineno"> 1188</span> </div>
<div class="line"><span class="lineno"> 1189</span>    <span class="keywordflow">return</span> count &lt;= action_count</div>
<div class="line"><span class="lineno"> 1190</span>               ? *<span class="keyword">static_cast&lt;</span><span class="keyword">const </span>Action&lt;F&gt;*<span class="keyword">&gt;</span>(</div>
<div class="line"><span class="lineno"> 1191</span>                     untyped_actions_[<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(count - 1)])</div>
<div class="line"><span class="lineno"> 1192</span>               : repeated_action();</div>
<div class="line"><span class="lineno"> 1193</span>  }</div>
<div class="line"><span class="lineno"> 1194</span> </div>
<div class="line"><span class="lineno"> 1195</span>  <span class="comment">// Given the arguments of a mock function call, if the call will</span></div>
<div class="line"><span class="lineno"> 1196</span>  <span class="comment">// over-saturate this expectation, returns the default action;</span></div>
<div class="line"><span class="lineno"> 1197</span>  <span class="comment">// otherwise, returns the next action in this expectation.  Also</span></div>
<div class="line"><span class="lineno"> 1198</span>  <span class="comment">// describes *what* happened to &#39;what&#39;, and explains *why* Google</span></div>
<div class="line"><span class="lineno"> 1199</span>  <span class="comment">// Mock does it to &#39;why&#39;.  This method is not const as it calls</span></div>
<div class="line"><span class="lineno"> 1200</span>  <span class="comment">// IncrementCallCount().  A return value of NULL means the default</span></div>
<div class="line"><span class="lineno"> 1201</span>  <span class="comment">// action.</span></div>
<div class="line"><span class="lineno"> 1202</span>  <span class="keyword">const</span> Action&lt;F&gt;* GetActionForArguments(<span class="keyword">const</span> FunctionMocker&lt;F&gt;* mocker,</div>
<div class="line"><span class="lineno"> 1203</span>                                         <span class="keyword">const</span> ArgumentTuple&amp; args,</div>
<div class="line"><span class="lineno"> 1204</span>                                         ::std::ostream* what,</div>
<div class="line"><span class="lineno"> 1205</span>                                         ::std::ostream* why)</div>
<div class="line"><span class="lineno"> 1206</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1207</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1208</span>    <span class="keywordflow">if</span> (IsSaturated()) {</div>
<div class="line"><span class="lineno"> 1209</span>      <span class="comment">// We have an excessive call.</span></div>
<div class="line"><span class="lineno"> 1210</span>      IncrementCallCount();</div>
<div class="line"><span class="lineno"> 1211</span>      *what &lt;&lt; <span class="stringliteral">&quot;Mock function called more times than expected - &quot;</span>;</div>
<div class="line"><span class="lineno"> 1212</span>      mocker-&gt;DescribeDefaultActionTo(args, what);</div>
<div class="line"><span class="lineno"> 1213</span>      DescribeCallCountTo(why);</div>
<div class="line"><span class="lineno"> 1214</span> </div>
<div class="line"><span class="lineno"> 1215</span>      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1216</span>    }</div>
<div class="line"><span class="lineno"> 1217</span> </div>
<div class="line"><span class="lineno"> 1218</span>    IncrementCallCount();</div>
<div class="line"><span class="lineno"> 1219</span>    RetireAllPreRequisites();</div>
<div class="line"><span class="lineno"> 1220</span> </div>
<div class="line"><span class="lineno"> 1221</span>    <span class="keywordflow">if</span> (retires_on_saturation_ &amp;&amp; IsSaturated()) {</div>
<div class="line"><span class="lineno"> 1222</span>      Retire();</div>
<div class="line"><span class="lineno"> 1223</span>    }</div>
<div class="line"><span class="lineno"> 1224</span> </div>
<div class="line"><span class="lineno"> 1225</span>    <span class="comment">// Must be done after IncrementCount()!</span></div>
<div class="line"><span class="lineno"> 1226</span>    *what &lt;&lt; <span class="stringliteral">&quot;Mock function call matches &quot;</span> &lt;&lt; source_text() &lt;&lt;<span class="stringliteral">&quot;...\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1227</span>    <span class="keywordflow">return</span> &amp;(GetCurrentAction(mocker, args));</div>
<div class="line"><span class="lineno"> 1228</span>  }</div>
<div class="line"><span class="lineno"> 1229</span> </div>
<div class="line"><span class="lineno"> 1230</span>  <span class="comment">// All the fields below won&#39;t change once the EXPECT_CALL()</span></div>
<div class="line"><span class="lineno"> 1231</span>  <span class="comment">// statement finishes.</span></div>
<div class="line"><span class="lineno"> 1232</span>  FunctionMocker&lt;F&gt;* <span class="keyword">const</span> owner_;</div>
<div class="line"><span class="lineno"> 1233</span>  ArgumentMatcherTuple matchers_;</div>
<div class="line"><span class="lineno"> 1234</span>  Matcher&lt;const ArgumentTuple&amp;&gt; extra_matcher_;</div>
<div class="line"><span class="lineno"> 1235</span>  Action&lt;F&gt; repeated_action_;</div>
<div class="line"><span class="lineno"> 1236</span> </div>
<div class="line"><span class="lineno"> 1237</span>  <a class="code hl_define" href="a00281.html#aed8c1888c32b588b0681e88b95031e29">GTEST_DISALLOW_COPY_AND_ASSIGN_</a>(TypedExpectation);</div>
<div class="line"><span class="lineno"> 1238</span>};  <span class="comment">// class TypedExpectation</span></div>
<div class="line"><span class="lineno"> 1239</span> </div>
<div class="line"><span class="lineno"> 1240</span><span class="comment">// A MockSpec object is used by ON_CALL() or EXPECT_CALL() for</span></div>
<div class="line"><span class="lineno"> 1241</span><span class="comment">// specifying the default behavior of, or expectation on, a mock</span></div>
<div class="line"><span class="lineno"> 1242</span><span class="comment">// function.</span></div>
<div class="line"><span class="lineno"> 1243</span> </div>
<div class="line"><span class="lineno"> 1244</span><span class="comment">// Note: class MockSpec really belongs to the ::testing namespace.</span></div>
<div class="line"><span class="lineno"> 1245</span><span class="comment">// However if we define it in ::testing, MSVC will complain when</span></div>
<div class="line"><span class="lineno"> 1246</span><span class="comment">// classes in ::testing::internal declare it as a friend class</span></div>
<div class="line"><span class="lineno"> 1247</span><span class="comment">// template.  To workaround this compiler bug, we define MockSpec in</span></div>
<div class="line"><span class="lineno"> 1248</span><span class="comment">// ::testing::internal and import it into ::testing.</span></div>
<div class="line"><span class="lineno"> 1249</span> </div>
<div class="line"><span class="lineno"> 1250</span><span class="comment">// Logs a message including file and line number information.</span></div>
<div class="line"><span class="lineno"> 1251</span><a class="code hl_define" href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a> <span class="keywordtype">void</span> LogWithLocation(<a class="code hl_enumeration" href="a00310.html#a203d1a8a2147a53d12bbdae40d443914">testing::internal::LogSeverity</a> severity,</div>
<div class="line"><span class="lineno"> 1252</span>                                <span class="keyword">const</span> <span class="keywordtype">char</span>* file, <span class="keywordtype">int</span> line,</div>
<div class="line"><span class="lineno"> 1253</span>                                <span class="keyword">const</span> std::string&amp; message);</div>
<div class="line"><span class="lineno"> 1254</span> </div>
<div class="line"><span class="lineno"> 1255</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1256</span><span class="keyword">class </span>MockSpec {</div>
<div class="line"><span class="lineno"> 1257</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1258</span>  <span class="keyword">typedef</span> <span class="keyword">typename</span> internal::Function&lt;F&gt;::ArgumentTuple ArgumentTuple;</div>
<div class="line"><span class="lineno"> 1259</span>  <span class="keyword">typedef</span> <span class="keyword">typename</span> internal::Function&lt;F&gt;::ArgumentMatcherTuple</div>
<div class="line"><span class="lineno"> 1260</span>      ArgumentMatcherTuple;</div>
<div class="line"><span class="lineno"> 1261</span> </div>
<div class="line"><span class="lineno"> 1262</span>  <span class="comment">// Constructs a MockSpec object, given the function mocker object</span></div>
<div class="line"><span class="lineno"> 1263</span>  <span class="comment">// that the spec is associated with.</span></div>
<div class="line"><span class="lineno"> 1264</span>  MockSpec(internal::FunctionMocker&lt;F&gt;* function_mocker,</div>
<div class="line"><span class="lineno"> 1265</span>           <span class="keyword">const</span> ArgumentMatcherTuple&amp; matchers)</div>
<div class="line"><span class="lineno"> 1266</span>      : function_mocker_(function_mocker), matchers_(matchers) {}</div>
<div class="line"><span class="lineno"> 1267</span> </div>
<div class="line"><span class="lineno"> 1268</span>  <span class="comment">// Adds a new default action spec to the function mocker and returns</span></div>
<div class="line"><span class="lineno"> 1269</span>  <span class="comment">// the newly created spec.</span></div>
<div class="line"><span class="lineno"> 1270</span>  internal::OnCallSpec&lt;F&gt;&amp; InternalDefaultActionSetAt(</div>
<div class="line"><span class="lineno"> 1271</span>      <span class="keyword">const</span> <span class="keywordtype">char</span>* file, <span class="keywordtype">int</span> line, <span class="keyword">const</span> <span class="keywordtype">char</span>* obj, <span class="keyword">const</span> <span class="keywordtype">char</span>* call) {</div>
<div class="line"><span class="lineno"> 1272</span>    LogWithLocation(<a class="code hl_enumvalue" href="a00310.html#a203d1a8a2147a53d12bbdae40d443914a396aacfaee2849eaab7c1de9773d624d">internal::kInfo</a>, file, line,</div>
<div class="line"><span class="lineno"> 1273</span>                    std::string(<span class="stringliteral">&quot;ON_CALL(&quot;</span>) + obj + <span class="stringliteral">&quot;, &quot;</span> + call + <span class="stringliteral">&quot;) invoked&quot;</span>);</div>
<div class="line"><span class="lineno"> 1274</span>    <span class="keywordflow">return</span> function_mocker_-&gt;AddNewOnCallSpec(file, line, matchers_);</div>
<div class="line"><span class="lineno"> 1275</span>  }</div>
<div class="line"><span class="lineno"> 1276</span> </div>
<div class="line"><span class="lineno"> 1277</span>  <span class="comment">// Adds a new expectation spec to the function mocker and returns</span></div>
<div class="line"><span class="lineno"> 1278</span>  <span class="comment">// the newly created spec.</span></div>
<div class="line"><span class="lineno"> 1279</span>  internal::TypedExpectation&lt;F&gt;&amp; InternalExpectedAt(</div>
<div class="line"><span class="lineno"> 1280</span>      <span class="keyword">const</span> <span class="keywordtype">char</span>* file, <span class="keywordtype">int</span> line, <span class="keyword">const</span> <span class="keywordtype">char</span>* obj, <span class="keyword">const</span> <span class="keywordtype">char</span>* call) {</div>
<div class="line"><span class="lineno"> 1281</span>    <span class="keyword">const</span> std::string source_text(std::string(<span class="stringliteral">&quot;EXPECT_CALL(&quot;</span>) + obj + <span class="stringliteral">&quot;, &quot;</span> +</div>
<div class="line"><span class="lineno"> 1282</span>                                  call + <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno"> 1283</span>    LogWithLocation(<a class="code hl_enumvalue" href="a00310.html#a203d1a8a2147a53d12bbdae40d443914a396aacfaee2849eaab7c1de9773d624d">internal::kInfo</a>, file, line, source_text + <span class="stringliteral">&quot; invoked&quot;</span>);</div>
<div class="line"><span class="lineno"> 1284</span>    <span class="keywordflow">return</span> function_mocker_-&gt;AddNewExpectation(</div>
<div class="line"><span class="lineno"> 1285</span>        file, line, source_text, matchers_);</div>
<div class="line"><span class="lineno"> 1286</span>  }</div>
<div class="line"><span class="lineno"> 1287</span> </div>
<div class="line"><span class="lineno"> 1288</span>  <span class="comment">// This operator overload is used to swallow the superfluous parameter list</span></div>
<div class="line"><span class="lineno"> 1289</span>  <span class="comment">// introduced by the ON/EXPECT_CALL macros. See the macro comments for more</span></div>
<div class="line"><span class="lineno"> 1290</span>  <span class="comment">// explanation.</span></div>
<div class="line"><span class="lineno"> 1291</span>  MockSpec&lt;F&gt;&amp; operator()(<span class="keyword">const</span> internal::WithoutMatchers&amp;, <span class="keywordtype">void</span>* <span class="keyword">const</span>) {</div>
<div class="line"><span class="lineno"> 1292</span>    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno"> 1293</span>  }</div>
<div class="line"><span class="lineno"> 1294</span> </div>
<div class="line"><span class="lineno"> 1295</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno"> 1296</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Function&gt;</div>
<div class="line"><span class="lineno"> 1297</span>  <span class="keyword">friend</span> <span class="keyword">class </span>internal::FunctionMocker;</div>
<div class="line"><span class="lineno"> 1298</span> </div>
<div class="line"><span class="lineno"> 1299</span>  <span class="comment">// The function mocker that owns this spec.</span></div>
<div class="line"><span class="lineno"> 1300</span>  internal::FunctionMocker&lt;F&gt;* <span class="keyword">const</span> function_mocker_;</div>
<div class="line"><span class="lineno"> 1301</span>  <span class="comment">// The argument matchers specified in the spec.</span></div>
<div class="line"><span class="lineno"> 1302</span>  ArgumentMatcherTuple matchers_;</div>
<div class="line"><span class="lineno"> 1303</span>};  <span class="comment">// class MockSpec</span></div>
<div class="line"><span class="lineno"> 1304</span> </div>
<div class="line"><span class="lineno"> 1305</span><span class="comment">// Wrapper type for generically holding an ordinary value or lvalue reference.</span></div>
<div class="line"><span class="lineno"> 1306</span><span class="comment">// If T is not a reference type, it must be copyable or movable.</span></div>
<div class="line"><span class="lineno"> 1307</span><span class="comment">// ReferenceOrValueWrapper&lt;T&gt; is movable, and will also be copyable unless</span></div>
<div class="line"><span class="lineno"> 1308</span><span class="comment">// T is a move-only value type (which means that it will always be copyable</span></div>
<div class="line"><span class="lineno"> 1309</span><span class="comment">// if the current platform does not support move semantics).</span></div>
<div class="line"><span class="lineno"> 1310</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1311</span><span class="comment">// The primary template defines handling for values, but function header</span></div>
<div class="line"><span class="lineno"> 1312</span><span class="comment">// comments describe the contract for the whole template (including</span></div>
<div class="line"><span class="lineno"> 1313</span><span class="comment">// specializations).</span></div>
<div class="line"><span class="lineno"> 1314</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="lineno"> 1315</span><span class="keyword">class </span>ReferenceOrValueWrapper {</div>
<div class="line"><span class="lineno"> 1316</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1317</span>  <span class="comment">// Constructs a wrapper from the given value/reference.</span></div>
<div class="line"><span class="lineno"> 1318</span>  <span class="keyword">explicit</span> ReferenceOrValueWrapper(T value)</div>
<div class="line"><span class="lineno"> 1319</span>      : value_(<a class="code hl_namespace" href="a00315.html">std</a>::move(value)) {</div>
<div class="line"><span class="lineno"> 1320</span>  }</div>
<div class="line"><span class="lineno"> 1321</span> </div>
<div class="line"><span class="lineno"> 1322</span>  <span class="comment">// Unwraps and returns the underlying value/reference, exactly as</span></div>
<div class="line"><span class="lineno"> 1323</span>  <span class="comment">// originally passed. The behavior of calling this more than once on</span></div>
<div class="line"><span class="lineno"> 1324</span>  <span class="comment">// the same object is unspecified.</span></div>
<div class="line"><span class="lineno"> 1325</span>  T Unwrap() { <span class="keywordflow">return</span> std::move(value_); }</div>
<div class="line"><span class="lineno"> 1326</span> </div>
<div class="line"><span class="lineno"> 1327</span>  <span class="comment">// Provides nondestructive access to the underlying value/reference.</span></div>
<div class="line"><span class="lineno"> 1328</span>  <span class="comment">// Always returns a const reference (more precisely,</span></div>
<div class="line"><span class="lineno"> 1329</span>  <span class="comment">// const std::add_lvalue_reference&lt;T&gt;::type). The behavior of calling this</span></div>
<div class="line"><span class="lineno"> 1330</span>  <span class="comment">// after calling Unwrap on the same object is unspecified.</span></div>
<div class="line"><span class="lineno"> 1331</span>  <span class="keyword">const</span> T&amp; Peek()<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno"> 1332</span>    <span class="keywordflow">return</span> value_;</div>
<div class="line"><span class="lineno"> 1333</span>  }</div>
<div class="line"><span class="lineno"> 1334</span> </div>
<div class="line"><span class="lineno"> 1335</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno"> 1336</span>  T value_;</div>
<div class="line"><span class="lineno"> 1337</span>};</div>
<div class="line"><span class="lineno"> 1338</span> </div>
<div class="line"><span class="lineno"> 1339</span><span class="comment">// Specialization for lvalue reference types. See primary template</span></div>
<div class="line"><span class="lineno"> 1340</span><span class="comment">// for documentation.</span></div>
<div class="line"><span class="lineno"> 1341</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="lineno"> 1342</span><span class="keyword">class </span>ReferenceOrValueWrapper&lt;T&amp;&gt; {</div>
<div class="line"><span class="lineno"> 1343</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1344</span>  <span class="comment">// Workaround for debatable pass-by-reference lint warning (c-library-team</span></div>
<div class="line"><span class="lineno"> 1345</span>  <span class="comment">// policy precludes NOLINT in this context)</span></div>
<div class="line"><span class="lineno"> 1346</span>  <span class="keyword">typedef</span> T&amp; reference;</div>
<div class="line"><span class="lineno"> 1347</span>  <span class="keyword">explicit</span> ReferenceOrValueWrapper(reference ref)</div>
<div class="line"><span class="lineno"> 1348</span>      : value_ptr_(&amp;ref) {}</div>
<div class="line"><span class="lineno"> 1349</span>  T&amp; Unwrap() { <span class="keywordflow">return</span> *value_ptr_; }</div>
<div class="line"><span class="lineno"> 1350</span>  <span class="keyword">const</span> T&amp; Peek()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *value_ptr_; }</div>
<div class="line"><span class="lineno"> 1351</span> </div>
<div class="line"><span class="lineno"> 1352</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno"> 1353</span>  T* value_ptr_;</div>
<div class="line"><span class="lineno"> 1354</span>};</div>
<div class="line"><span class="lineno"> 1355</span> </div>
<div class="line"><span class="lineno"> 1356</span><span class="comment">// C++ treats the void type specially.  For example, you cannot define</span></div>
<div class="line"><span class="lineno"> 1357</span><span class="comment">// a void-typed variable or pass a void value to a function.</span></div>
<div class="line"><span class="lineno"> 1358</span><span class="comment">// ActionResultHolder&lt;T&gt; holds a value of type T, where T must be a</span></div>
<div class="line"><span class="lineno"> 1359</span><span class="comment">// copyable type or void (T doesn&#39;t need to be default-constructable).</span></div>
<div class="line"><span class="lineno"> 1360</span><span class="comment">// It hides the syntactic difference between void and other types, and</span></div>
<div class="line"><span class="lineno"> 1361</span><span class="comment">// is used to unify the code for invoking both void-returning and</span></div>
<div class="line"><span class="lineno"> 1362</span><span class="comment">// non-void-returning mock functions.</span></div>
<div class="line"><span class="lineno"> 1363</span> </div>
<div class="line"><span class="lineno"> 1364</span><span class="comment">// Untyped base class for ActionResultHolder&lt;T&gt;.</span></div>
<div class="line"><span class="lineno"> 1365</span><span class="keyword">class </span>UntypedActionResultHolderBase {</div>
<div class="line"><span class="lineno"> 1366</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1367</span>  <span class="keyword">virtual</span> ~UntypedActionResultHolderBase() {}</div>
<div class="line"><span class="lineno"> 1368</span> </div>
<div class="line"><span class="lineno"> 1369</span>  <span class="comment">// Prints the held value as an action&#39;s result to os.</span></div>
<div class="line"><span class="lineno"> 1370</span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> PrintAsActionResult(::std::ostream* os) <span class="keyword">const</span> = 0;</div>
<div class="line"><span class="lineno"> 1371</span>};</div>
<div class="line"><span class="lineno"> 1372</span> </div>
<div class="line"><span class="lineno"> 1373</span><span class="comment">// This generic definition is used when T is not void.</span></div>
<div class="line"><span class="lineno"> 1374</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="lineno"> 1375</span><span class="keyword">class </span>ActionResultHolder : <span class="keyword">public</span> UntypedActionResultHolderBase {</div>
<div class="line"><span class="lineno"> 1376</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1377</span>  <span class="comment">// Returns the held value. Must not be called more than once.</span></div>
<div class="line"><span class="lineno"> 1378</span>  T Unwrap() {</div>
<div class="line"><span class="lineno"> 1379</span>    <span class="keywordflow">return</span> result_.Unwrap();</div>
<div class="line"><span class="lineno"> 1380</span>  }</div>
<div class="line"><span class="lineno"> 1381</span> </div>
<div class="line"><span class="lineno"> 1382</span>  <span class="comment">// Prints the held value as an action&#39;s result to os.</span></div>
<div class="line"><span class="lineno"> 1383</span>  <span class="keywordtype">void</span> PrintAsActionResult(::std::ostream* os)<span class="keyword"> const override </span>{</div>
<div class="line"><span class="lineno"> 1384</span>    *os &lt;&lt; <span class="stringliteral">&quot;\n          Returns: &quot;</span>;</div>
<div class="line"><span class="lineno"> 1385</span>    <span class="comment">// T may be a reference type, so we don&#39;t use UniversalPrint().</span></div>
<div class="line"><span class="lineno"> 1386</span>    UniversalPrinter&lt;T&gt;::Print(result_.Peek(), os);</div>
<div class="line"><span class="lineno"> 1387</span>  }</div>
<div class="line"><span class="lineno"> 1388</span> </div>
<div class="line"><span class="lineno"> 1389</span>  <span class="comment">// Performs the given mock function&#39;s default action and returns the</span></div>
<div class="line"><span class="lineno"> 1390</span>  <span class="comment">// result in a new-ed ActionResultHolder.</span></div>
<div class="line"><span class="lineno"> 1391</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1392</span>  <span class="keyword">static</span> ActionResultHolder* PerformDefaultAction(</div>
<div class="line"><span class="lineno"> 1393</span>      <span class="keyword">const</span> FunctionMocker&lt;F&gt;* func_mocker,</div>
<div class="line"><span class="lineno"> 1394</span>      <span class="keyword">typename</span> Function&lt;F&gt;::ArgumentTuple&amp;&amp; args,</div>
<div class="line"><span class="lineno"> 1395</span>      <span class="keyword">const</span> std::string&amp; call_description) {</div>
<div class="line"><span class="lineno"> 1396</span>    <span class="keywordflow">return</span> <span class="keyword">new</span> ActionResultHolder(Wrapper(func_mocker-&gt;PerformDefaultAction(</div>
<div class="line"><span class="lineno"> 1397</span>        std::move(args), call_description)));</div>
<div class="line"><span class="lineno"> 1398</span>  }</div>
<div class="line"><span class="lineno"> 1399</span> </div>
<div class="line"><span class="lineno"> 1400</span>  <span class="comment">// Performs the given action and returns the result in a new-ed</span></div>
<div class="line"><span class="lineno"> 1401</span>  <span class="comment">// ActionResultHolder.</span></div>
<div class="line"><span class="lineno"> 1402</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1403</span>  <span class="keyword">static</span> ActionResultHolder* PerformAction(</div>
<div class="line"><span class="lineno"> 1404</span>      <span class="keyword">const</span> Action&lt;F&gt;&amp; action, <span class="keyword">typename</span> Function&lt;F&gt;::ArgumentTuple&amp;&amp; args) {</div>
<div class="line"><span class="lineno"> 1405</span>    <span class="keywordflow">return</span> <span class="keyword">new</span> ActionResultHolder(</div>
<div class="line"><span class="lineno"> 1406</span>        Wrapper(action.Perform(std::move(args))));</div>
<div class="line"><span class="lineno"> 1407</span>  }</div>
<div class="line"><span class="lineno"> 1408</span> </div>
<div class="line"><span class="lineno"> 1409</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno"> 1410</span>  <span class="keyword">typedef</span> ReferenceOrValueWrapper&lt;T&gt; Wrapper;</div>
<div class="line"><span class="lineno"> 1411</span> </div>
<div class="line"><span class="lineno"> 1412</span>  <span class="keyword">explicit</span> ActionResultHolder(Wrapper result)</div>
<div class="line"><span class="lineno"> 1413</span>      : result_(<a class="code hl_namespace" href="a00315.html">std</a>::move(result)) {</div>
<div class="line"><span class="lineno"> 1414</span>  }</div>
<div class="line"><span class="lineno"> 1415</span> </div>
<div class="line"><span class="lineno"> 1416</span>  Wrapper result_;</div>
<div class="line"><span class="lineno"> 1417</span> </div>
<div class="line"><span class="lineno"> 1418</span>  <a class="code hl_define" href="a00281.html#aed8c1888c32b588b0681e88b95031e29">GTEST_DISALLOW_COPY_AND_ASSIGN_</a>(ActionResultHolder);</div>
<div class="line"><span class="lineno"> 1419</span>};</div>
<div class="line"><span class="lineno"> 1420</span> </div>
<div class="line"><span class="lineno"> 1421</span><span class="comment">// Specialization for T = void.</span></div>
<div class="line"><span class="lineno"> 1422</span><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="lineno"> 1423</span><span class="keyword">class </span>ActionResultHolder&lt;void&gt; : <span class="keyword">public</span> UntypedActionResultHolderBase {</div>
<div class="line"><span class="lineno"> 1424</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1425</span>  <span class="keywordtype">void</span> Unwrap() { }</div>
<div class="line"><span class="lineno"> 1426</span> </div>
<div class="line"><span class="lineno"> 1427</span>  <span class="keywordtype">void</span> PrintAsActionResult(::std::ostream* <span class="comment">/* os */</span>)<span class="keyword"> const override </span>{}</div>
<div class="line"><span class="lineno"> 1428</span> </div>
<div class="line"><span class="lineno"> 1429</span>  <span class="comment">// Performs the given mock function&#39;s default action and returns ownership</span></div>
<div class="line"><span class="lineno"> 1430</span>  <span class="comment">// of an empty ActionResultHolder*.</span></div>
<div class="line"><span class="lineno"> 1431</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1432</span>  <span class="keyword">static</span> ActionResultHolder* PerformDefaultAction(</div>
<div class="line"><span class="lineno"> 1433</span>      <span class="keyword">const</span> FunctionMocker&lt;F&gt;* func_mocker,</div>
<div class="line"><span class="lineno"> 1434</span>      <span class="keyword">typename</span> Function&lt;F&gt;::ArgumentTuple&amp;&amp; args,</div>
<div class="line"><span class="lineno"> 1435</span>      <span class="keyword">const</span> std::string&amp; call_description) {</div>
<div class="line"><span class="lineno"> 1436</span>    func_mocker-&gt;PerformDefaultAction(std::move(args), call_description);</div>
<div class="line"><span class="lineno"> 1437</span>    <span class="keywordflow">return</span> <span class="keyword">new</span> ActionResultHolder;</div>
<div class="line"><span class="lineno"> 1438</span>  }</div>
<div class="line"><span class="lineno"> 1439</span> </div>
<div class="line"><span class="lineno"> 1440</span>  <span class="comment">// Performs the given action and returns ownership of an empty</span></div>
<div class="line"><span class="lineno"> 1441</span>  <span class="comment">// ActionResultHolder*.</span></div>
<div class="line"><span class="lineno"> 1442</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1443</span>  <span class="keyword">static</span> ActionResultHolder* PerformAction(</div>
<div class="line"><span class="lineno"> 1444</span>      <span class="keyword">const</span> Action&lt;F&gt;&amp; action, <span class="keyword">typename</span> Function&lt;F&gt;::ArgumentTuple&amp;&amp; args) {</div>
<div class="line"><span class="lineno"> 1445</span>    action.Perform(std::move(args));</div>
<div class="line"><span class="lineno"> 1446</span>    <span class="keywordflow">return</span> <span class="keyword">new</span> ActionResultHolder;</div>
<div class="line"><span class="lineno"> 1447</span>  }</div>
<div class="line"><span class="lineno"> 1448</span> </div>
<div class="line"><span class="lineno"> 1449</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno"> 1450</span>  ActionResultHolder() {}</div>
<div class="line"><span class="lineno"> 1451</span>  <a class="code hl_define" href="a00281.html#aed8c1888c32b588b0681e88b95031e29">GTEST_DISALLOW_COPY_AND_ASSIGN_</a>(ActionResultHolder);</div>
<div class="line"><span class="lineno"> 1452</span>};</div>
<div class="line"><span class="lineno"> 1453</span> </div>
<div class="line"><span class="lineno"> 1454</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1455</span><span class="keyword">class </span>FunctionMocker;</div>
<div class="line"><span class="lineno"> 1456</span> </div>
<div class="line"><span class="lineno"> 1457</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> R, <span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><span class="lineno"> 1458</span><span class="keyword">class </span>FunctionMocker&lt;R(Args...)&gt; final : <span class="keyword">public</span> UntypedFunctionMockerBase {</div>
<div class="line"><span class="lineno"> 1459</span>  <span class="keyword">using</span> F = R(Args...);</div>
<div class="line"><span class="lineno"> 1460</span> </div>
<div class="line"><span class="lineno"> 1461</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1462</span>  <span class="keyword">using</span> Result = R;</div>
<div class="line"><span class="lineno"> 1463</span>  <span class="keyword">using</span> ArgumentTuple = std::tuple&lt;Args...&gt;;</div>
<div class="line"><span class="lineno"> 1464</span>  <span class="keyword">using</span> ArgumentMatcherTuple = std::tuple&lt;Matcher&lt;Args&gt;...&gt;;</div>
<div class="line"><span class="lineno"> 1465</span> </div>
<div class="line"><span class="lineno"> 1466</span>  FunctionMocker() {}</div>
<div class="line"><span class="lineno"> 1467</span> </div>
<div class="line"><span class="lineno"> 1468</span>  <span class="comment">// There is no generally useful and implementable semantics of</span></div>
<div class="line"><span class="lineno"> 1469</span>  <span class="comment">// copying a mock object, so copying a mock is usually a user error.</span></div>
<div class="line"><span class="lineno"> 1470</span>  <span class="comment">// Thus we disallow copying function mockers.  If the user really</span></div>
<div class="line"><span class="lineno"> 1471</span>  <span class="comment">// wants to copy a mock object, they should implement their own copy</span></div>
<div class="line"><span class="lineno"> 1472</span>  <span class="comment">// operation, for example:</span></div>
<div class="line"><span class="lineno"> 1473</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1474</span>  <span class="comment">//   class MockFoo : public Foo {</span></div>
<div class="line"><span class="lineno"> 1475</span>  <span class="comment">//    public:</span></div>
<div class="line"><span class="lineno"> 1476</span>  <span class="comment">//     // Defines a copy constructor explicitly.</span></div>
<div class="line"><span class="lineno"> 1477</span>  <span class="comment">//     MockFoo(const MockFoo&amp; src) {}</span></div>
<div class="line"><span class="lineno"> 1478</span>  <span class="comment">//     ...</span></div>
<div class="line"><span class="lineno"> 1479</span>  <span class="comment">//   };</span></div>
<div class="line"><span class="lineno"> 1480</span>  FunctionMocker(<span class="keyword">const</span> FunctionMocker&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><span class="lineno"> 1481</span>  FunctionMocker&amp; operator=(<span class="keyword">const</span> FunctionMocker&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><span class="lineno"> 1482</span> </div>
<div class="line"><span class="lineno"> 1483</span>  <span class="comment">// The destructor verifies that all expectations on this mock</span></div>
<div class="line"><span class="lineno"> 1484</span>  <span class="comment">// function have been satisfied.  If not, it will report Google Test</span></div>
<div class="line"><span class="lineno"> 1485</span>  <span class="comment">// non-fatal failures for the violations.</span></div>
<div class="line"><span class="lineno"> 1486</span>  ~FunctionMocker() override <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1487</span>    <a class="code hl_typedef" href="a00310.html#a08b187c6cc4e28400aadf9a32fccc8de">MutexLock</a> l(&amp;g_gmock_mutex);</div>
<div class="line"><span class="lineno"> 1488</span>    VerifyAndClearExpectationsLocked();</div>
<div class="line"><span class="lineno"> 1489</span>    Mock::UnregisterLocked(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno"> 1490</span>    ClearDefaultActionsLocked();</div>
<div class="line"><span class="lineno"> 1491</span>  }</div>
<div class="line"><span class="lineno"> 1492</span> </div>
<div class="line"><span class="lineno"> 1493</span>  <span class="comment">// Returns the ON_CALL spec that matches this mock function with the</span></div>
<div class="line"><span class="lineno"> 1494</span>  <span class="comment">// given arguments; returns NULL if no matching ON_CALL is found.</span></div>
<div class="line"><span class="lineno"> 1495</span>  <span class="comment">// L = *</span></div>
<div class="line"><span class="lineno"> 1496</span>  <span class="keyword">const</span> OnCallSpec&lt;F&gt;* FindOnCallSpec(</div>
<div class="line"><span class="lineno"> 1497</span>      <span class="keyword">const</span> ArgumentTuple&amp; args)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno"> 1498</span>    <span class="keywordflow">for</span> (UntypedOnCallSpecs::const_reverse_iterator it</div>
<div class="line"><span class="lineno"> 1499</span>             = untyped_on_call_specs_.rbegin();</div>
<div class="line"><span class="lineno"> 1500</span>         it != untyped_on_call_specs_.rend(); ++it) {</div>
<div class="line"><span class="lineno"> 1501</span>      <span class="keyword">const</span> OnCallSpec&lt;F&gt;* spec = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>OnCallSpec&lt;F&gt;*<span class="keyword">&gt;</span>(*it);</div>
<div class="line"><span class="lineno"> 1502</span>      <span class="keywordflow">if</span> (spec-&gt;Matches(args))</div>
<div class="line"><span class="lineno"> 1503</span>        <span class="keywordflow">return</span> spec;</div>
<div class="line"><span class="lineno"> 1504</span>    }</div>
<div class="line"><span class="lineno"> 1505</span> </div>
<div class="line"><span class="lineno"> 1506</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1507</span>  }</div>
<div class="line"><span class="lineno"> 1508</span> </div>
<div class="line"><span class="lineno"> 1509</span>  <span class="comment">// Performs the default action of this mock function on the given</span></div>
<div class="line"><span class="lineno"> 1510</span>  <span class="comment">// arguments and returns the result. Asserts (or throws if</span></div>
<div class="line"><span class="lineno"> 1511</span>  <span class="comment">// exceptions are enabled) with a helpful call description if there</span></div>
<div class="line"><span class="lineno"> 1512</span>  <span class="comment">// is no valid return value. This method doesn&#39;t depend on the</span></div>
<div class="line"><span class="lineno"> 1513</span>  <span class="comment">// mutable state of this object, and thus can be called concurrently</span></div>
<div class="line"><span class="lineno"> 1514</span>  <span class="comment">// without locking.</span></div>
<div class="line"><span class="lineno"> 1515</span>  <span class="comment">// L = *</span></div>
<div class="line"><span class="lineno"> 1516</span>  Result PerformDefaultAction(ArgumentTuple&amp;&amp; args,</div>
<div class="line"><span class="lineno"> 1517</span>                              <span class="keyword">const</span> std::string&amp; call_description)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno"> 1518</span>    <span class="keyword">const</span> OnCallSpec&lt;F&gt;* <span class="keyword">const</span> spec =</div>
<div class="line"><span class="lineno"> 1519</span>        this-&gt;FindOnCallSpec(args);</div>
<div class="line"><span class="lineno"> 1520</span>    <span class="keywordflow">if</span> (spec != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno"> 1521</span>      <span class="keywordflow">return</span> spec-&gt;GetAction().Perform(std::move(args));</div>
<div class="line"><span class="lineno"> 1522</span>    }</div>
<div class="line"><span class="lineno"> 1523</span>    <span class="keyword">const</span> std::string message =</div>
<div class="line"><span class="lineno"> 1524</span>        call_description +</div>
<div class="line"><span class="lineno"> 1525</span>        <span class="stringliteral">&quot;\n    The mock function has no default action &quot;</span></div>
<div class="line"><span class="lineno"> 1526</span>        <span class="stringliteral">&quot;set, and its return type has no default value set.&quot;</span>;</div>
<div class="line"><span class="lineno"> 1527</span><span class="preprocessor">#if GTEST_HAS_EXCEPTIONS</span></div>
<div class="line"><span class="lineno"> 1528</span>    <span class="keywordflow">if</span> (!DefaultValue&lt;Result&gt;::Exists()) {</div>
<div class="line"><span class="lineno"> 1529</span>      <span class="keywordflow">throw</span> std::runtime_error(message);</div>
<div class="line"><span class="lineno"> 1530</span>    }</div>
<div class="line"><span class="lineno"> 1531</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno"> 1532</span>    <a class="code hl_function" href="a00310.html#aa46ca46a5898b2ac75184c62e0355621">Assert</a>(DefaultValue&lt;Result&gt;::Exists(), <span class="stringliteral">&quot;&quot;</span>, -1, message);</div>
<div class="line"><span class="lineno"> 1533</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1534</span>    <span class="keywordflow">return</span> DefaultValue&lt;Result&gt;::Get();</div>
<div class="line"><span class="lineno"> 1535</span>  }</div>
<div class="line"><span class="lineno"> 1536</span> </div>
<div class="line"><span class="lineno"> 1537</span>  <span class="comment">// Performs the default action with the given arguments and returns</span></div>
<div class="line"><span class="lineno"> 1538</span>  <span class="comment">// the action&#39;s result.  The call description string will be used in</span></div>
<div class="line"><span class="lineno"> 1539</span>  <span class="comment">// the error message to describe the call in the case the default</span></div>
<div class="line"><span class="lineno"> 1540</span>  <span class="comment">// action fails.  The caller is responsible for deleting the result.</span></div>
<div class="line"><span class="lineno"> 1541</span>  <span class="comment">// L = *</span></div>
<div class="line"><span class="lineno"> 1542</span>  UntypedActionResultHolderBase* UntypedPerformDefaultAction(</div>
<div class="line"><span class="lineno"> 1543</span>      <span class="keywordtype">void</span>* untyped_args,  <span class="comment">// must point to an ArgumentTuple</span></div>
<div class="line"><span class="lineno"> 1544</span>      <span class="keyword">const</span> std::string&amp; call_description)<span class="keyword"> const override </span>{</div>
<div class="line"><span class="lineno"> 1545</span>    ArgumentTuple* args = <span class="keyword">static_cast&lt;</span>ArgumentTuple*<span class="keyword">&gt;</span>(untyped_args);</div>
<div class="line"><span class="lineno"> 1546</span>    <span class="keywordflow">return</span> ResultHolder::PerformDefaultAction(<span class="keyword">this</span>, std::move(*args),</div>
<div class="line"><span class="lineno"> 1547</span>                                              call_description);</div>
<div class="line"><span class="lineno"> 1548</span>  }</div>
<div class="line"><span class="lineno"> 1549</span> </div>
<div class="line"><span class="lineno"> 1550</span>  <span class="comment">// Performs the given action with the given arguments and returns</span></div>
<div class="line"><span class="lineno"> 1551</span>  <span class="comment">// the action&#39;s result.  The caller is responsible for deleting the</span></div>
<div class="line"><span class="lineno"> 1552</span>  <span class="comment">// result.</span></div>
<div class="line"><span class="lineno"> 1553</span>  <span class="comment">// L = *</span></div>
<div class="line"><span class="lineno"> 1554</span>  UntypedActionResultHolderBase* UntypedPerformAction(</div>
<div class="line"><span class="lineno"> 1555</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* untyped_action, <span class="keywordtype">void</span>* untyped_args)<span class="keyword"> const override </span>{</div>
<div class="line"><span class="lineno"> 1556</span>    <span class="comment">// Make a copy of the action before performing it, in case the</span></div>
<div class="line"><span class="lineno"> 1557</span>    <span class="comment">// action deletes the mock object (and thus deletes itself).</span></div>
<div class="line"><span class="lineno"> 1558</span>    <span class="keyword">const</span> Action&lt;F&gt; action = *<span class="keyword">static_cast&lt;</span><span class="keyword">const </span>Action&lt;F&gt;*<span class="keyword">&gt;</span>(untyped_action);</div>
<div class="line"><span class="lineno"> 1559</span>    ArgumentTuple* args = <span class="keyword">static_cast&lt;</span>ArgumentTuple*<span class="keyword">&gt;</span>(untyped_args);</div>
<div class="line"><span class="lineno"> 1560</span>    <span class="keywordflow">return</span> ResultHolder::PerformAction(action, std::move(*args));</div>
<div class="line"><span class="lineno"> 1561</span>  }</div>
<div class="line"><span class="lineno"> 1562</span> </div>
<div class="line"><span class="lineno"> 1563</span>  <span class="comment">// Implements UntypedFunctionMockerBase::ClearDefaultActionsLocked():</span></div>
<div class="line"><span class="lineno"> 1564</span>  <span class="comment">// clears the ON_CALL()s set on this mock function.</span></div>
<div class="line"><span class="lineno"> 1565</span>  <span class="keywordtype">void</span> ClearDefaultActionsLocked() override</div>
<div class="line"><span class="lineno"> 1566</span>      <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1567</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1568</span> </div>
<div class="line"><span class="lineno"> 1569</span>    <span class="comment">// Deleting our default actions may trigger other mock objects to be</span></div>
<div class="line"><span class="lineno"> 1570</span>    <span class="comment">// deleted, for example if an action contains a reference counted smart</span></div>
<div class="line"><span class="lineno"> 1571</span>    <span class="comment">// pointer to that mock object, and that is the last reference. So if we</span></div>
<div class="line"><span class="lineno"> 1572</span>    <span class="comment">// delete our actions within the context of the global mutex we may deadlock</span></div>
<div class="line"><span class="lineno"> 1573</span>    <span class="comment">// when this method is called again. Instead, make a copy of the set of</span></div>
<div class="line"><span class="lineno"> 1574</span>    <span class="comment">// actions to delete, clear our set within the mutex, and then delete the</span></div>
<div class="line"><span class="lineno"> 1575</span>    <span class="comment">// actions outside of the mutex.</span></div>
<div class="line"><span class="lineno"> 1576</span>    UntypedOnCallSpecs specs_to_delete;</div>
<div class="line"><span class="lineno"> 1577</span>    untyped_on_call_specs_.swap(specs_to_delete);</div>
<div class="line"><span class="lineno"> 1578</span> </div>
<div class="line"><span class="lineno"> 1579</span>    g_gmock_mutex.Unlock();</div>
<div class="line"><span class="lineno"> 1580</span>    <span class="keywordflow">for</span> (UntypedOnCallSpecs::const_iterator it =</div>
<div class="line"><span class="lineno"> 1581</span>             specs_to_delete.begin();</div>
<div class="line"><span class="lineno"> 1582</span>         it != specs_to_delete.end(); ++it) {</div>
<div class="line"><span class="lineno"> 1583</span>      <span class="keyword">delete</span> <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>OnCallSpec&lt;F&gt;*<span class="keyword">&gt;</span>(*it);</div>
<div class="line"><span class="lineno"> 1584</span>    }</div>
<div class="line"><span class="lineno"> 1585</span> </div>
<div class="line"><span class="lineno"> 1586</span>    <span class="comment">// Lock the mutex again, since the caller expects it to be locked when we</span></div>
<div class="line"><span class="lineno"> 1587</span>    <span class="comment">// return.</span></div>
<div class="line"><span class="lineno"> 1588</span>    g_gmock_mutex.Lock();</div>
<div class="line"><span class="lineno"> 1589</span>  }</div>
<div class="line"><span class="lineno"> 1590</span> </div>
<div class="line"><span class="lineno"> 1591</span>  <span class="comment">// Returns the result of invoking this mock function with the given</span></div>
<div class="line"><span class="lineno"> 1592</span>  <span class="comment">// arguments.  This function can be safely called from multiple</span></div>
<div class="line"><span class="lineno"> 1593</span>  <span class="comment">// threads concurrently.</span></div>
<div class="line"><span class="lineno"> 1594</span>  Result <a class="code hl_function" href="a00309.html#af5cacf4475557b5a3e37af3836564235">Invoke</a>(Args... args) <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1595</span>    ArgumentTuple tuple(std::forward&lt;Args&gt;(args)...);</div>
<div class="line"><span class="lineno"> 1596</span>    std::unique_ptr&lt;ResultHolder&gt; holder(DownCast_&lt;ResultHolder*&gt;(</div>
<div class="line"><span class="lineno"> 1597</span>        this-&gt;UntypedInvokeWith(<span class="keyword">static_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(&amp;tuple))));</div>
<div class="line"><span class="lineno"> 1598</span>    <span class="keywordflow">return</span> holder-&gt;Unwrap();</div>
<div class="line"><span class="lineno"> 1599</span>  }</div>
<div class="line"><span class="lineno"> 1600</span> </div>
<div class="line"><span class="lineno"> 1601</span>  MockSpec&lt;F&gt; With(Matcher&lt;Args&gt;... m) {</div>
<div class="line"><span class="lineno"> 1602</span>    <span class="keywordflow">return</span> MockSpec&lt;F&gt;(<span class="keyword">this</span>, ::std::make_tuple(std::move(m)...));</div>
<div class="line"><span class="lineno"> 1603</span>  }</div>
<div class="line"><span class="lineno"> 1604</span> </div>
<div class="line"><span class="lineno"> 1605</span> <span class="keyword">protected</span>:</div>
<div class="line"><span class="lineno"> 1606</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Function&gt;</div>
<div class="line"><span class="lineno"> 1607</span>  <span class="keyword">friend</span> <span class="keyword">class </span>MockSpec;</div>
<div class="line"><span class="lineno"> 1608</span> </div>
<div class="line"><span class="lineno"> 1609</span>  <span class="keyword">typedef</span> ActionResultHolder&lt;Result&gt; ResultHolder;</div>
<div class="line"><span class="lineno"> 1610</span> </div>
<div class="line"><span class="lineno"> 1611</span>  <span class="comment">// Adds and returns a default action spec for this mock function.</span></div>
<div class="line"><span class="lineno"> 1612</span>  OnCallSpec&lt;F&gt;&amp; AddNewOnCallSpec(</div>
<div class="line"><span class="lineno"> 1613</span>      <span class="keyword">const</span> <span class="keywordtype">char</span>* file, <span class="keywordtype">int</span> line,</div>
<div class="line"><span class="lineno"> 1614</span>      <span class="keyword">const</span> ArgumentMatcherTuple&amp; m)</div>
<div class="line"><span class="lineno"> 1615</span>          <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1616</span>    Mock::RegisterUseByOnCallOrExpectCall(MockObject(), file, line);</div>
<div class="line"><span class="lineno"> 1617</span>    OnCallSpec&lt;F&gt;* <span class="keyword">const</span> on_call_spec = <span class="keyword">new</span> OnCallSpec&lt;F&gt;(file, line, m);</div>
<div class="line"><span class="lineno"> 1618</span>    untyped_on_call_specs_.push_back(on_call_spec);</div>
<div class="line"><span class="lineno"> 1619</span>    <span class="keywordflow">return</span> *on_call_spec;</div>
<div class="line"><span class="lineno"> 1620</span>  }</div>
<div class="line"><span class="lineno"> 1621</span> </div>
<div class="line"><span class="lineno"> 1622</span>  <span class="comment">// Adds and returns an expectation spec for this mock function.</span></div>
<div class="line"><span class="lineno"> 1623</span>  TypedExpectation&lt;F&gt;&amp; AddNewExpectation(<span class="keyword">const</span> <span class="keywordtype">char</span>* file, <span class="keywordtype">int</span> line,</div>
<div class="line"><span class="lineno"> 1624</span>                                         <span class="keyword">const</span> std::string&amp; source_text,</div>
<div class="line"><span class="lineno"> 1625</span>                                         <span class="keyword">const</span> ArgumentMatcherTuple&amp; m)</div>
<div class="line"><span class="lineno"> 1626</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1627</span>    Mock::RegisterUseByOnCallOrExpectCall(MockObject(), file, line);</div>
<div class="line"><span class="lineno"> 1628</span>    TypedExpectation&lt;F&gt;* <span class="keyword">const</span> expectation =</div>
<div class="line"><span class="lineno"> 1629</span>        <span class="keyword">new</span> TypedExpectation&lt;F&gt;(<span class="keyword">this</span>, file, line, source_text, m);</div>
<div class="line"><span class="lineno"> 1630</span>    <span class="keyword">const</span> std::shared_ptr&lt;ExpectationBase&gt; untyped_expectation(expectation);</div>
<div class="line"><span class="lineno"> 1631</span>    <span class="comment">// See the definition of untyped_expectations_ for why access to</span></div>
<div class="line"><span class="lineno"> 1632</span>    <span class="comment">// it is unprotected here.</span></div>
<div class="line"><span class="lineno"> 1633</span>    untyped_expectations_.push_back(untyped_expectation);</div>
<div class="line"><span class="lineno"> 1634</span> </div>
<div class="line"><span class="lineno"> 1635</span>    <span class="comment">// Adds this expectation into the implicit sequence if there is one.</span></div>
<div class="line"><span class="lineno"> 1636</span>    Sequence* <span class="keyword">const</span> implicit_sequence = g_gmock_implicit_sequence.get();</div>
<div class="line"><span class="lineno"> 1637</span>    <span class="keywordflow">if</span> (implicit_sequence != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno"> 1638</span>      implicit_sequence-&gt;AddExpectation(Expectation(untyped_expectation));</div>
<div class="line"><span class="lineno"> 1639</span>    }</div>
<div class="line"><span class="lineno"> 1640</span> </div>
<div class="line"><span class="lineno"> 1641</span>    <span class="keywordflow">return</span> *expectation;</div>
<div class="line"><span class="lineno"> 1642</span>  }</div>
<div class="line"><span class="lineno"> 1643</span> </div>
<div class="line"><span class="lineno"> 1644</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno"> 1645</span>  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Func&gt; <span class="keyword">friend</span> <span class="keyword">class </span>TypedExpectation;</div>
<div class="line"><span class="lineno"> 1646</span> </div>
<div class="line"><span class="lineno"> 1647</span>  <span class="comment">// Some utilities needed for implementing UntypedInvokeWith().</span></div>
<div class="line"><span class="lineno"> 1648</span> </div>
<div class="line"><span class="lineno"> 1649</span>  <span class="comment">// Describes what default action will be performed for the given</span></div>
<div class="line"><span class="lineno"> 1650</span>  <span class="comment">// arguments.</span></div>
<div class="line"><span class="lineno"> 1651</span>  <span class="comment">// L = *</span></div>
<div class="line"><span class="lineno"> 1652</span>  <span class="keywordtype">void</span> DescribeDefaultActionTo(<span class="keyword">const</span> ArgumentTuple&amp; args,</div>
<div class="line"><span class="lineno"> 1653</span>                               ::std::ostream* os)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno"> 1654</span>    <span class="keyword">const</span> OnCallSpec&lt;F&gt;* <span class="keyword">const</span> spec = FindOnCallSpec(args);</div>
<div class="line"><span class="lineno"> 1655</span> </div>
<div class="line"><span class="lineno"> 1656</span>    <span class="keywordflow">if</span> (spec == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno"> 1657</span>      *os &lt;&lt; (std::is_void&lt;Result&gt;::value ? <span class="stringliteral">&quot;returning directly.\n&quot;</span></div>
<div class="line"><span class="lineno"> 1658</span>                                          : <span class="stringliteral">&quot;returning default value.\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1659</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1660</span>      *os &lt;&lt; <span class="stringliteral">&quot;taking default action specified at:\n&quot;</span></div>
<div class="line"><span class="lineno"> 1661</span>          &lt;&lt; <a class="code hl_function" href="a00310.html#a31b7c3abed4a7c395f42c61e993989f4">FormatFileLocation</a>(spec-&gt;file(), spec-&gt;line()) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1662</span>    }</div>
<div class="line"><span class="lineno"> 1663</span>  }</div>
<div class="line"><span class="lineno"> 1664</span> </div>
<div class="line"><span class="lineno"> 1665</span>  <span class="comment">// Writes a message that the call is uninteresting (i.e. neither</span></div>
<div class="line"><span class="lineno"> 1666</span>  <span class="comment">// explicitly expected nor explicitly unexpected) to the given</span></div>
<div class="line"><span class="lineno"> 1667</span>  <span class="comment">// ostream.</span></div>
<div class="line"><span class="lineno"> 1668</span>  <span class="keywordtype">void</span> UntypedDescribeUninterestingCall(<span class="keyword">const</span> <span class="keywordtype">void</span>* untyped_args,</div>
<div class="line"><span class="lineno"> 1669</span>                                        ::std::ostream* os) <span class="keyword">const</span> <span class="keyword">override</span></div>
<div class="line"><span class="lineno"> 1670</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1671</span>    <span class="keyword">const</span> ArgumentTuple&amp; args =</div>
<div class="line"><span class="lineno"> 1672</span>        *<span class="keyword">static_cast&lt;</span><span class="keyword">const </span>ArgumentTuple*<span class="keyword">&gt;</span>(untyped_args);</div>
<div class="line"><span class="lineno"> 1673</span>    *os &lt;&lt; <span class="stringliteral">&quot;Uninteresting mock function call - &quot;</span>;</div>
<div class="line"><span class="lineno"> 1674</span>    DescribeDefaultActionTo(args, os);</div>
<div class="line"><span class="lineno"> 1675</span>    *os &lt;&lt; <span class="stringliteral">&quot;    Function call: &quot;</span> &lt;&lt; Name();</div>
<div class="line"><span class="lineno"> 1676</span>    <a class="code hl_function" href="a00310.html#a30708fa2bacf11895b03bdb21eb72309">UniversalPrint</a>(args, os);</div>
<div class="line"><span class="lineno"> 1677</span>  }</div>
<div class="line"><span class="lineno"> 1678</span> </div>
<div class="line"><span class="lineno"> 1679</span>  <span class="comment">// Returns the expectation that matches the given function arguments</span></div>
<div class="line"><span class="lineno"> 1680</span>  <span class="comment">// (or NULL is there&#39;s no match); when a match is found,</span></div>
<div class="line"><span class="lineno"> 1681</span>  <span class="comment">// untyped_action is set to point to the action that should be</span></div>
<div class="line"><span class="lineno"> 1682</span>  <span class="comment">// performed (or NULL if the action is &quot;do default&quot;), and</span></div>
<div class="line"><span class="lineno"> 1683</span>  <span class="comment">// is_excessive is modified to indicate whether the call exceeds the</span></div>
<div class="line"><span class="lineno"> 1684</span>  <span class="comment">// expected number.</span></div>
<div class="line"><span class="lineno"> 1685</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1686</span>  <span class="comment">// Critical section: We must find the matching expectation and the</span></div>
<div class="line"><span class="lineno"> 1687</span>  <span class="comment">// corresponding action that needs to be taken in an ATOMIC</span></div>
<div class="line"><span class="lineno"> 1688</span>  <span class="comment">// transaction.  Otherwise another thread may call this mock</span></div>
<div class="line"><span class="lineno"> 1689</span>  <span class="comment">// method in the middle and mess up the state.</span></div>
<div class="line"><span class="lineno"> 1690</span>  <span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1691</span>  <span class="comment">// However, performing the action has to be left out of the critical</span></div>
<div class="line"><span class="lineno"> 1692</span>  <span class="comment">// section.  The reason is that we have no control on what the</span></div>
<div class="line"><span class="lineno"> 1693</span>  <span class="comment">// action does (it can invoke an arbitrary user function or even a</span></div>
<div class="line"><span class="lineno"> 1694</span>  <span class="comment">// mock function) and excessive locking could cause a dead lock.</span></div>
<div class="line"><span class="lineno"> 1695</span>  <span class="keyword">const</span> ExpectationBase* UntypedFindMatchingExpectation(</div>
<div class="line"><span class="lineno"> 1696</span>      <span class="keyword">const</span> <span class="keywordtype">void</span>* untyped_args, <span class="keyword">const</span> <span class="keywordtype">void</span>** untyped_action, <span class="keywordtype">bool</span>* is_excessive,</div>
<div class="line"><span class="lineno"> 1697</span>      ::std::ostream* what, ::std::ostream* why) <span class="keyword">override</span></div>
<div class="line"><span class="lineno"> 1698</span>      <a class="code hl_define" href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1699</span>    <span class="keyword">const</span> ArgumentTuple&amp; args =</div>
<div class="line"><span class="lineno"> 1700</span>        *<span class="keyword">static_cast&lt;</span><span class="keyword">const </span>ArgumentTuple*<span class="keyword">&gt;</span>(untyped_args);</div>
<div class="line"><span class="lineno"> 1701</span>    <a class="code hl_typedef" href="a00310.html#a08b187c6cc4e28400aadf9a32fccc8de">MutexLock</a> l(&amp;g_gmock_mutex);</div>
<div class="line"><span class="lineno"> 1702</span>    TypedExpectation&lt;F&gt;* exp = this-&gt;FindMatchingExpectationLocked(args);</div>
<div class="line"><span class="lineno"> 1703</span>    <span class="keywordflow">if</span> (exp == <span class="keyword">nullptr</span>) {  <span class="comment">// A match wasn&#39;t found.</span></div>
<div class="line"><span class="lineno"> 1704</span>      this-&gt;FormatUnexpectedCallMessageLocked(args, what, why);</div>
<div class="line"><span class="lineno"> 1705</span>      <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1706</span>    }</div>
<div class="line"><span class="lineno"> 1707</span> </div>
<div class="line"><span class="lineno"> 1708</span>    <span class="comment">// This line must be done before calling GetActionForArguments(),</span></div>
<div class="line"><span class="lineno"> 1709</span>    <span class="comment">// which will increment the call count for *exp and thus affect</span></div>
<div class="line"><span class="lineno"> 1710</span>    <span class="comment">// its saturation status.</span></div>
<div class="line"><span class="lineno"> 1711</span>    *is_excessive = exp-&gt;IsSaturated();</div>
<div class="line"><span class="lineno"> 1712</span>    <span class="keyword">const</span> Action&lt;F&gt;* action = exp-&gt;GetActionForArguments(<span class="keyword">this</span>, args, what, why);</div>
<div class="line"><span class="lineno"> 1713</span>    <span class="keywordflow">if</span> (action != <span class="keyword">nullptr</span> &amp;&amp; action-&gt;IsDoDefault())</div>
<div class="line"><span class="lineno"> 1714</span>      action = <span class="keyword">nullptr</span>;  <span class="comment">// Normalize &quot;do default&quot; to NULL.</span></div>
<div class="line"><span class="lineno"> 1715</span>    *untyped_action = action;</div>
<div class="line"><span class="lineno"> 1716</span>    <span class="keywordflow">return</span> exp;</div>
<div class="line"><span class="lineno"> 1717</span>  }</div>
<div class="line"><span class="lineno"> 1718</span> </div>
<div class="line"><span class="lineno"> 1719</span>  <span class="comment">// Prints the given function arguments to the ostream.</span></div>
<div class="line"><span class="lineno"> 1720</span>  <span class="keywordtype">void</span> UntypedPrintArgs(<span class="keyword">const</span> <span class="keywordtype">void</span>* untyped_args,</div>
<div class="line"><span class="lineno"> 1721</span>                        ::std::ostream* os)<span class="keyword"> const override </span>{</div>
<div class="line"><span class="lineno"> 1722</span>    <span class="keyword">const</span> ArgumentTuple&amp; args =</div>
<div class="line"><span class="lineno"> 1723</span>        *<span class="keyword">static_cast&lt;</span><span class="keyword">const </span>ArgumentTuple*<span class="keyword">&gt;</span>(untyped_args);</div>
<div class="line"><span class="lineno"> 1724</span>    <a class="code hl_function" href="a00310.html#a30708fa2bacf11895b03bdb21eb72309">UniversalPrint</a>(args, os);</div>
<div class="line"><span class="lineno"> 1725</span>  }</div>
<div class="line"><span class="lineno"> 1726</span> </div>
<div class="line"><span class="lineno"> 1727</span>  <span class="comment">// Returns the expectation that matches the arguments, or NULL if no</span></div>
<div class="line"><span class="lineno"> 1728</span>  <span class="comment">// expectation matches them.</span></div>
<div class="line"><span class="lineno"> 1729</span>  TypedExpectation&lt;F&gt;* FindMatchingExpectationLocked(</div>
<div class="line"><span class="lineno"> 1730</span>      <span class="keyword">const</span> ArgumentTuple&amp; args) <span class="keyword">const</span></div>
<div class="line"><span class="lineno"> 1731</span>          <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1732</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1733</span>    <span class="comment">// See the definition of untyped_expectations_ for why access to</span></div>
<div class="line"><span class="lineno"> 1734</span>    <span class="comment">// it is unprotected here.</span></div>
<div class="line"><span class="lineno"> 1735</span>    <span class="keywordflow">for</span> (<span class="keyword">typename</span> UntypedExpectations::const_reverse_iterator it =</div>
<div class="line"><span class="lineno"> 1736</span>             untyped_expectations_.rbegin();</div>
<div class="line"><span class="lineno"> 1737</span>         it != untyped_expectations_.rend(); ++it) {</div>
<div class="line"><span class="lineno"> 1738</span>      TypedExpectation&lt;F&gt;* <span class="keyword">const</span> exp =</div>
<div class="line"><span class="lineno"> 1739</span>          <span class="keyword">static_cast&lt;</span>TypedExpectation&lt;F&gt;*<span class="keyword">&gt;</span>(it-&gt;get());</div>
<div class="line"><span class="lineno"> 1740</span>      <span class="keywordflow">if</span> (exp-&gt;ShouldHandleArguments(args)) {</div>
<div class="line"><span class="lineno"> 1741</span>        <span class="keywordflow">return</span> exp;</div>
<div class="line"><span class="lineno"> 1742</span>      }</div>
<div class="line"><span class="lineno"> 1743</span>    }</div>
<div class="line"><span class="lineno"> 1744</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno"> 1745</span>  }</div>
<div class="line"><span class="lineno"> 1746</span> </div>
<div class="line"><span class="lineno"> 1747</span>  <span class="comment">// Returns a message that the arguments don&#39;t match any expectation.</span></div>
<div class="line"><span class="lineno"> 1748</span>  <span class="keywordtype">void</span> FormatUnexpectedCallMessageLocked(</div>
<div class="line"><span class="lineno"> 1749</span>      <span class="keyword">const</span> ArgumentTuple&amp; args,</div>
<div class="line"><span class="lineno"> 1750</span>      ::std::ostream* os,</div>
<div class="line"><span class="lineno"> 1751</span>      ::std::ostream* why) <span class="keyword">const</span></div>
<div class="line"><span class="lineno"> 1752</span>          <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1753</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1754</span>    *os &lt;&lt; <span class="stringliteral">&quot;\nUnexpected mock function call - &quot;</span>;</div>
<div class="line"><span class="lineno"> 1755</span>    DescribeDefaultActionTo(args, os);</div>
<div class="line"><span class="lineno"> 1756</span>    PrintTriedExpectationsLocked(args, why);</div>
<div class="line"><span class="lineno"> 1757</span>  }</div>
<div class="line"><span class="lineno"> 1758</span> </div>
<div class="line"><span class="lineno"> 1759</span>  <span class="comment">// Prints a list of expectations that have been tried against the</span></div>
<div class="line"><span class="lineno"> 1760</span>  <span class="comment">// current mock function call.</span></div>
<div class="line"><span class="lineno"> 1761</span>  <span class="keywordtype">void</span> PrintTriedExpectationsLocked(</div>
<div class="line"><span class="lineno"> 1762</span>      <span class="keyword">const</span> ArgumentTuple&amp; args,</div>
<div class="line"><span class="lineno"> 1763</span>      ::std::ostream* why) <span class="keyword">const</span></div>
<div class="line"><span class="lineno"> 1764</span>          <a class="code hl_define" href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>(g_gmock_mutex) {</div>
<div class="line"><span class="lineno"> 1765</span>    g_gmock_mutex.AssertHeld();</div>
<div class="line"><span class="lineno"> 1766</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> count = untyped_expectations_.size();</div>
<div class="line"><span class="lineno"> 1767</span>    *why &lt;&lt; <span class="stringliteral">&quot;Google Mock tried the following &quot;</span> &lt;&lt; count &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><span class="lineno"> 1768</span>         &lt;&lt; (count == 1 ? <span class="stringliteral">&quot;expectation, but it didn&#39;t match&quot;</span> :</div>
<div class="line"><span class="lineno"> 1769</span>             <span class="stringliteral">&quot;expectations, but none matched&quot;</span>)</div>
<div class="line"><span class="lineno"> 1770</span>         &lt;&lt; <span class="stringliteral">&quot;:\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1771</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; count; i++) {</div>
<div class="line"><span class="lineno"> 1772</span>      TypedExpectation&lt;F&gt;* <span class="keyword">const</span> expectation =</div>
<div class="line"><span class="lineno"> 1773</span>          <span class="keyword">static_cast&lt;</span>TypedExpectation&lt;F&gt;*<span class="keyword">&gt;</span>(untyped_expectations_[i].get());</div>
<div class="line"><span class="lineno"> 1774</span>      *why &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1775</span>      expectation-&gt;DescribeLocationTo(why);</div>
<div class="line"><span class="lineno"> 1776</span>      <span class="keywordflow">if</span> (count &gt; 1) {</div>
<div class="line"><span class="lineno"> 1777</span>        *why &lt;&lt; <span class="stringliteral">&quot;tried expectation #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;</div>
<div class="line"><span class="lineno"> 1778</span>      }</div>
<div class="line"><span class="lineno"> 1779</span>      *why &lt;&lt; expectation-&gt;source_text() &lt;&lt; <span class="stringliteral">&quot;...\n&quot;</span>;</div>
<div class="line"><span class="lineno"> 1780</span>      expectation-&gt;ExplainMatchResultTo(args, why);</div>
<div class="line"><span class="lineno"> 1781</span>      expectation-&gt;DescribeCallCountTo(why);</div>
<div class="line"><span class="lineno"> 1782</span>    }</div>
<div class="line"><span class="lineno"> 1783</span>  }</div>
<div class="line"><span class="lineno"> 1784</span>};  <span class="comment">// class FunctionMocker</span></div>
<div class="line"><span class="lineno"> 1785</span> </div>
<div class="line"><span class="lineno"> 1786</span><span class="comment">// Reports an uninteresting call (whose description is in msg) in the</span></div>
<div class="line"><span class="lineno"> 1787</span><span class="comment">// manner specified by &#39;reaction&#39;.</span></div>
<div class="line"><span class="lineno"> 1788</span><span class="keywordtype">void</span> ReportUninterestingCall(CallReaction reaction, <span class="keyword">const</span> std::string&amp; msg);</div>
<div class="line"><span class="lineno"> 1789</span> </div>
<div class="line"><span class="lineno"> 1790</span>}  <span class="comment">// namespace internal</span></div>
<div class="line"><span class="lineno"> 1791</span> </div>
<div class="line"><span class="lineno"> 1792</span><span class="keyword">namespace </span>internal {</div>
<div class="line"><span class="lineno"> 1793</span> </div>
<div class="line"><span class="lineno"> 1794</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1795</span><span class="keyword">class </span>MockFunction;</div>
<div class="line"><span class="lineno"> 1796</span> </div>
<div class="line"><span class="lineno"> 1797</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> R, <span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><span class="lineno"> 1798</span><span class="keyword">class </span>MockFunction&lt;R(Args...)&gt; {</div>
<div class="line"><span class="lineno"> 1799</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1800</span>  MockFunction(<span class="keyword">const</span> MockFunction&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><span class="lineno"> 1801</span>  MockFunction&amp; operator=(<span class="keyword">const</span> MockFunction&amp;) = <span class="keyword">delete</span>;</div>
<div class="line"><span class="lineno"> 1802</span> </div>
<div class="line"><span class="lineno"> 1803</span>  std::function&lt;R(Args...)&gt; AsStdFunction() {</div>
<div class="line"><span class="lineno"> 1804</span>    <span class="keywordflow">return</span> [<span class="keyword">this</span>](Args... args) -&gt; R {</div>
<div class="line"><span class="lineno"> 1805</span>      <span class="keywordflow">return</span> this-&gt;Call(std::forward&lt;Args&gt;(args)...);</div>
<div class="line"><span class="lineno"> 1806</span>    };</div>
<div class="line"><span class="lineno"> 1807</span>  }</div>
<div class="line"><span class="lineno"> 1808</span> </div>
<div class="line"><span class="lineno"> 1809</span>  <span class="comment">// Implementation detail: the expansion of the MOCK_METHOD macro.</span></div>
<div class="line"><span class="lineno"> 1810</span>  R Call(Args... args) {</div>
<div class="line"><span class="lineno"> 1811</span>    mock_.SetOwnerAndName(<span class="keyword">this</span>, <span class="stringliteral">&quot;Call&quot;</span>);</div>
<div class="line"><span class="lineno"> 1812</span>    <span class="keywordflow">return</span> mock_.Invoke(std::forward&lt;Args&gt;(args)...);</div>
<div class="line"><span class="lineno"> 1813</span>  }</div>
<div class="line"><span class="lineno"> 1814</span> </div>
<div class="line"><span class="lineno"> 1815</span>  MockSpec&lt;R(Args...)&gt; gmock_Call(Matcher&lt;Args&gt;... m) {</div>
<div class="line"><span class="lineno"> 1816</span>    mock_.RegisterOwner(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno"> 1817</span>    <span class="keywordflow">return</span> mock_.With(std::move(m)...);</div>
<div class="line"><span class="lineno"> 1818</span>  }</div>
<div class="line"><span class="lineno"> 1819</span> </div>
<div class="line"><span class="lineno"> 1820</span>  MockSpec&lt;R(Args...)&gt; gmock_Call(<span class="keyword">const</span> WithoutMatchers&amp;, R (*)(Args...)) {</div>
<div class="line"><span class="lineno"> 1821</span>    <span class="keywordflow">return</span> this-&gt;gmock_Call(::testing::A&lt;Args&gt;()...);</div>
<div class="line"><span class="lineno"> 1822</span>  }</div>
<div class="line"><span class="lineno"> 1823</span> </div>
<div class="line"><span class="lineno"> 1824</span> <span class="keyword">protected</span>:</div>
<div class="line"><span class="lineno"> 1825</span>  MockFunction() = <span class="keywordflow">default</span>;</div>
<div class="line"><span class="lineno"> 1826</span>  ~MockFunction() = <span class="keywordflow">default</span>;</div>
<div class="line"><span class="lineno"> 1827</span> </div>
<div class="line"><span class="lineno"> 1828</span> <span class="keyword">private</span>:</div>
<div class="line"><span class="lineno"> 1829</span>  FunctionMocker&lt;R(Args...)&gt; mock_;</div>
<div class="line"><span class="lineno"> 1830</span>};</div>
<div class="line"><span class="lineno"> 1831</span> </div>
<div class="line"><span class="lineno"> 1832</span><span class="comment">/*</span></div>
<div class="line"><span class="lineno"> 1833</span><span class="comment">The SignatureOf&lt;F&gt; struct is a meta-function returning function signature</span></div>
<div class="line"><span class="lineno"> 1834</span><span class="comment">corresponding to the provided F argument.</span></div>
<div class="line"><span class="lineno"> 1835</span><span class="comment"></span> </div>
<div class="line"><span class="lineno"> 1836</span><span class="comment">It makes use of MockFunction easier by allowing it to accept more F arguments</span></div>
<div class="line"><span class="lineno"> 1837</span><span class="comment">than just function signatures.</span></div>
<div class="line"><span class="lineno"> 1838</span><span class="comment"></span> </div>
<div class="line"><span class="lineno"> 1839</span><span class="comment">Specializations provided here cover a signature type itself and any template</span></div>
<div class="line"><span class="lineno"> 1840</span><span class="comment">that can be parameterized with a signature, including std::function and</span></div>
<div class="line"><span class="lineno"> 1841</span><span class="comment">boost::function.</span></div>
<div class="line"><span class="lineno"> 1842</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno"> 1843</span> </div>
<div class="line"><span class="lineno"> 1844</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F, <span class="keyword">typename</span> = <span class="keywordtype">void</span>&gt;</div>
<div class="line"><span class="lineno"> 1845</span><span class="keyword">struct </span>SignatureOf;</div>
<div class="line"><span class="lineno"> 1846</span> </div>
<div class="line"><span class="lineno"> 1847</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> R, <span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><span class="lineno"> 1848</span><span class="keyword">struct </span>SignatureOf&lt;R(Args...)&gt; {</div>
<div class="line"><span class="lineno"> 1849</span>  <span class="keyword">using</span> type = R(Args...);</div>
<div class="line"><span class="lineno"> 1850</span>};</div>
<div class="line"><span class="lineno"> 1851</span> </div>
<div class="line"><span class="lineno"> 1852</span><span class="keyword">template</span> &lt;<span class="keyword">template</span> &lt;<span class="keyword">typename</span>&gt; <span class="keyword">class </span>C, <span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1853</span><span class="keyword">struct </span>SignatureOf&lt;C&lt;F&gt;,</div>
<div class="line"><span class="lineno"> 1854</span>                   typename <a class="code hl_namespace" href="a00315.html">std</a>::enable_if&lt;std::is_function&lt;F&gt;::value&gt;::type&gt;</div>
<div class="line"><span class="lineno"> 1855</span>    : SignatureOf&lt;F&gt; {};</div>
<div class="line"><span class="lineno"> 1856</span> </div>
<div class="line"><span class="lineno"> 1857</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1858</span><span class="keyword">using</span> SignatureOfT = <span class="keyword">typename</span> SignatureOf&lt;F&gt;::type;</div>
<div class="line"><span class="lineno"> 1859</span> </div>
<div class="line"><span class="lineno"> 1860</span>}  <span class="comment">// namespace internal</span></div>
<div class="line"><span class="lineno"> 1861</span> </div>
<div class="line"><span class="lineno"> 1862</span><span class="comment">// A MockFunction&lt;F&gt; type has one mock method whose type is</span></div>
<div class="line"><span class="lineno"> 1863</span><span class="comment">// internal::SignatureOfT&lt;F&gt;.  It is useful when you just want your</span></div>
<div class="line"><span class="lineno"> 1864</span><span class="comment">// test code to emit some messages and have Google Mock verify the</span></div>
<div class="line"><span class="lineno"> 1865</span><span class="comment">// right messages are sent (and perhaps at the right times).  For</span></div>
<div class="line"><span class="lineno"> 1866</span><span class="comment">// example, if you are exercising code:</span></div>
<div class="line"><span class="lineno"> 1867</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1868</span><span class="comment">//   Foo(1);</span></div>
<div class="line"><span class="lineno"> 1869</span><span class="comment">//   Foo(2);</span></div>
<div class="line"><span class="lineno"> 1870</span><span class="comment">//   Foo(3);</span></div>
<div class="line"><span class="lineno"> 1871</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1872</span><span class="comment">// and want to verify that Foo(1) and Foo(3) both invoke</span></div>
<div class="line"><span class="lineno"> 1873</span><span class="comment">// mock.Bar(&quot;a&quot;), but Foo(2) doesn&#39;t invoke anything, you can write:</span></div>
<div class="line"><span class="lineno"> 1874</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1875</span><span class="comment">// TEST(FooTest, InvokesBarCorrectly) {</span></div>
<div class="line"><span class="lineno"> 1876</span><span class="comment">//   MyMock mock;</span></div>
<div class="line"><span class="lineno"> 1877</span><span class="comment">//   MockFunction&lt;void(string check_point_name)&gt; check;</span></div>
<div class="line"><span class="lineno"> 1878</span><span class="comment">//   {</span></div>
<div class="line"><span class="lineno"> 1879</span><span class="comment">//     InSequence s;</span></div>
<div class="line"><span class="lineno"> 1880</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1881</span><span class="comment">//     EXPECT_CALL(mock, Bar(&quot;a&quot;));</span></div>
<div class="line"><span class="lineno"> 1882</span><span class="comment">//     EXPECT_CALL(check, Call(&quot;1&quot;));</span></div>
<div class="line"><span class="lineno"> 1883</span><span class="comment">//     EXPECT_CALL(check, Call(&quot;2&quot;));</span></div>
<div class="line"><span class="lineno"> 1884</span><span class="comment">//     EXPECT_CALL(mock, Bar(&quot;a&quot;));</span></div>
<div class="line"><span class="lineno"> 1885</span><span class="comment">//   }</span></div>
<div class="line"><span class="lineno"> 1886</span><span class="comment">//   Foo(1);</span></div>
<div class="line"><span class="lineno"> 1887</span><span class="comment">//   check.Call(&quot;1&quot;);</span></div>
<div class="line"><span class="lineno"> 1888</span><span class="comment">//   Foo(2);</span></div>
<div class="line"><span class="lineno"> 1889</span><span class="comment">//   check.Call(&quot;2&quot;);</span></div>
<div class="line"><span class="lineno"> 1890</span><span class="comment">//   Foo(3);</span></div>
<div class="line"><span class="lineno"> 1891</span><span class="comment">// }</span></div>
<div class="line"><span class="lineno"> 1892</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1893</span><span class="comment">// The expectation spec says that the first Bar(&quot;a&quot;) must happen</span></div>
<div class="line"><span class="lineno"> 1894</span><span class="comment">// before check point &quot;1&quot;, the second Bar(&quot;a&quot;) must happen after check</span></div>
<div class="line"><span class="lineno"> 1895</span><span class="comment">// point &quot;2&quot;, and nothing should happen between the two check</span></div>
<div class="line"><span class="lineno"> 1896</span><span class="comment">// points. The explicit check points make it easy to tell which</span></div>
<div class="line"><span class="lineno"> 1897</span><span class="comment">// Bar(&quot;a&quot;) is called by which call to Foo().</span></div>
<div class="line"><span class="lineno"> 1898</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1899</span><span class="comment">// MockFunction&lt;F&gt; can also be used to exercise code that accepts</span></div>
<div class="line"><span class="lineno"> 1900</span><span class="comment">// std::function&lt;internal::SignatureOfT&lt;F&gt;&gt; callbacks. To do so, use</span></div>
<div class="line"><span class="lineno"> 1901</span><span class="comment">// AsStdFunction() method to create std::function proxy forwarding to</span></div>
<div class="line"><span class="lineno"> 1902</span><span class="comment">// original object&#39;s Call. Example:</span></div>
<div class="line"><span class="lineno"> 1903</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1904</span><span class="comment">// TEST(FooTest, RunsCallbackWithBarArgument) {</span></div>
<div class="line"><span class="lineno"> 1905</span><span class="comment">//   MockFunction&lt;int(string)&gt; callback;</span></div>
<div class="line"><span class="lineno"> 1906</span><span class="comment">//   EXPECT_CALL(callback, Call(&quot;bar&quot;)).WillOnce(Return(1));</span></div>
<div class="line"><span class="lineno"> 1907</span><span class="comment">//   Foo(callback.AsStdFunction());</span></div>
<div class="line"><span class="lineno"> 1908</span><span class="comment">// }</span></div>
<div class="line"><span class="lineno"> 1909</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1910</span><span class="comment">// The internal::SignatureOfT&lt;F&gt; indirection allows to use other types</span></div>
<div class="line"><span class="lineno"> 1911</span><span class="comment">// than just function signature type. This is typically useful when</span></div>
<div class="line"><span class="lineno"> 1912</span><span class="comment">// providing a mock for a predefined std::function type. Example:</span></div>
<div class="line"><span class="lineno"> 1913</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1914</span><span class="comment">// using FilterPredicate = std::function&lt;bool(string)&gt;;</span></div>
<div class="line"><span class="lineno"> 1915</span><span class="comment">// void MyFilterAlgorithm(FilterPredicate predicate);</span></div>
<div class="line"><span class="lineno"> 1916</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1917</span><span class="comment">// TEST(FooTest, FilterPredicateAlwaysAccepts) {</span></div>
<div class="line"><span class="lineno"> 1918</span><span class="comment">//   MockFunction&lt;FilterPredicate&gt; predicateMock;</span></div>
<div class="line"><span class="lineno"> 1919</span><span class="comment">//   EXPECT_CALL(predicateMock, Call(_)).WillRepeatedly(Return(true));</span></div>
<div class="line"><span class="lineno"> 1920</span><span class="comment">//   MyFilterAlgorithm(predicateMock.AsStdFunction());</span></div>
<div class="line"><span class="lineno"> 1921</span><span class="comment">// }</span></div>
<div class="line"><span class="lineno"> 1922</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> F&gt;</div>
<div class="line"><span class="lineno"> 1923</span><span class="keyword">class </span>MockFunction : <span class="keyword">public</span> internal::MockFunction&lt;internal::SignatureOfT&lt;F&gt;&gt; {</div>
<div class="line"><span class="lineno"> 1924</span>  <span class="keyword">using</span> Base = internal::MockFunction&lt;internal::SignatureOfT&lt;F&gt;&gt;;</div>
<div class="line"><span class="lineno"> 1925</span> </div>
<div class="line"><span class="lineno"> 1926</span> <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1927</span>  <span class="keyword">using</span> Base::Base;</div>
<div class="line"><span class="lineno"> 1928</span>};</div>
<div class="line"><span class="lineno"> 1929</span> </div>
<div class="line"><span class="lineno"> 1930</span><span class="comment">// The style guide prohibits &quot;using&quot; statements in a namespace scope</span></div>
<div class="line"><span class="lineno"> 1931</span><span class="comment">// inside a header file.  However, the MockSpec class template is</span></div>
<div class="line"><span class="lineno"> 1932</span><span class="comment">// meant to be defined in the ::testing namespace.  The following line</span></div>
<div class="line"><span class="lineno"> 1933</span><span class="comment">// is just a trick for working around a bug in MSVC 8.0, which cannot</span></div>
<div class="line"><span class="lineno"> 1934</span><span class="comment">// handle it if we define MockSpec in ::testing.</span></div>
<div class="line"><span class="lineno"> 1935</span><span class="keyword">using</span> internal::MockSpec;</div>
<div class="line"><span class="lineno"> 1936</span> </div>
<div class="line"><span class="lineno"> 1937</span><span class="comment">// Const(x) is a convenient function for obtaining a const reference</span></div>
<div class="line"><span class="lineno"> 1938</span><span class="comment">// to x.  This is useful for setting expectations on an overloaded</span></div>
<div class="line"><span class="lineno"> 1939</span><span class="comment">// const mock method, e.g.</span></div>
<div class="line"><span class="lineno"> 1940</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1941</span><span class="comment">//   class MockFoo : public FooInterface {</span></div>
<div class="line"><span class="lineno"> 1942</span><span class="comment">//    public:</span></div>
<div class="line"><span class="lineno"> 1943</span><span class="comment">//     MOCK_METHOD0(Bar, int());</span></div>
<div class="line"><span class="lineno"> 1944</span><span class="comment">//     MOCK_CONST_METHOD0(Bar, int&amp;());</span></div>
<div class="line"><span class="lineno"> 1945</span><span class="comment">//   };</span></div>
<div class="line"><span class="lineno"> 1946</span><span class="comment">//</span></div>
<div class="line"><span class="lineno"> 1947</span><span class="comment">//   MockFoo foo;</span></div>
<div class="line"><span class="lineno"> 1948</span><span class="comment">//   // Expects a call to non-const MockFoo::Bar().</span></div>
<div class="line"><span class="lineno"> 1949</span><span class="comment">//   EXPECT_CALL(foo, Bar());</span></div>
<div class="line"><span class="lineno"> 1950</span><span class="comment">//   // Expects a call to const MockFoo::Bar().</span></div>
<div class="line"><span class="lineno"> 1951</span><span class="comment">//   EXPECT_CALL(Const(foo), Bar());</span></div>
<div class="line"><span class="lineno"> 1952</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="lineno"> 1953</span><span class="keyword">inline</span> <span class="keyword">const</span> T&amp; Const(<span class="keyword">const</span> T&amp; x) { <span class="keywordflow">return</span> x; }</div>
<div class="line"><span class="lineno"> 1954</span> </div>
<div class="line"><span class="lineno"> 1955</span><span class="comment">// Constructs an Expectation object that references and co-owns exp.</span></div>
<div class="line"><span class="lineno"> 1956</span><span class="keyword">inline</span> Expectation::Expectation(internal::ExpectationBase&amp; exp)  <span class="comment">// NOLINT</span></div>
<div class="line"><span class="lineno"> 1957</span>    : expectation_base_(exp.GetHandle().expectation_base()) {}</div>
<div class="line"><span class="lineno"> 1958</span> </div>
<div class="line"><span class="lineno"> 1959</span>}  <span class="comment">// namespace testing</span></div>
<div class="ttc" id="aa00281_html_a149f693bd59fa1bc937af54c0cdcb32f"><div class="ttname"><a href="a00281.html#a149f693bd59fa1bc937af54c0cdcb32f">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a></div><div class="ttdeci">#define GTEST_EXCLUSIVE_LOCK_REQUIRED_(locks)</div><div class="ttdef"><b>Definition:</b> <a href="a00281_source.html#l02221">gtest-port.h:2221</a></div></div>
<div class="ttc" id="aa00281_html_a69abff5a4efdd07bd5faebe3dd318d06"><div class="ttname"><a href="a00281.html#a69abff5a4efdd07bd5faebe3dd318d06">GTEST_LOCK_EXCLUDED_</a></div><div class="ttdeci">#define GTEST_LOCK_EXCLUDED_(locks)</div><div class="ttdef"><b>Definition:</b> <a href="a00281_source.html#l02222">gtest-port.h:2222</a></div></div>
<div class="ttc" id="aa00281_html_aa73be6f0ba4a7456180a94904ce17790"><div class="ttname"><a href="a00281.html#aa73be6f0ba4a7456180a94904ce17790">GTEST_API_</a></div><div class="ttdeci">#define GTEST_API_</div><div class="ttdef"><b>Definition:</b> <a href="a00281_source.html#l00789">gtest-port.h:789</a></div></div>
<div class="ttc" id="aa00281_html_acdd47601a9376161c349a5881ccc6918"><div class="ttname"><a href="a00281.html#acdd47601a9376161c349a5881ccc6918">GTEST_ATTRIBUTE_UNUSED_</a></div><div class="ttdeci">#define GTEST_ATTRIBUTE_UNUSED_</div><div class="ttdef"><b>Definition:</b> <a href="a00281_source.html#l00669">gtest-port.h:669</a></div></div>
<div class="ttc" id="aa00281_html_aed8c1888c32b588b0681e88b95031e29"><div class="ttname"><a href="a00281.html#aed8c1888c32b588b0681e88b95031e29">GTEST_DISALLOW_COPY_AND_ASSIGN_</a></div><div class="ttdeci">#define GTEST_DISALLOW_COPY_AND_ASSIGN_(type)</div><div class="ttdef"><b>Definition:</b> <a href="a00281_source.html#l00699">gtest-port.h:699</a></div></div>
<div class="ttc" id="aa00281_html_af0970cdea09f16dbb1dbfccdaa693eeb"><div class="ttname"><a href="a00281.html#af0970cdea09f16dbb1dbfccdaa693eeb">GTEST_DECLARE_STATIC_MUTEX_</a></div><div class="ttdeci">#define GTEST_DECLARE_STATIC_MUTEX_(mutex)</div><div class="ttdef"><b>Definition:</b> <a href="a00281_source.html#l01840">gtest-port.h:1840</a></div></div>
<div class="ttc" id="aa00309_html"><div class="ttname"><a href="a00309.html">testing</a></div><div class="ttdef"><b>Definition:</b> <a href="a00206_source.html#l00152">gmock-actions.h:152</a></div></div>
<div class="ttc" id="aa00309_html_ae041df61ff61ccb9753ba15b4309e1a6"><div class="ttname"><a href="a00309.html#ae041df61ff61ccb9753ba15b4309e1a6">testing::DoDefault</a></div><div class="ttdeci">internal::DoDefaultAction DoDefault()</div><div class="ttdef"><b>Definition:</b> <a href="a00206_source.html#l01301">gmock-actions.h:1301</a></div></div>
<div class="ttc" id="aa00309_html_af5cacf4475557b5a3e37af3836564235"><div class="ttname"><a href="a00309.html#af5cacf4475557b5a3e37af3836564235">testing::Invoke</a></div><div class="ttdeci">std::decay&lt; FunctionImpl &gt;::type Invoke(FunctionImpl &amp;&amp;function_impl)</div><div class="ttdef"><b>Definition:</b> <a href="a00206_source.html#l01343">gmock-actions.h:1343</a></div></div>
<div class="ttc" id="aa00310_html_a08b187c6cc4e28400aadf9a32fccc8de"><div class="ttname"><a href="a00310.html#a08b187c6cc4e28400aadf9a32fccc8de">testing::internal::MutexLock</a></div><div class="ttdeci">GTestMutexLock MutexLock</div><div class="ttdef"><b>Definition:</b> <a href="a00281_source.html#l01855">gtest-port.h:1855</a></div></div>
<div class="ttc" id="aa00310_html_a203d1a8a2147a53d12bbdae40d443914"><div class="ttname"><a href="a00310.html#a203d1a8a2147a53d12bbdae40d443914">testing::internal::LogSeverity</a></div><div class="ttdeci">LogSeverity</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00249">gmock-internal-utils.h:249</a></div></div>
<div class="ttc" id="aa00310_html_a203d1a8a2147a53d12bbdae40d443914a396aacfaee2849eaab7c1de9773d624d"><div class="ttname"><a href="a00310.html#a203d1a8a2147a53d12bbdae40d443914a396aacfaee2849eaab7c1de9773d624d">testing::internal::kInfo</a></div><div class="ttdeci">@ kInfo</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00250">gmock-internal-utils.h:250</a></div></div>
<div class="ttc" id="aa00310_html_a203d1a8a2147a53d12bbdae40d443914a5beeeab1b0a3caabd0afb43356c1a271"><div class="ttname"><a href="a00310.html#a203d1a8a2147a53d12bbdae40d443914a5beeeab1b0a3caabd0afb43356c1a271">testing::internal::kWarning</a></div><div class="ttdeci">@ kWarning</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00252">gmock-internal-utils.h:251</a></div></div>
<div class="ttc" id="aa00310_html_a30708fa2bacf11895b03bdb21eb72309"><div class="ttname"><a href="a00310.html#a30708fa2bacf11895b03bdb21eb72309">testing::internal::UniversalPrint</a></div><div class="ttdeci">void UniversalPrint(const T &amp;value, ::std::ostream *os)</div><div class="ttdef"><b>Definition:</b> <a href="a00284_source.html#l00994">gtest-printers.h:994</a></div></div>
<div class="ttc" id="aa00310_html_a31b7c3abed4a7c395f42c61e993989f4"><div class="ttname"><a href="a00310.html#a31b7c3abed4a7c395f42c61e993989f4">testing::internal::FormatFileLocation</a></div><div class="ttdeci">GTEST_API_::std::string FormatFileLocation(const char *file, int line)</div></div>
<div class="ttc" id="aa00310_html_a5e3e473798de3189e9343132bcfd4fea"><div class="ttname"><a href="a00310.html#a5e3e473798de3189e9343132bcfd4fea">testing::internal::operator==</a></div><div class="ttdeci">bool operator==(faketype, faketype)</div><div class="ttdef"><b>Definition:</b> <a href="a00248_source.html#l01543">gtest.h:1543</a></div></div>
<div class="ttc" id="aa00310_html_a8a57ce0412334a3f487bbaa8321febbe"><div class="ttname"><a href="a00310.html#a8a57ce0412334a3f487bbaa8321febbe">testing::internal::Log</a></div><div class="ttdeci">GTEST_API_ void Log(LogSeverity severity, const std::string &amp;message, int stack_frames_to_skip)</div></div>
<div class="ttc" id="aa00310_html_aa46ca46a5898b2ac75184c62e0355621"><div class="ttname"><a href="a00310.html#aa46ca46a5898b2ac75184c62e0355621">testing::internal::Assert</a></div><div class="ttdeci">void Assert(bool condition, const char *file, int line, const std::string &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00224">gmock-internal-utils.h:224</a></div></div>
<div class="ttc" id="aa00310_html_ad93379317e10862a77b9fb90aa96e083"><div class="ttname"><a href="a00310.html#ad93379317e10862a77b9fb90aa96e083">testing::internal::Expect</a></div><div class="ttdeci">void Expect(bool condition, const char *file, int line, const std::string &amp;msg)</div><div class="ttdef"><b>Definition:</b> <a href="a00203_source.html#l00237">gmock-internal-utils.h:237</a></div></div>
<div class="ttc" id="aa00310_html_afa44fdec84edfc155ef63e4f0d4287cc"><div class="ttname"><a href="a00310.html#afa44fdec84edfc155ef63e4f0d4287cc">testing::internal::operator!=</a></div><div class="ttdeci">bool operator!=(faketype, faketype)</div><div class="ttdef"><b>Definition:</b> <a href="a00248_source.html#l01544">gtest.h:1544</a></div></div>
<div class="ttc" id="aa00315_html"><div class="ttname"><a href="a00315.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="a00272_source.html#l01320">gtest-internal.h:1320</a></div></div>
<div class="ttc" id="aa00668_html"><div class="ttname"><a href="a00668.html">Mock</a></div><div class="ttdef"><b>Definition:</b> <a href="a00173_source.html#l00210">gmock_link_test.h:210</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="a00203_source.html#l00224">testing::internal::Assert()</a>, <a class="el" href="a00206_source.html#l01301">testing::DoDefault()</a>, <a class="el" href="a00203_source.html#l00237">testing::internal::Expect()</a>, <a class="el" href="a00310.html#a31b7c3abed4a7c395f42c61e993989f4">testing::internal::FormatFileLocation()</a>, <a class="el" href="a00281_source.html#l00789">GTEST_API_</a>, <a class="el" href="a00281_source.html#l00669">GTEST_ATTRIBUTE_UNUSED_</a>, <a class="el" href="a00281_source.html#l01840">GTEST_DECLARE_STATIC_MUTEX_</a>, <a class="el" href="a00281_source.html#l00699">GTEST_DISALLOW_COPY_AND_ASSIGN_</a>, <a class="el" href="a00281_source.html#l02221">GTEST_EXCLUSIVE_LOCK_REQUIRED_</a>, <a class="el" href="a00281_source.html#l02222">GTEST_LOCK_EXCLUDED_</a>, <a class="el" href="a00206_source.html#l01343">testing::Invoke()</a>, <a class="el" href="a00203_source.html#l00250">testing::internal::kInfo</a>, <a class="el" href="a00203_source.html#l00251">testing::internal::kWarning</a>, <a class="el" href="a00310.html#a8a57ce0412334a3f487bbaa8321febbe">testing::internal::Log()</a>, <a class="el" href="a00248_source.html#l01544">testing::internal::operator!=()</a>, <a class="el" href="a00248_source.html#l01543">testing::internal::operator==()</a>, and <a class="el" href="a00284_source.html#l00994">testing::internal::UniversalPrint()</a>.</p>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="a00191_a88f79832f9d045112a76e9da8611cc13_cgraph.png" border="0" usemap="#aa00191_a88f79832f9d045112a76e9da8611cc13_cgraph" alt=""/></div>
<map name="aa00191_a88f79832f9d045112a76e9da8611cc13_cgraph" id="aa00191_a88f79832f9d045112a76e9da8611cc13_cgraph">
<area shape="rect" title=" " alt="" coords="5,257,249,298"/>
<area shape="rect" href="a00310.html#aa46ca46a5898b2ac75184c62e0355621" title=" " alt="" coords="309,81,423,122"/>
<area shape="rect" href="a00309.html#ae041df61ff61ccb9753ba15b4309e1a6" title=" " alt="" coords="304,147,428,173"/>
<area shape="rect" href="a00310.html#ad93379317e10862a77b9fb90aa96e083" title=" " alt="" coords="309,15,423,57"/>
<area shape="rect" href="a00310.html#a31b7c3abed4a7c395f42c61e993989f4" title=" " alt="" coords="299,198,433,239"/>
<area shape="rect" href="a00309.html#af5cacf4475557b5a3e37af3836564235" title=" " alt="" coords="313,264,419,291"/>
<area shape="rect" href="a00310.html#a8a57ce0412334a3f487bbaa8321febbe" title=" " alt="" coords="297,315,435,341"/>
<area shape="rect" href="a00310.html#afa44fdec84edfc155ef63e4f0d4287cc" title=" " alt="" coords="309,366,423,407"/>
<area shape="rect" href="a00310.html#a5e3e473798de3189e9343132bcfd4fea" title=" " alt="" coords="309,431,423,473"/>
<area shape="rect" href="a00310.html#a30708fa2bacf11895b03bdb21eb72309" title=" " alt="" coords="309,497,423,538"/>
<area shape="rect" href="a00310.html#a93a00bf550dcc6b1de870d24c624869c" title=" " alt="" coords="498,85,629,126"/>
<area shape="rect" href="a00628.html#a0c43ec1946cb4ab51279c96ce1ad941d" title=" " alt="" coords="483,5,644,61"/>
<area shape="rect" href="a00740.html#aecec021e1abbaa260b701e24e3fe33eb" title=" " alt="" coords="489,497,637,538"/>
<area shape="rect" href="a00310.html#adb3c27150dbe661db0e0c4be27533460" title=" " alt="" coords="692,497,807,538"/>
<area shape="rect" href="a00310.html#a5e9f744566e02ba3f811cd51d3b8c4fb" title=" " alt="" coords="855,497,979,538"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 4 2022 19:31:09 for MUSI6106 by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
